<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 
 <title>Jonathan Petitcolas - Web developer and open-source aficionado</title>
 <link href="http://www.jonathan-petitcolas.com/atom.xml" rel="self"/>
 <link href="http://www.jonathan-petitcolas.com/"/>
 <updated>2015-07-15T18:28:04+00:00</updated>
 <id>http://www.jonathan-petitcolas.com/</id>
 <author>
   <name>Jonathan Petitcolas</name>
   <email>petitcolas.jonathan+blog@gmail.com</email>
 </author>

 
 <entry>
   <title>Minutes of PHP Tour 2015</title>
   <link href="http://www.jonathan-petitcolas.com/2015/06/01/minutes-of-phptour-2015.html"/>
   <updated>2015-06-01T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2015/06/01/minutes-of-phptour-2015</id>
   <content type="html">&lt;p&gt;Two weeks ago, we attended the PHP Tour 2015, organized by &lt;a href=&quot;http://afup.org/&quot;&gt;AFUP&lt;/a&gt;, the French PHP Users Association in Luxembourg. It was a great chance to meet other passionate developers, to exchange about current PHP best practices, brand new frameworks, or other indispensable tips to enhance our productivity. But it was also the occasion to watch several interesting talks.&lt;/p&gt;

&lt;p&gt;The theme of this edition was the &lt;strong&gt;cloud&lt;/strong&gt;.
A lot of conferences were about migration from physical server to multi-scalable instances, and how to secure deployments.&lt;/p&gt;

&lt;h2&gt;The Continuous PHP Pipeline, by Michelangelo van Dam&lt;/h2&gt;

&lt;div class=&quot;embed-container&quot;&gt;&lt;iframe src=&quot;//www.slideshare.net/slideshow/embed_code/key/a5pGRevdr0T9Yo&quot; scrolling=&quot;no&quot; style=&quot;border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;&quot; allowfullscreen&gt; &lt;/iframe&gt;&lt;/div&gt;

&lt;p&gt;As a first talk, this was a good one. Michelangelo talked about continous deployment. Automating every step of the development process is fundamental to let developers do what they do the best: develop. Then, the recipe to transform production deployment for big events to a common task you can do every day is:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Use Vagrant or Docker to manage your system infrastructure,&lt;/li&gt;
&lt;li&gt;Think about a SCM workflow to not let other developers get in your work,&lt;/li&gt;
&lt;li&gt;Detect regressions ASAP with continous integration (Jenkins, Travis, etc.)&lt;/li&gt;
&lt;li&gt;Smooth production deployment using continous full automated deployment&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;About continous integration, I especially remember of one quote, which illustrates perfectly agility in development:&lt;/p&gt;

&lt;blockquote class=&quot;twitter-tweet&quot; lang=&quot;fr&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;Fail as quickly as possible [...] If it hurts, do it more frequently [...] Everyone is responsible [...] via &lt;a href=&quot;https://twitter.com/DragonBe&quot;&gt;@dragonbe&lt;/a&gt; &lt;a href=&quot;https://twitter.com/hashtag/PHPTour?src=hash&quot;&gt;#PHPTour&lt;/a&gt; Lux&lt;/p&gt;&amp;mdash; Thierry Marianne (@thierrymarianne) &lt;a href=&quot;https://twitter.com/thierrymarianne/status/598036606260510720&quot;&gt;12 Mai 2015&lt;/a&gt;&lt;/blockquote&gt;

&lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;p&gt;This talk showed a wide range of tools used to enhance your development process, to spend less time in cumbersome tasks, and think more about business solutions. We fully agree with it, as these concepts have been used for several years at &lt;a href=&quot;http://marmelab.com/&quot;&gt;marmelab&lt;/a&gt;. ;)&lt;/p&gt;

&lt;p&gt;Extra kudos for discovering &lt;a href=&quot;http://techblog.netflix.com/2012/07/chaos-monkey-released-into-wild.html&quot;&gt;NetFlix Chaos Monkey&lt;/a&gt;, an evil monkey shutting down random parts of your AWS infrastructure.&lt;/p&gt;

&lt;h2&gt;The Promise of Asynchrounous PHP, by Wim Godden&lt;/h2&gt;

&lt;div class=&quot;embed-container&quot;&gt;&lt;iframe src=&quot;//www.slideshare.net/slideshow/embed_code/key/nqxdRQwXKEWSS3&quot; width=&quot;425&quot; height=&quot;355&quot; frameborder=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; scrolling=&quot;no&quot; style=&quot;border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;&quot; allowfullscreen&gt; &lt;/iframe&gt;&lt;/div&gt;

&lt;p&gt;I was pretty lukewarm before attending to this talk. As a pragmatic developer, I generally try to use the right tool for the right purpose. If I want to do some asynchrounous tasks, I use Node.js or Golang, not PHP. Yet, I was curious enough to watch this speaker.&lt;/p&gt;

&lt;p&gt;That was a nice surprise. I discovered &lt;a href=&quot;http://reactphp.org/&quot;&gt;ReactPHP&lt;/a&gt;, a well-thought framework. It looks a lot like JS promises, which I&amp;#39;ve come to become fond of. If I were trapped in a pure PHP project, it would be worth to give ReactPHP a try. Otherwise, I would just keep Node.js. Indeed, some features or tools are still lacking to do asynchronous PHP efficiently. For instance, the excellent &lt;a href=&quot;https://github.com/caolan/async&quot;&gt;async&lt;/a&gt; utility to control multiple promises execution flow.&lt;/p&gt;

&lt;p&gt;Side-effect discovery: there is already a built-in &lt;a href=&quot;http://php.net/manual/en/class.thread.php&quot;&gt;Thread&lt;/a&gt; class in PHP to manage asynchrounous tasks.&lt;/p&gt;

&lt;h2&gt;Code your infrastructure, by Oswald De Riemaecker&lt;/h2&gt;

&lt;div class=&quot;embed-container&quot;&gt;&lt;iframe src=&quot;//fr.slideshare.net/slideshow/embed_code/key/TYO5IAirNSfeO&quot; width=&quot;425&quot; height=&quot;355&quot; frameborder=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; scrolling=&quot;no&quot; style=&quot;border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;&quot; allowfullscreen&gt; &lt;/iframe&gt;&lt;/div&gt;

&lt;p&gt;Oswald&amp;#39;s motto is &amp;quot;Developers should focus on code, not on deployment&amp;quot;. After a quick explanation about different provisionning tools (Puppet / Chef / Ansible), he focused on how to deploy PHP code with Chef, Berkshelf, Kitchen, Knife, Serverspec, Vagrant and Packer.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Chef&lt;/code&gt; is used to provision servers in the architecture (installing Apache, MySQL &amp;amp; Solr) with a couple of cookbooks&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Knife&lt;/code&gt; is the command line tool helping to manage recipes&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Berkshelf&lt;/code&gt; manage cookbook dependencies&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Kitchen&lt;/code&gt; &amp;amp; &lt;code&gt;Serverspec&lt;/code&gt; allow to test cookbooks automatically&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Packer&lt;/code&gt; creates images (iso/ami/..) that can be deployed to a cloud prodiver&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This was a complete overview of how we can provision, test and deploy a simple application on a cloud infrastructure with some code and configuration.&lt;/p&gt;

&lt;h2&gt;Comment migrer avec succès dans le cloud ? by Jonathan Van Belle&lt;/h2&gt;

&lt;div class=&quot;embed-container&quot;&gt;&lt;iframe src=&quot;//slides.com/grummfy/comment-migrer-avec-succes-dans-le-coud/embed&quot; width=&quot;576&quot; height=&quot;420&quot; scrolling=&quot;no&quot; frameborder=&quot;0&quot; webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;&lt;/div&gt;

&lt;p&gt;This talk was an honest feedback about how to migrate a nightmare website (no best practice, no documentation, huge developer turn-over) into a cloudy infrastructure. However, I didn&amp;#39;t catch with this talk. The main motto of this talk is &amp;quot;Ask help everytime you need!&amp;quot;. Of course it is still a valuable advice, but the lack of technical section left me a little bit disappointed.&lt;/p&gt;

&lt;h2&gt;Frameworks: an History of Violence, by François Zaninotto&lt;/h2&gt;

&lt;div class=&quot;embed-container&quot;&gt;&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/ep3Oztvy0rk&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;&lt;/div&gt;

&lt;p&gt;Disclaimer: François is my boss at &lt;a href=&quot;http://www.marmelab.com&quot;&gt;marmelab&lt;/a&gt;. So, yes, it is an excellent talk. ;)&lt;/p&gt;

&lt;p&gt;More seriously, this talk was great, both in substance and form. François plays the leader of the Innovation Party, and tries to convinces the audience that we should not rely on big full-stack frameworks. Indeed, these frameworks are changing, unlike the business domain, which would still be topical. We should rather use micro-frameworks to reduce dependencies to a single code chunk. And do not hesitate to test new technologies into your real-world application. This way, you will be able to follow Web evolution without being stuck with outdated frameworks.&lt;/p&gt;

&lt;h2&gt;Sauf erreur, je ne me trompe jamais, by Frederic Bouchery&lt;/h2&gt;

&lt;div class=&quot;embed-container&quot;&gt;&lt;iframe src=&quot;//fr.slideshare.net/slideshow/embed_code/key/hqQhqGvUC2k6to&quot; width=&quot;425&quot; height=&quot;355&quot; frameborder=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; scrolling=&quot;no&quot; style=&quot;border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;&quot; allowfullscreen&gt; &lt;/iframe&gt;&lt;/div&gt;

&lt;p&gt;Frederic explained during this talk how we should deal with errors in our PHP applications. To sum up, log everything but don&amp;#39;t show any error messages for security reasons. Only banalities then (but just my personal opinion (-:).&lt;/p&gt;

&lt;h2&gt;Ansible pour le Cloud, by Maxime Thoonsen&lt;/h2&gt;

&lt;div class=&quot;embed-container&quot;&gt;&lt;iframe src=&quot;//slides.com/maximethoonsen/ansible-pour-le-cloud-php-tour-2015/embed&quot; width=&quot;576&quot; height=&quot;420&quot; scrolling=&quot;no&quot; frameborder=&quot;0&quot; webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;&lt;/div&gt;

&lt;p&gt;I never use &lt;a href=&quot;http://www.ansible.com/home&quot;&gt;Ansible&lt;/a&gt; before. This talk inspired me a lot, and I will probably give it a try. Ansible allows to deploy apps based on configuration files, setuping your system easily. It integrates well with Docker containers, used both to install Docker on a fresh server, and to configure your container using some recipes.&lt;/p&gt;

&lt;h2&gt;Retour d&amp;#39;expérience ARTE, par Thibault Lenclos&lt;/h2&gt;

&lt;div class=&quot;embed-container&quot;&gt;&lt;iframe src=&quot;http://thibz.com/phptour-2015/?full#coverpage&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;

&lt;p&gt;Thibault gave us some insights about processes to build a brand new REST API for ARTE. Thibault and his team worked the agile way (daily stand-ups, task prioritization, etc.), using continous integration as a safety net. He also shared a lot of technical details about what they used for automation, development and monitoring. Nice humane and technical feedbacks.&lt;/p&gt;

&lt;h2&gt;Nobody Understands REST, but it is OK, by William Durand&lt;/h2&gt;

&lt;script async class=&quot;speakerdeck-embed&quot; data-id=&quot;b14006e42cc247cdac1ad58e4cd7994a&quot; data-ratio=&quot;1.29456384323641&quot; src=&quot;//speakerdeck.com/assets/embed.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;William presented what REST really is: more than just using HTTP methods (GET, POST, etc.), it is also about HATEOAS and semantics. Yet, even if it sounds good, it is impossible to industrialize a strict RESTful API, and we should go toward a degraded REST standard that William calls HTTP++. Very instructive talk, with a good trip back to reality.&lt;/p&gt;

&lt;h2&gt;Security workshop by Manuel Silvoso&lt;/h2&gt;

&lt;p&gt;I registered to the security workshop without a lot of hope. Generally, these kind of workshops show only the basic SQL injection and XSS vulnerabilities. Yet, it was the best security workshop I ever attended. I was nicely surprised. Manuel Silvoso let us of course manipulate these flaws, but also went further:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;How to secure passwords correctly, with &lt;code&gt;bcrypt&lt;/code&gt;?&lt;/li&gt;
&lt;li&gt;Generate one-time password with &lt;a href=&quot;https://www.yubico.com/products/yubikey-hardware/&quot;&gt;Yubikeys&lt;/a&gt;, a hardware device linked to an API&lt;/li&gt;
&lt;li&gt;Discovering of XSS dangers through &lt;a href=&quot;http://beefproject.com/&quot;&gt;BeeF Framework&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.owasp.org/index.php/OWASP_Che%0Aat_Sheet_Series&quot;&gt;OWASP Cheat Sheet&lt;/a&gt;, a list of known vulnerabilities and how to counter them&lt;/li&gt;
&lt;li&gt;Detect vulnerabilities using honey pots, IDS or tar traps&lt;/li&gt;
&lt;li&gt;Lot of other stuff&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Slides are not publicly available. But if you want to play with his vulnerable app, that&amp;#39;s on GitHub: &lt;a href=&quot;https://github.com/msilvoso/vulnerableApp&quot;&gt;msilvoso/vulnerableApp&lt;/a&gt;.&lt;/p&gt;

&lt;h2&gt;MVVM and Silex, by Billie Thomson&lt;/h2&gt;

&lt;script async class=&quot;speakerdeck-embed&quot; data-id=&quot;7dad86c894144aba8dc06d0917e1ff07&quot; data-ratio=&quot;1.33333333333333&quot; src=&quot;//speakerdeck.com/assets/embed.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;Today, applications are often developed using a client framework such as Angular.js or React. The server application is then pushed to background, exposing only an API. This refreshing talk presented this new way of structuring web applications, using Angular and Silex, but also with an introduction to Express. Speaking of Node.js in PHP Tour was a daring but successful bet!&lt;/p&gt;

&lt;h2&gt;PHP deploy 2015 flavor, by Quentin Adam&lt;/h2&gt;

&lt;div class=&quot;embed-container&quot;&gt;&lt;iframe src=&quot;//fr.slideshare.net/slideshow/embed_code/key/EJmUCyW1Gsbn0j&quot; width=&quot;425&quot; height=&quot;355&quot; frameborder=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; scrolling=&quot;no&quot; style=&quot;border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;&quot; allowfullscreen&gt; &lt;/iframe&gt;&lt;/div&gt;

&lt;p&gt;Here is another talk about deployment and its best practices. We can list:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Do not use file system as a datastore (true for logs too)&lt;/li&gt;
&lt;li&gt;Mix datastores, each one has its own strengths and weaknesses&lt;/li&gt;
&lt;li&gt;Modularize your app with event brokers&lt;/li&gt;
&lt;li&gt;Do not commit dependencies&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;A good talk, even if there was too many animated Gifs.&lt;/p&gt;

&lt;h2&gt;Chroniques d&amp;#39;un voyage vers l&amp;#39;Est, by Frédéric Hardy&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://blog.est.voyage/phpTour2015/&quot;&gt;See full post (in French)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I got tangled up in this talk. It deals with the application of strict object oriented programming. An object should only be aware of its own functioning and of its interface with the outside world. If the basic idea looks good, the practice implies a lot of interfaces, which as far as I understand, complexify the code a great deal. But I probably missed the point. :)&lt;/p&gt;

&lt;h2&gt;PHP7 is coming, by Julien Pauli&lt;/h2&gt;

&lt;div class=&quot;embed-container&quot;&gt;&lt;iframe src=&quot;//fr.slideshare.net/slideshow/embed_code/key/k2XkYFQKs4C9Z&quot; width=&quot;425&quot; height=&quot;355&quot; frameborder=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; scrolling=&quot;no&quot; style=&quot;border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;&quot; allowfullscreen&gt; &lt;/iframe&gt;&lt;/div&gt;

&lt;p&gt;A quick overview of new features of PHP7:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Syntaxic sugar with &lt;code&gt;??&lt;/code&gt; or spaceship &lt;code&gt;&amp;lt;=&amp;gt;&lt;/code&gt; (kudos for the name) operators,&lt;/li&gt;
&lt;li&gt;Fatal errors are turned into exceptions,&lt;/li&gt;
&lt;li&gt;Scalar type hinting,&lt;/li&gt;
&lt;li&gt;Ability to declare return types for functions,&lt;/li&gt;
&lt;li&gt;Anonymous classes, like anonymous functions&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Performance isn&amp;#39;t forgotten in this new version. You can expect using half the memory and CPU power with version 7 compared to PHP6.&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;This was the first edition of PHP Tour we attended to. We were delightly surprised by the quality of talks, which were quite varied. See you again in 2016?&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>How-to setup Webpack on an ES6 React Application with SASS?</title>
   <link href="http://www.jonathan-petitcolas.com/2015/05/15/howto-setup-webpack-on-es6-react-application-with-sass.html"/>
   <updated>2015-05-15T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2015/05/15/howto-setup-webpack-on-es6-react-application-with-sass</id>
   <content type="html">&lt;p&gt;I spent some time lately to play with &lt;a href=&quot;https://github.com/webpack/webpack&quot;&gt;Webpack&lt;/a&gt;. As Grunt or Gulp, Webpack is a JavaScript bundler, allowing to turn our messy and numerous JavaScript into a single minified and optimized script. I used to use Gulp, but taking a look on Webpack and all its features made me switch pretty quickly, especially because of its &lt;code&gt;webpack-dev-server&lt;/code&gt; and &lt;code&gt;react-hot-loader&lt;/code&gt; killing features, increasing drastically our development workflow. &lt;/p&gt;

&lt;p&gt;The only blot with this tool is its documentation. There are a lot of pages about all the available options, but not a real-world get started tutorial. After spending days to figure out the best way to handle with my application, here is a summary for an ES6 React application using some SASS.&lt;/p&gt;

&lt;h2&gt;Setting up Webpack&lt;/h2&gt;

&lt;p&gt;Let&amp;#39;s write a very simple and useless application splitted into two files:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// js/hello.js&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;Hello&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// js/world.js&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;World&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Including these two scripts into our page outputs &lt;code&gt;Hello World!&lt;/code&gt;. Nothing to write home about for the moment. Then fetch Webpack:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;npm init
npm install --save-dev webpack
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It&amp;#39;s time to write our &lt;code&gt;webpack.config.js&lt;/code&gt; file to tell Webpack to concatenate these two files together:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;entry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;helloWorld&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;./js/helloworld&amp;#39;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;public/[name].js&amp;#39;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This file says Webpack to take &lt;code&gt;./js/helloworld&lt;/code&gt; as an input and to process it into a &lt;code&gt;public/helloWorld.js&lt;/code&gt; file.&lt;/p&gt;

&lt;p&gt;Here is the content of our new &lt;code&gt;helloworld.js&lt;/code&gt; script:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;./hello&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;./world&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let&amp;#39;s compile our entry using the following command line:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;./node_modules/webpack/bin/webpack.js
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There is a new file in &lt;code&gt;public&lt;/code&gt; folder, containing a lot of code, especially the definition of a &lt;code&gt;__webpack__require__&lt;/code&gt; function. Adding this generated script alone into our page still displays the same message in the console. That&amp;#39;s the default behavior of Webpack: concatenating all your dependencies into a single file, preventing from sending a bench of different HTTP requests.&lt;/p&gt;

&lt;p&gt;That&amp;#39;s fine, it reduces number of requests. But size is still the addition of my two dependency, plus size of all Webpack internals. Fortunately, you also can minify your scripts with Webpack. Just give it a &lt;code&gt;--production&lt;/code&gt; (or &lt;code&gt;-p&lt;/code&gt;) flag:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;./node_modules/webpack/bin/webpack.js -p
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With such a simple case, we pass from 1.7kb to 305 bytes.&lt;/p&gt;

&lt;h2&gt;Live-Reload with Webpack&lt;/h2&gt;

&lt;p&gt;One of the most useful features in my daily developer life is live-reload. Concept is pretty simple: when you save a file, it automatically refreshes your browser. No need to press F5 anymore. Looks like a lazy developer tip, but it really increases your productivity, especially with dual-screen.&lt;/p&gt;

&lt;h3&gt;Setting up Webpack Dev Server&lt;/h3&gt;

&lt;p&gt;Currently, we had to launch the webpack compilation command to refresh our file. Let&amp;#39;s take a step further using the &lt;code&gt;webpack-dev-server&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;npm install --save-dev webpack-dev-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This module serves all your compiled files through a web server (by default on &lt;code&gt;localhost:8080&lt;/code&gt;). This way, all our files are computed in RAM. Thus, computing diffs and refreshing files don&amp;#39;t include any disk I/O, providing a really blazing fast live reload.&lt;/p&gt;

&lt;p&gt;For development, instead of using the &lt;code&gt;webpack&lt;/code&gt; command, rather use the following one to launch dev server:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt; ./node_modules/webpack-dev-server/bin/webpack-dev-server.js --progress --colors
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Replace your &lt;code&gt;script&lt;/code&gt; tag by the following:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;http://localhost:8080/public/helloWorld.js&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Look at the console. It should display &amp;quot;Hello World&amp;quot;. If we replace &amp;quot;World&amp;quot; by &amp;quot;John Doe&amp;quot; and simply save our file, we expect our console to be refreshed. Yet, nothing happens.&lt;/p&gt;

&lt;p&gt;Webpack uses &lt;a href=&quot;http://socket.io/&quot;&gt;Socket.io&lt;/a&gt; to know when to refresh browser. We launched the Socket.io server, but didn&amp;#39;t update our client script. Webpack eases our work with a pre-built module. Just modify your &lt;code&gt;entry&lt;/code&gt; parameter:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;entry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;helloWorld&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;s1&quot;&gt;&amp;#39;webpack-dev-server/client?http://localhost:8080&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;s1&quot;&gt;&amp;#39;./js/helloworld.js&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If we relaunch our dev server and refresh manually our browser, a Socket.io connection is then initialized. Switching &lt;code&gt;John Doe&lt;/code&gt; to &lt;code&gt;Alice Brown&lt;/code&gt; into our file now automatically reloads the page in the browser. Hurrah! Live-reload is working!&lt;/p&gt;

&lt;h3&gt;Webpack dev server and production?&lt;/h3&gt;

&lt;p&gt;Of course, we won&amp;#39;t deploy our dev server in production. One solution is to use an environment variable. Let&amp;#39;s use &lt;code&gt;NODE_ENV&lt;/code&gt; to check if we should embed the dev server client:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;getEntrySources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;NODE_ENV&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;production&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;sources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;webpack-dev-server/client?http://localhost:8080&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;entry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;helloWorld&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;getEntrySources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;
            &lt;span class=&quot;s1&quot;&gt;&amp;#39;./js/helloworld.js&amp;#39;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Compiling for production would then looks like:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;NODE_ENV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;production&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;node_modules&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;webpack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;webpack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;js&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;p&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Another issue is the script &lt;code&gt;src&lt;/code&gt; attribute. In development, we should embed it as a dev server served resource (using &lt;code&gt;http://localhost:8080&lt;/code&gt;). In production, it would either be served from a CDN, or directly from &lt;code&gt;public&lt;/code&gt; folder. &lt;/p&gt;

&lt;p&gt;To differentiate these usages, I simply use a template variable. For instance, using Swig and Node.js:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cdn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;NODE_ENV&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;production&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;/&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;http://localhost:8080/&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;swig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setDefaults&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;locals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Global variables&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;cdn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cdn&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;{{ cdn }}helloWorld.js&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Webpack and React.js&lt;/h2&gt;

&lt;p&gt;I suppose in this part that you are already familiar with &lt;a href=&quot;https://facebook.github.io/react/&quot;&gt;React.js&lt;/a&gt;. If not, please, go ahead to discover this amazing framework.&lt;/p&gt;

&lt;h3&gt;Setting up a Basic &amp;quot;Hello World!&amp;quot; Application&lt;/h3&gt;

&lt;p&gt;Let&amp;#39;s build a simple &amp;quot;Hello World!&amp;quot; application, allowing the user to enter their name.&lt;/p&gt;

&lt;p&gt;First, install React.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;npm install --save-dev react
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We install it as a dev dependency. Indeed, we won&amp;#39;t use it directly in production, as it will be embedded into our compiled output.&lt;/p&gt;

&lt;p&gt;Let&amp;#39;s write our application, using the far less verbose JSX notation.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;React&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;react&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HelloSayer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;React&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Hello&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&amp;lt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/p&amp;gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HelloSayer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HelloSayer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;./HelloSayer&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;React&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;react&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HelloForm&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;React&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;getInitialState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;world&amp;#39;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;hello-form&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;text&amp;quot;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;onChange&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;onChange&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;HelloSayer&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/div&amp;gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;onChange&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;value&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HelloForm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HelloForm&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;./HelloForm&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;React&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;react&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;React&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;HelloForm&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getElementsByTagName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;body&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;These are some basic React components. I won&amp;#39;t cover this code as this is not the purpose of this post. Even if it should not work at this state, here is the final expected component for a better visualisation:&lt;/p&gt;

&lt;div class=&quot;labs&quot; id=&quot;react-hello-form&quot;&gt;&lt;/div&gt;

&lt;script src=&quot;/labs/react-hello-form.js&quot;&gt;&lt;/script&gt;

&lt;h3&gt;Transforming JSX on the fly&lt;/h3&gt;

&lt;p&gt;Even if you can use pure JavaScript, React is greatly simplified if you use JSX syntax, as above. Yet, JSX is understandable neither by browsers nor Webpack. So, to circumvent this issue, we have to transform JSX into pure JS &lt;strong&gt;before&lt;/strong&gt; Webpack handles it.&lt;/p&gt;

&lt;p&gt;The Webpack ecosystem has a lot of loaders available. A loader is simply a transformer, applied on all files matching a regular expression. So, implement a JSX loader to deal with our components:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;npm install --save-dev jsx-loader
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Modify our configuration accordingly:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;loaders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/\.js$/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;jsx&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;exclude&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/node_modules/&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...  &lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So, all files whose path finish with &lt;code&gt;.js&lt;/code&gt; will be transformed by &lt;code&gt;jsx-loader&lt;/code&gt;, except those under &lt;code&gt;node_modules&lt;/code&gt; folder (for performances reason). This time, Webpack should not complain and should display your widget correctly.&lt;/p&gt;

&lt;p&gt;Note that you can omit the suffix &lt;code&gt;-loader&lt;/code&gt; for the &lt;code&gt;loader&lt;/code&gt; property. In above code, we may have replaced &lt;code&gt;jsx&lt;/code&gt; by &lt;code&gt;jsx-loader&lt;/code&gt;.&lt;/p&gt;

&lt;h3&gt;Installing React Hot Loader&lt;/h3&gt;

&lt;p&gt;We already enabled live-reload. However, if you want to change the &lt;code&gt;HelloSayer&lt;/code&gt; component, it will reload the whole page, losing the data you entered in the &lt;code&gt;input&lt;/code&gt; field.&lt;/p&gt;

&lt;p&gt;We can go a step further into our live-reload implementation, using &lt;a href=&quot;http://gaearon.github.io/react-hot-loader/&quot;&gt;react-hot-loader&lt;/a&gt;. This tool reloads only the React component you changed. In our case, modifying the &lt;code&gt;HelloSayer&lt;/code&gt; should have no impact on the input, which is outside its scope.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;dev&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;react&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;loader&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We have to tweak some of our &lt;code&gt;webpack.config.js&lt;/code&gt; file. First, we have to embed a new watching script for React Hot Loader:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// webpack.config.js&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;getEntrySources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;NODE_ENV&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;production&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;sources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;webpack/hot/only-dev-server&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, we add the &lt;code&gt;react-hot&lt;/code&gt; loader to our React component files (in this case, all the &lt;code&gt;.js&lt;/code&gt; files):&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// webpack.config.js&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;loaders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/\.js$/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;loaders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;react-hot&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;jsx&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// &amp;lt;-- changed line&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;exclude&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/node_modules/&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, you have to launch your &lt;code&gt;webpack-dev-server&lt;/code&gt; with a &lt;code&gt;--hot&lt;/code&gt; option to enable React Hot Reload:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;./node_modules/webpack-dev-server/bin/webpack-dev-server.js --hot --progress --colors
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Because of some browser restrictions, we can&amp;#39;t open our page with &lt;code&gt;file://&lt;/code&gt; protocol anymore: we need a HTTP server. Let&amp;#39;s use the simple no-configuration one: &lt;a href=&quot;https://github.com/indexzero/http-server&quot;&gt;http-server&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;npm install --save-dev http-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Running it is as simple as:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;./node_modules/http-server/bin/http-server -p &lt;span class=&quot;m&quot;&gt;3000&lt;/span&gt; .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We run our server on port 3000 and set the web root to current folder (this is &lt;code&gt;public&lt;/code&gt; by default).&lt;/p&gt;

&lt;p&gt;If we launch our application in current state, React Hot Loader would try to fetch its update on current host, ie on port 3000. As Webpack dev server is bound to port 8080, we have to force use of absolute URL, using the &lt;code&gt;publicPath&lt;/code&gt; property:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;publicPath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;http://localhost:8080/&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// &amp;lt;-- New line!&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;public/[name].js&amp;#39;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Relaunch your server, and admire!&lt;/p&gt;

&lt;h2&gt;Webpack and ES6 using Babel&lt;/h2&gt;

&lt;p&gt;Let&amp;#39;s prepare the future for our application using &lt;a href=&quot;https://github.com/lukehoban/es6features&quot;&gt;EcmaScript6&lt;/a&gt;. ES6 is the new standard of JavaScript, embedding nice features, such as classes or template strings. Unfortunately, not all browsers are compatible with this language evolution: we have to transpile ES6 into good old ES5.&lt;/p&gt;

&lt;p&gt;There are two main transpilers: Babel and Traceur. My &lt;a href=&quot;http://www.jonathan-petitcolas.com/2015/03/09/transpiling-es6-to-es5-using-babel.html&quot;&gt;choice is made on Babel&lt;/a&gt;, so let&amp;#39;s use it with Webpack. &lt;/p&gt;

&lt;p&gt;As usual, we use a loader:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;npm install --save babel-loader
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Just add it to all your JS files, after the JSX loader, as Babel won&amp;#39;t understand HTML tags into your JavaScript files:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;loaders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/\.js$/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;loaders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;react-hot&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;jsx&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;babel&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// &amp;lt;-- changed line&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;exclude&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/node_modules/&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Be careful to your loaders order: they are applied from right to left. So, we first transpile our ES6 code, then we turn our ES5 JSX to pure JS, and then we watch for the hot reload.&lt;/p&gt;

&lt;p&gt;Webpack now transpiles ES6 into ES5. Let&amp;#39;s check it converting one of our component into ES6:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kr&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;React&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;react&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kr&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HelloSayer&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;React&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Hello&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&amp;lt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/p&amp;gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kr&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HelloSayer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our app still works. We are done! Dead simple isn&amp;#39;t it?&lt;/p&gt;

&lt;h2&gt;Compiling SASS with Webpack&lt;/h2&gt;

&lt;p&gt;Webpack is the Swiss-army knife of Web bundler. It can also handle SASS compilation for you. Let&amp;#39;s see how it works.&lt;/p&gt;

&lt;h3&gt;SASS, CSS, and style loaders&lt;/h3&gt;

&lt;p&gt;Let&amp;#39;s create a very basic SASS file for our component:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-css&quot; data-lang=&quot;css&quot;&gt;&lt;span class=&quot;nc&quot;&gt;.hello-form&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;blue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To compile SASS files, you need a SASS loader of course, but also a CSS and a style loaders. Indeed, Webpack understands only JS. Basically explained, when we write a &lt;code&gt;require(&amp;#39;style.scss&amp;#39;)&lt;/code&gt;, SASS loader turns it into &lt;code&gt;style.css&lt;/code&gt;, which should then be turned into JavaScript with CSS loader, and finally embedded as styles using the style loader.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;npm install --save-dev sass-loader css-loader style-loader
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As usual, add a new loader into our configuration:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;loaders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/\.scss$/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;loaders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;style&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;css&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;sass&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, if you include your SCSS file into your &lt;code&gt;HelloForm&lt;/code&gt; JavaScript file:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;../sass/HelloForm.scss&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Your style should be loaded. Some may find it really weird to include some SCSS into a JavaScript file. After playing several weeks with it, I must admit this is really nice. All your components are now better isolated, each one containing its own style and logic. Far better for maintainability and reuse.&lt;/p&gt;

&lt;h4&gt;Fixing uv__finish_close error&lt;/h4&gt;

&lt;p&gt;There is an issue with the current version of &lt;code&gt;sass-loader&lt;/code&gt;:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;build modulesnode: ../deps/uv/src/unix/core.c:199: uv__finish_close: Assertion `0&amp;#39; failed.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;To fix it, just downgrade your &lt;code&gt;sass-loader&lt;/code&gt; version to 0.5, editing your &lt;code&gt;package.json&lt;/code&gt; file and redoing a new &lt;code&gt;npm install&lt;/code&gt;.&lt;/p&gt;

&lt;h3&gt;Move CSS in external stylesheet&lt;/h3&gt;

&lt;p&gt;Taking a closer look at the generated code, we may notice that styles are included using a &lt;code&gt;&amp;lt;style&amp;gt;&lt;/code&gt; tag. That&amp;#39;s a bad practice, as it prevents browsers from caching CSS. So, let&amp;#39;s move it into a dedicated file.&lt;/p&gt;

&lt;p&gt;We are going to use the &lt;code&gt;ExtractTextPlugin&lt;/code&gt;, which moves the generated content into a file:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;npm install --save-dev extract-text-webpack-plugin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, update your config:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ExtractTextPlugin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;extract-text-webpack-plugin&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;loaders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/\.scss$/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ExtractTextPlugin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;extract&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;css!sass&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;plugins&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ExtractTextPlugin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;public/style.css&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;allChunks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We first replace our &lt;code&gt;loaders&lt;/code&gt; with a single &lt;code&gt;loader&lt;/code&gt;, provided by the &lt;code&gt;ExtractTextPlugin&lt;/code&gt;. We apply two filters to it, first &lt;code&gt;sass&lt;/code&gt; then &lt;code&gt;css&lt;/code&gt;. We removed the &lt;code&gt;style&lt;/code&gt; one, as we don&amp;#39;t want to embed styles directly in the page anymore.&lt;/p&gt;

&lt;p&gt;Then, we effectively move the styles into &lt;code&gt;public/style.css&lt;/code&gt;, embedding all the individual compiled chunks into a single file. &lt;/p&gt;

&lt;p&gt;Just include a &lt;code&gt;link&lt;/code&gt; tag on your page, and your styles should still be here.&lt;/p&gt;

&lt;p&gt;The whole project is available on GitHub: &lt;a href=&quot;https://github.com/jpetitcolas/webpack-react&quot;&gt;jpetitcolas/webpack-react&lt;/a&gt;. Don&amp;#39;t hesitate to browse through all commits, each one corresponding to a step of this post.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Transpiling EcmaScript6 code to ES5 using Babel</title>
   <link href="http://www.jonathan-petitcolas.com/2015/03/09/transpiling-es6-to-es5-using-babel.html"/>
   <updated>2015-03-09T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2015/03/09/transpiling-es6-to-es5-using-babel</id>
   <content type="html">&lt;p&gt;If you also watch &lt;a href=&quot;http://marmelab.com/en/&quot;&gt;marmelab blog&lt;/a&gt;, you have probably already heard of &lt;a href=&quot;https://github.com/marmelab/ng-admin&quot;&gt;ng-admin&lt;/a&gt;, the REST-based admin panel powered by Angular.js. Developed in good old EcmaScript5 JavaScript, it was time to make a step forward, introducing ES6 and its wide set of new features (a post on it soon).&lt;/p&gt;

&lt;p&gt;We, at marmelab, spent the last two weeks updating the ng-admin configuration classes to ES6. We voluntarily restricted the perimeter to do the spadework for this new JavaScript version. And, as admin configuration is independent of Angular.js, that&amp;#39;s the perfect target for our experiment.&lt;/p&gt;

&lt;p&gt;As always in web development, we can&amp;#39;t use a new technology, no matter how exciting, directly out of the box. To ensure browser compatibility, we need to transpile it into more common JavaScript. So, even if we write our code in ES6, we have to include a phase of transpiling, to convert it into pure ES5 code, understandable by all browsers.&lt;/p&gt;

&lt;h2&gt;Babel vs Traceur&lt;/h2&gt;

&lt;p&gt;There are two main ES6 to ES5 transpilers: &lt;a href=&quot;http://babeljs.io/&quot;&gt;Babel&lt;/a&gt; (formerly known as 6to5) and &lt;a href=&quot;https://github.com/google/traceur-compiler&quot;&gt;Traceur&lt;/a&gt;. We had to take one of them: Babel.&lt;/p&gt;

&lt;p&gt;The main reason we chose Babel is it doesn&amp;#39;t need any runtime extra script to run. Everything is done server-side. You just have to execute a compilation task once, and then deploy the compiled sources. At the opposite, Traceur needs to embed such a script, bringing an extra overhead. Yet, it should be nuanced, as we still need a polyfill (&lt;a href=&quot;https://github.com/zloirock/core-js&quot;&gt;core-js&lt;/a&gt;) for some missing browser methods, like &lt;code&gt;Array.from&lt;/code&gt;. &lt;/p&gt;

&lt;p&gt;Another issue is that Traceur is not compliant with &lt;a href=&quot;http://facebook.github.io/react/&quot;&gt;React.js&lt;/a&gt;. This is not a big deal in this case, but as we also use the Facebook framework at marmelab, let&amp;#39;s accumulate knowledge on a single technology. He who can do more can do less.&lt;/p&gt;

&lt;p&gt;And, icing on the cake, Babel has an &lt;a href=&quot;https://babeljs.io/repl/&quot;&gt;online REPL&lt;/a&gt; if you want to quickly give it a try.&lt;/p&gt;

&lt;h2&gt;How to use Babel to transpile your code?&lt;/h2&gt;

&lt;h3&gt;Turning your ES6 code to ES5 JavaScript&lt;/h3&gt;

&lt;p&gt;First, you need to install Babel:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;npm install babel --save-dev
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, let&amp;#39;s consider the following simple class:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kr&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;arguments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kr&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;View&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Compiling it into pure ES5 JavaScript is as simple as the following command:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;babel View.js
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By default it will output the file in standard output. You can of course redirect it to a file using the standard &lt;code&gt;&amp;gt;&lt;/code&gt; operator.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;babel View.js &amp;gt; build/View.js
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Babel modules&lt;/h3&gt;

&lt;p&gt;Previous example had no dependencies. Yet, what would happen if we had to import another class? Let&amp;#39;s experiment it right now:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kr&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;./View&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kr&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ListView&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kr&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;ListView&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Compile these two classes using the commands:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;babel View.js &amp;gt; build/View.js
babel ListView.js &amp;gt; build/ListView.js
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you open the &lt;code&gt;build/ListView.js&lt;/code&gt; file, you will see some calls to &lt;code&gt;require&lt;/code&gt; function:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_interopRequire&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;./View&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On ng-admin, we use &lt;a href=&quot;http://requirejs.org/&quot;&gt;requirejs&lt;/a&gt; to load our dependencies. So, I first thought I just had to embed &lt;code&gt;requirejs&lt;/code&gt; and that everything would work out of the box. Unfortunately, after several hours of debug, I learnt it wasn&amp;#39;t the case. Indeed, this &lt;code&gt;require&lt;/code&gt; call is not the same than the &lt;code&gt;require&lt;/code&gt; from &lt;code&gt;requirejs&lt;/code&gt;. While the first is related to CommonJS, &lt;code&gt;requirejs&lt;/code&gt; uses the AMD standard. &lt;/p&gt;

&lt;h4&gt;AMD? CommonJS? UMD?&lt;/h4&gt;

&lt;p&gt;I have always been confused about all these standards. I took profit of this project to clarify them. After digging the topic, it is simple.&lt;/p&gt;

&lt;p&gt;All of these standards aimed to simplify development of modular JavaScript. Asynchronous Module Definition (AMD) is the &lt;code&gt;requirejs&lt;/code&gt; module loader. It targets browsers only, and is supposed to simplify front-end development (even if I hardly found any more difficult to configure library).&lt;/p&gt;

&lt;p&gt;AMD modules are defined through the &lt;code&gt;define&lt;/code&gt; function, such as:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;dependencyA&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;dependencyB&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;dependencyA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dependencyB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;doSomething&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dependencyA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dependencyB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;CommonJS is based on the Node.js module definition. This is not compatible with &lt;code&gt;requirejs&lt;/code&gt;, but has been brought to front developers thanks to libraries such as &lt;code&gt;browserify&lt;/code&gt; or &lt;code&gt;webpack&lt;/code&gt;. Our previously AMD module would looks like the following in CommonJS:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dependencyA&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;dependencyA&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dependencyB&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;dependencyB&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;doSomething&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dependencyA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dependencyB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally, as neither AMD nor CommonJS succeeded in standing out from the crowd, another attempt of standardization emerged: Universal Module Definition (UMD). It has been built to be compatible with both of them.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;typeof&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;function&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;amd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// AMD&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;dependencyA&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;dependencyB&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;typeof&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;object&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Node, CommonJS-like&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;dependencyA&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;dependencyB&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Browser globals (root is window)&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;returnExports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;dependencyA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;dependencyB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;dependencyA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dependencyB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;doSomething&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dependencyA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dependencyB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}));&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Really ugly and verbose, isn&amp;#39;t it?&lt;/p&gt;

&lt;h4&gt;Using Babel with requirejs&lt;/h4&gt;

&lt;p&gt;So, we need AMD to be able to use &lt;code&gt;requirejs&lt;/code&gt; with Babel. Yet, Babel exports by default to the CommonJS format. Fortunately, we can specify it a &lt;code&gt;--modules&lt;/code&gt; option:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;babel --modules amd ListView.js
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Checking generated output shows that we are now compliant with &lt;code&gt;requirejs&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;exports&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;module&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;./View&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_View&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Testing with Babel&lt;/h2&gt;

&lt;p&gt;ng-admin uses two testing framework: Karma and Mocha. Here is how to configure these frameworks.&lt;/p&gt;

&lt;h3&gt;Karma&lt;/h3&gt;

&lt;p&gt;For Karma, we just have to install an extra package:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;npm install --save-dev karma-babel-preprocessor
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, update your &lt;code&gt;karma.conf.js&lt;/code&gt; configuration file:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span class=&quot;err&quot;&gt;config.set(&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;err&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;err&quot;&gt;plugins:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[/*&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*/&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;&amp;#39;karma-babel-preprocessor&amp;#39;],&lt;/span&gt;
    &lt;span class=&quot;err&quot;&gt;preprocessors:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;err&quot;&gt;&amp;#39;ng-admin/es6/lib/**/*.js&amp;#39;:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;&amp;#39;babel&amp;#39;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;err&quot;&gt;babelPreprocessor:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;err&quot;&gt;options:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;err&quot;&gt;modules:&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;quot;amd&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We add the freshly installed plug-in, specifying it to transpile to AMD module. We also have to specify which files should be transpiled, via the &lt;code&gt;preprocessors&lt;/code&gt; option.&lt;/p&gt;

&lt;h3&gt;Mocha&lt;/h3&gt;

&lt;p&gt;For Mocha, install process is similar and requires the &lt;code&gt;mocha-traceur&lt;/code&gt; plugin:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;npm install --save-dev mocha-traceur grunt-mocha-test
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We also installed the &lt;code&gt;grunt-mocha-test&lt;/code&gt; as we are using Grunt. Then, a little bit of configuration:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// Gruntfile.js&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;grunt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;initConfig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;mochaTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;mocha-traceur&amp;#39;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;src/javascripts/ng-admin/es6/tests/**/*.js&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;grunt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;loadNpmTasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;grunt-mocha-test&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// enable &amp;quot;grunt mochaTest&amp;quot; command&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you prefer using mocha directly, just specify the &lt;code&gt;compilers&lt;/code&gt; option:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;mocha --compilers js:mocha-traceur --recursive src/javascripts/ng-admin/es6/tests/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now you got the big picture on how we succeeded to rewrite ng-admin configuration classes using EcmaScript6. There is still a lot of work to do on ng-admin for a full migration. Don&amp;#39;t hesitate to &lt;a href=&quot;https://github.com/marmelab/ng-admin&quot;&gt;give a helping hand&lt;/a&gt;!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Playing with websockets in Go</title>
   <link href="http://www.jonathan-petitcolas.com/2015/01/27/playing-with-websockets-in-go.html"/>
   <updated>2015-01-27T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2015/01/27/playing-with-websockets-in-go</id>
   <content type="html">&lt;p&gt;I believe in Go language to achieve a lot in asynchronous world. With its system of channels, it is quite straightforward to
develop a multi-threaded application. We decided, with &lt;a href=&quot;https://twitter.com/brikou2&quot;&gt;Brice Bernard&lt;/a&gt;, to experiment this feature with websockets during one of our &lt;a href=&quot;http://www.marmelab.com&quot;&gt;marmelab&lt;/a&gt; hack day. Our objective: build a collaborative editing tool such as CollabEdit in Go. Hence GollabEdit. ;)&lt;/p&gt;

&lt;p&gt;We inspired ourselves from several chat application tutorials. Indeed, our application is pretty similar, except instead
of storing an array of messages, we store a whole document.&lt;/p&gt;

&lt;h2&gt;Executing Go in a Docker container&lt;/h2&gt;

&lt;p&gt;To not pollute our workstation with a wide set of softwares, each in several versions depending of the project,  we 
generally use Docker. So, let&amp;#39;s keep our system clean by creating the following &lt;code&gt;Dockerfile&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;FROM ubuntu:14.04

ENV HOME /root

RUN apt-get update &amp;amp;&amp;amp; apt-get upgrade --yes

RUN apt-get --yes --quiet install curl
RUN apt-get --yes --quiet install git
RUN apt-get --yes --quiet install mercurial

RUN cd /usr/local/src &amp;amp;&amp;amp; \
    curl https://storage.googleapis.com/golang/go1.3.1.linux-amd64.tar.gz | tar xz

ENV GOPATH /srv
ENV GOROOT /usr/local/src/go
ENV PATH ${PATH}:${GOROOT}/bin

WORKDIR /srv/

ENTRYPOINT [&amp;quot;go&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We base our container on an Ubuntu image on which we install Go dependencies. Then, we follow the
&lt;a href=&quot;https://golang.org/doc/install#install&quot;&gt;official procedure&lt;/a&gt; to install Go. Finally, we set some required environment
variables:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;GOPATH: folder containing our application and its dependencies&lt;/li&gt;
&lt;li&gt;GOROOT: folder containing Go binaries&lt;/li&gt;
&lt;li&gt;PATH: just for convenience purpose, to be able to call &lt;code&gt;go&lt;/code&gt; directly&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Finally, we make our container to execute the &lt;code&gt;go&lt;/code&gt; command when run thanks to the &lt;code&gt;ENTRYPOINT&lt;/code&gt; line.&lt;/p&gt;

&lt;p&gt;Our container is now ready to be built:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;docker build --tag=marmelab/go .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Thanks to the entrypoint previously configured, all the commands transmitted to our &lt;code&gt;docker run&lt;/code&gt; command will be transmitted
to the &lt;code&gt;go&lt;/code&gt; executable inside our container. To ensure it is fully functional, let&amp;#39;s write a simple &amp;quot;Hello World!&amp;quot; application:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// src/marmelab/gollabedit/main.go&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;fmt&amp;quot;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;hello world!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can now execute:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;docker run \
    --rm \
    --volume=&amp;quot;`pwd`:/srv&amp;quot; \
    --tty \
    --interactive \
    marmelab/go src/marmelab/gollabedit/main.go 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It should display &lt;code&gt;hello world!&lt;/code&gt; on your console. What are all of these arguments?&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--rm&lt;/code&gt;: just remove all container data between executions&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--volume&lt;/code&gt;: we map &lt;code&gt;pwd&lt;/code&gt; (present working directory) to the &lt;code&gt;/srv&lt;/code&gt; container folder&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--tty&lt;/code&gt;: connect &lt;code&gt;stdin&lt;/code&gt; and &lt;code&gt;stdout&lt;/code&gt; to our process, allowing to forward interruption signals such as &lt;code&gt;CTRL+C&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--interactive&lt;/code&gt;: required with &lt;code&gt;--tty&lt;/code&gt; option&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To ease our next commands, we can create a &lt;code&gt;makefile&lt;/code&gt; with these commands.&lt;/p&gt;

&lt;h2&gt;Using websockets in Go&lt;/h2&gt;

&lt;h3&gt;Creating a messages Hub&lt;/h3&gt;

&lt;p&gt;We used a centralized architecture: a central &lt;code&gt;Hub&lt;/code&gt; is going to receive all ingoing messages and to broadcast
them to each connected &lt;code&gt;Client&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kn&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;hub&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;clients&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;broadcast&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;register&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;unregister&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;hub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;broadcast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;   &lt;span class=&quot;nb&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;    &lt;span class=&quot;nb&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;unregister&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;  &lt;span class=&quot;nb&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;clients&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;     &lt;span class=&quot;nb&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;     &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We defined several channels for our &lt;code&gt;Hub&lt;/code&gt;. This way, we would be able to deal asynchronously with both &lt;code&gt;register&lt;/code&gt; and
&lt;code&gt;unregister&lt;/code&gt; events, or for broadcasting messages. At the end, we instantiate our hub.&lt;/p&gt;

&lt;p&gt;Let&amp;#39;s define its behavior thanks to a &lt;code&gt;run&lt;/code&gt; method:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clients&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;unregister&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ok&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clients&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ok&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clients&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;broadcast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;m&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;broadcastMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We take advantage here of the Go channels. Channels are like FIFO stacks. A &lt;code&gt;Client&lt;/code&gt; will store a request into one of
these channels, then go routine will unstack them as soon as possible, by their arrival dates.&lt;/p&gt;

&lt;p&gt;Syntax &lt;code&gt;c := &amp;lt;-h.register&lt;/code&gt; means attribute (&lt;code&gt;:=&lt;/code&gt;) to &lt;code&gt;c&lt;/code&gt; value first available value into &lt;code&gt;h.register&lt;/code&gt; channel. &lt;code&gt;&amp;lt;-&lt;/code&gt; shows
we take a value from the channel. As the opposite, you put a value in a channel with &lt;code&gt;-&amp;gt;&lt;/code&gt;. So, when a &lt;code&gt;Client&lt;/code&gt; wants to
register, we add him to our connected clients array, and then send him current content. &lt;code&gt;[]byte&lt;/code&gt; is just for casting
reasons, as we are going to see later in &lt;code&gt;Client&lt;/code&gt; code.&lt;/p&gt;

&lt;p&gt;If a customer sends an &lt;code&gt;unregister&lt;/code&gt; event, we just have to close its channel and remove him from &lt;code&gt;Hub&lt;/code&gt; connections.&lt;/p&gt;

&lt;p&gt;Finally, if we receive a message from one customer through the &lt;code&gt;broadcast&lt;/code&gt; channel, we just update &lt;code&gt;Hub&lt;/code&gt; content and
broadcast the message to all other clients with following function:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;broadcastMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;range&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clients&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// We can&amp;#39;t reach the client&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clients&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Do not forget the &lt;code&gt;break&lt;/code&gt; here. This is the reason why we exceeeded the deadline of our hackday, a missing &lt;code&gt;break&lt;/code&gt;. Thus,
after broadcasting first message, websocket closed itself unexpectedly, with a very vague Chrome error message. This is
the disadvantage of extreme programming: wanting to go still faster cause big time loss on trivial errors.&lt;/p&gt;

&lt;h3&gt;Client emitter&lt;/h3&gt;

&lt;p&gt;That&amp;#39;s all for the &lt;code&gt;Hub&lt;/code&gt;. Let&amp;#39;s focus on &lt;code&gt;Client&lt;/code&gt; code now:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kn&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&amp;quot;time&amp;quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;writeWait&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Second&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;pongWait&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Second&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;pingPeriod&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pongWait&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;maxMessageSize&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;ws&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;websocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Conn&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note we defined several constants used later:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;writeWait&lt;/code&gt;: minimal delay before writing new message into socket&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pongWait&lt;/code&gt;: if a socket doesn&amp;#39;t answer within this time range, consider &lt;code&gt;Client&lt;/code&gt; is disconnected&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pingPeriod&lt;/code&gt;: period on which we test &lt;code&gt;Client&lt;/code&gt; connection&lt;/li&gt;
&lt;li&gt;&lt;code&gt;maxMessageSize&lt;/code&gt;: maximum message size, here 1kB.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Our main &lt;code&gt;Client&lt;/code&gt; method is:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&amp;quot;net/http&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&amp;quot;log&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&amp;quot;github.com/gorilla/websocket&amp;quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;upgrader&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;websocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Upgrader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;ReadBufferSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;  &lt;span class=&quot;nx&quot;&gt;maxMessageSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;WriteBufferSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;maxMessageSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;serveWs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ResponseWriter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;GET&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Method not allowed&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;405&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;ws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;upgrader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Upgrade&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;maxMessageSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;ws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;register&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;writePump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;readPump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We first define a &lt;code&gt;websocket.Upgrader&lt;/code&gt;, taken from the &lt;a href=&quot;http://www.gorillatoolkit.org/pkg/websocket&quot;&gt;gorilla/webwocket&lt;/a&gt;
library. Then we retrieve a pointer to the websocket thanks to the &lt;code&gt;Upgrade&lt;/code&gt; function. Finally, we register the &lt;code&gt;Client&lt;/code&gt;
to the &lt;code&gt;Hub&lt;/code&gt;, stacking a message in the &lt;code&gt;register&lt;/code&gt; channel. &lt;/p&gt;

&lt;p&gt;At the end, we can see we started a &lt;code&gt;writePump&lt;/code&gt; and a &lt;code&gt;readPump&lt;/code&gt;. Let&amp;#39;s dive into the first:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;readPump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;unregister&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}()&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SetReadLimit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;maxMessageSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SetReadDeadline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pongWait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SetPongHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; 
        &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SetReadDeadline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pongWait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ReadMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;broadcast&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We &lt;code&gt;defer&lt;/code&gt; the execution of &lt;code&gt;Client&lt;/code&gt; disconnection. This mean that, either parent function succeeds of fails, this code
will be executed.&lt;/p&gt;

&lt;p&gt;We set some properties on our websocket to ensure it won&amp;#39;t hang indefinitely. Websocket first waits for a message during
maximum &lt;code&gt;pongWait&lt;/code&gt; seconds. If socket is still available when pinging it, we increase read limit duration by &lt;code&gt;pongWait&lt;/code&gt;
seconds. So, if &lt;code&gt;Client&lt;/code&gt; is no more connected, websocket is going to throw an error, which will break the &lt;code&gt;for&lt;/code&gt; loop below.
We should then unregister.&lt;/p&gt;

&lt;p&gt;We can read data, but what&amp;#39;s happening under the hood of &lt;code&gt;writePump&lt;/code&gt;?&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;writePump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;ticker&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;NewTicker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pingPeriod&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;ticker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}()&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ok&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ok&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;websocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CloseMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{})&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;websocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;TextMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ticker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;websocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;PingMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{});&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;mt&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SetWriteDeadline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;writeWait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;WriteMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;mt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Code is pretty similar to the &lt;code&gt;readPump&lt;/code&gt;. We just introduced a &lt;code&gt;ticker&lt;/code&gt;. Regularly, we are going to ping the websocket.
If it doesn&amp;#39;t respond, we close the websocket.&lt;/p&gt;

&lt;h3&gt;Launching websocket server&lt;/h3&gt;

&lt;p&gt;Let&amp;#39;s assemble all the pieces in &lt;code&gt;main.go&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kn&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&amp;quot;log&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&amp;quot;net/http&amp;quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;FileServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;./public&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Fatal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ListenAndServe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;:8080&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We simply run our &lt;code&gt;Hub&lt;/code&gt; as a go-routine (in parallel) and create an HTTP server. The only &lt;code&gt;/ws&lt;/code&gt; route launch the data
pumps. All static resources should be in the &lt;code&gt;public&lt;/code&gt; folder.&lt;/p&gt;

&lt;p&gt;To launch our server, you should first retrieve &lt;code&gt;gorilla/websocket&lt;/code&gt; dependency:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;docker run \
    --rm \
    --volume=&amp;quot;`pwd`:/srv&amp;quot; \
    --tty \
    --interactive \
    marmelab/go get github.com/gorilla/websocket
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, just execute:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;docker run \
    --rm \
    --volume=&amp;quot;`pwd`:/srv&amp;quot; \
    --tty \
    --interactive \
    --publish=&amp;quot;8080:8080&amp;quot; \
    marmelab/go run src/marmelab/gollabedit/*.go 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We added a &lt;code&gt;--publish&lt;/code&gt; option here, to map our host 8080 port to our Docker container 8080 port. So, if you connect to 
&lt;code&gt;http://0.0.0.0:8080&lt;/code&gt; it will connect to your Go webserver.&lt;/p&gt;

&lt;h2&gt;Collaborative editing front&lt;/h2&gt;

&lt;p&gt;For our prototype needs, we didn&amp;#39;t use any library. If you need a good support of websockets, have a look on
&lt;a href=&quot;http://socket.io/&quot;&gt;Socket.io&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Our UI is damn simple: a simple textarea. So, let&amp;#39;s rather focus on websocket connection:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;WebSocket&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;#content&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;conn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WebSocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;ws://&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;host&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;/ws&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Textarea is editable only when socket is opened.&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;onopen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;disabled&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;onclose&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;disabled&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Whenever we receive a message, update textarea&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;onmessage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;timeoutId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;typingTimeoutId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;isTyping&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;keydown&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;isTyping&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clearTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;typingTimeoutId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;doc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;keyup&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;typingTimeoutId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;isTyping&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clearTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;timeoutId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;timeoutId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;isTyping&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;doc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Code is self-explained. The only particularity is our basic anti-flood protection. If you send a new payload at each keydown,
you are going to get a serious bottleneck on your server. So, be smarter using timeouts: we send data only if user hasn&amp;#39;t
typed for the last second. This is a good compromise.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/posts/websockets.gif&quot; alt=&quot;Websockets sample&quot; title=&quot;Websockets sample&quot; width=&quot;600&quot; style=&quot;padding: 0;&quot; /&gt;&lt;/p&gt;

&lt;h2&gt;Going further?&lt;/h2&gt;

&lt;p&gt;If you try it as civilized gentlemen, one after each, everything is going to work fine. But, if you change the document
exactly at the same time, here comes some troubles...&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;1. Initial document is: &amp;quot;Hello world!&amp;quot;
2. User A changes &amp;quot;Hello&amp;quot; to &amp;quot;Good morning&amp;quot;
3. Meanwhile, user B changes &amp;quot;world&amp;quot; to &amp;quot;everybody&amp;quot;
4. Server receives first B request, then A request. 
    a. Hub changes &amp;quot;Hello world&amp;quot; to &amp;quot;Good morning world!&amp;quot;
    b. A and B receives &amp;quot;Good morning world!&amp;quot;
    c. Hub changes &amp;quot;Good morning world!&amp;quot; to &amp;quot;Hello everybody!&amp;quot;
    d. A and B receives &amp;quot;Hello everybody!&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Thus, user A changes have been lost. Furthermore, document should have blink between 4b and 4d. This is the core of
concurrent edition issues. Our hackday is now well overran, and problematic is so complex it requires further investigation.
By lack of time, we had to stop here.&lt;/p&gt;

&lt;p&gt;We thought to a solution, consisting to use Git and its branch system. For instance, initial document is &lt;code&gt;master&lt;/code&gt;. User A
creates a &lt;code&gt;user_a&lt;/code&gt; branch and user B a &lt;code&gt;user_b&lt;/code&gt; branch. Hub is in charge of merging each branches into master. If there is
a conflict, then UI could show the diff and asks for user which version he would like to keep.&lt;/p&gt;

&lt;p&gt;If you want to try it at home, code is available on &lt;a href=&quot;https://github.com/marmelab/GollabEdit&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Creating JSON Web Token in JavaScript</title>
   <link href="http://www.jonathan-petitcolas.com/2014/11/27/creating-json-web-token-in-javascript.html"/>
   <updated>2014-11-27T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2014/11/27/creating-json-web-token-in-javascript</id>
   <content type="html">&lt;p&gt;I challenged myself during last weeks to implement an authentication on a freshly created API. After digging around, I found that one of the best solution would be JSON Web Tokens. As understanding a concept passes by experimenting it, here is a post describing how to forge such a token in JavaScript.&lt;/p&gt;

&lt;h2&gt;What is JSON Web Token (JWT)?&lt;/h2&gt;

&lt;p&gt;JSON Web Token (JWT) is an easy way to secure an API. When a user authenticates first on a server, using for instance a standard login form, the server creates a token. This token includes some personal data, such as username or email address. Then, this token is signed server-side (to prevent token integrity), and sent back to the user. Within each next request, user sends the token to establish emitter identity.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;Client application                                            API
    --------                                              -----------
        |                                                      |
        |                   GET /api/employees                 |
        |-----------------------------------------------------&amp;gt;|
        |                     403 Forbidden                    |
        |&amp;lt;-----------------------------------------------------| 
        |                                                      |
        |                                                      |
        |                 POST /api/authenticate               |
        |     { login: &amp;quot;john.doe&amp;quot;, password: &amp;quot;password&amp;quot; }      |
        |-----------------------------------------------------&amp;gt;|
        |                      200 Success                     |
        |             { token: &amp;quot;my.personal.token&amp;quot; }           |
        |&amp;lt;-----------------------------------------------------|
        |                                                      |
        |                                                      |
        |                 GET /api/employees                   |
        | Header { &amp;quot;Authorization: Token &amp;quot;my.personal.token&amp;quot; } |
        |-----------------------------------------------------&amp;gt;|
        |                      200 Success                     |
        |&amp;lt;-----------------------------------------------------| 
        |                                                      |
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;JSON Web Token is composed of three main parts:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Header: normalized structure specifying how token is signed (generally using HMAC SHA-256 algorithm)&lt;/li&gt;
&lt;li&gt;Free set of claims embedding whatever you want: username, email, roles, expiration date, etc.&lt;/li&gt;
&lt;li&gt;Signature ensuring data integrity&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Forging a JSON Web Token in JavaScript&lt;/h2&gt;

&lt;p&gt;JSON Web Tokens may be resumed by the following equations:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;unsignedToken = base64url(header) + &amp;quot;.&amp;quot; + base64url(data)
JWT = unsignedToken + &amp;quot;.&amp;quot; + base64url(HMAC256(unsignedToken, secret))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Base64 URL encoding&lt;/h3&gt;

&lt;p&gt;Note I wrote &lt;code&gt;base64url&lt;/code&gt;, not &lt;code&gt;base64&lt;/code&gt;. There is indeed &lt;a href=&quot;https://tools.ietf.org/html/rfc4648#page-7&quot;&gt;two small differences&lt;/a&gt; between these two encodings:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;There is no &lt;code&gt;=&lt;/code&gt; padding at the end,&lt;/li&gt;
&lt;li&gt;&lt;code&gt;+&lt;/code&gt; and &lt;code&gt;/&lt;/code&gt; characters are replaced by &lt;code&gt;-&lt;/code&gt; and &lt;code&gt;_&lt;/code&gt; respectively.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Implementing such a function can be achieved in JavaScript:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;base64url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// Encode in classical base64&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;encodedSource&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;CryptoJS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;enc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Base64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;stringify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;// Remove padding equal characters&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;encodedSource&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;encodedSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/=+$/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;// Replace characters according to base64url specifications&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;encodedSource&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;encodedSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/\+/g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;-&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;encodedSource&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;encodedSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/\//g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;_&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;encodedSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I use &lt;a href=&quot;https://github.com/evanvosberg/crypto-js&quot;&gt;CryptoJS library&lt;/a&gt; to achieve the standard &lt;code&gt;base64&lt;/code&gt; encoding. This is a useful library whenever you want to assume some cryptographic, hashing or encoding tasks. This is perfectly the case, with the incoming HMAC signature.&lt;/p&gt;

&lt;p&gt;To make this function work, you have to specify source as an array of UTF-8 bytes. It can easily be achieved using another utility function of CryptoJS: &lt;code&gt;Utf8.parse&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;Hello!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 48 65 6c 6c 6f 21&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CryptoJS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;enc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Utf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This extra call is not included into the &lt;code&gt;base64url&lt;/code&gt; function for signature commodity. But you are going to notice it later. &lt;/p&gt;

&lt;h3&gt;Creating our unsigned token&lt;/h3&gt;

&lt;p&gt;We can now encode our header and claims. Header is normalized, and contains two &lt;code&gt;alg&lt;/code&gt; and &lt;code&gt;typ&lt;/code&gt; fields indicating the used signature algorithm.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;alg&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;HS256&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;typ&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;JWT&amp;quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;stringifiedHeader&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;CryptoJS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;enc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Utf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;stringify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;encodedHeader&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;base64url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;stringifiedHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1337&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;username&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;john.doe&amp;quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;stringifiedData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;CryptoJS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;enc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Utf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;stringify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;encodedData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;base64url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;stringifiedData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;encodedHeader&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;.&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;encodedData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After executing this first snippet, we got our unsigned token:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTMzNywidXNlcm5hbWUiOiJqb2huLmRvZSJ9
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Signing our token&lt;/h3&gt;

&lt;p&gt;Finally, to ensure our token integrity, we should sign it with a secret. Signature is the HMAC SHA-256 (as specified in header) of our current token. And as usual, we should &lt;code&gt;base64url&lt;/code&gt; encode it.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;secret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;My very confidential secret!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;signature&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;CryptoJS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;HmacSHA256&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;secret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;signature&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;base64url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;signature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;signedToken&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;.&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;signature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;No need of &lt;code&gt;Utf8.parse&lt;/code&gt; the output of &lt;code&gt;HmacSHA256&lt;/code&gt;. It is indeed already an array of UTF-8 characters. That&amp;#39;s why I didn&amp;#39;t include this method in our &lt;code&gt;base64url&lt;/code&gt; function. &lt;/p&gt;

&lt;p&gt;Of course, you shouldn&amp;#39;t share your secret client-side. Tokens should be forged server-side. Otherwise, everyone would be able to modify your tokens and pass them as genuine.&lt;/p&gt;

&lt;p&gt;If you execute this code, your signed token should look like:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;
    &lt;pre style=&quot;overflow-wrap: break-word;&quot;&gt;&lt;code&gt;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTMzNywidXNlcm5hbWUiOiJqb2huLmRvZSJ9.EvTdOJSfbffGHLyND3BMDwWE22zUBOCRspPZEHlNEw&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;There is plenty of libraries dealing with JWT. Forging tokens by hand is only a good idea to learn how they work. On a real project, don&amp;#39;t reinvent the wheel and use existing third-part tools, such as &lt;a href=&quot;https://github.com/lexik/LexikJWTAuthenticationBundle&quot;&gt;LexikJWTAuthenticationBundle&lt;/a&gt; for Symfony2 users or &lt;a href=&quot;https://github.com/auth0/node-jsonwebtoken&quot;&gt;node-jsonwebtoken&lt;/a&gt; for Node.js developers.&lt;/p&gt;

&lt;p&gt;The full code of this post is available as a &lt;a href=&quot;http://codepen.io/jpetitcolas/pen/zxGxKN&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Another interesting resource: &lt;a href=&quot;http://jwt.io/&quot;&gt;JWT.io&lt;/a&gt;&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Parsing binary files in Go</title>
   <link href="http://www.jonathan-petitcolas.com/2014/09/25/parsing-binary-files-in-go.html"/>
   <updated>2014-09-25T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2014/09/25/parsing-binary-files-in-go</id>
   <content type="html">&lt;p&gt;I am currently working on a Go library to parse Starcraft2 replay files. These files are stored in binary format (called
MoPaQ) where each sequence of bytes is related to a specific information. For instance, the four bytes at position 8
represents the header offset, which is 1024. It means that real game data are going to start at the 1024th byte.&lt;/p&gt;

&lt;p&gt;I won&amp;#39;t cover the whole MoPaQ parsing in this post. I will probably write a dedicated article for it when I&amp;#39;ll get
satisfactory results. Instead, here is an elegant way Go offers to parse binary files. As a support, you can download
one of my &lt;a href=&quot;/assets/2014/09/catallena.SC2Replay&quot;&gt;replay file&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Browsing the Internet gave me the following truncated data structure for MoPaQ header:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;Attribute           Location            Hexadecimal value   Meaning
-----------------------------------------------------------------------------------------------
Format              0x0000 -&amp;gt; 0x0003    4D 50 51 1B         MPQ\x1b (format name)
UserDataMaxSize     0x0004 -&amp;gt; 0x0007    00 02 00 00         512
HeaderOffset        0x0008 -&amp;gt; 0x0011    00 04 00 00         1024
UserDataSize        0x0012 -&amp;gt; 0x0015    3C 00 00 00         60
                    0x0016 -&amp;gt; 0x0020    05 08 00 02 2C      ?
Starcraft2          0x0021 -&amp;gt; 0x0042    53 74 61 [...]      &amp;quot;Starcraft II Replay 11&amp;quot; in binary
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So, let&amp;#39;s start by loading our file:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kn&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&amp;quot;fmt&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&amp;quot;log&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&amp;quot;os&amp;quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;data/replay.SC2Replay&amp;quot;&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Fatal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;Error while opening file&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;%s opened\n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This code is pretty straightforward: we use the &lt;code&gt;os&lt;/code&gt; library to manipulate file, and just ensure we did not encounter
any error during this process. The main point here is the &lt;code&gt;defer&lt;/code&gt; statement: it ensures the &lt;code&gt;file.Close()&lt;/code&gt; function is
called as soon as we exit current function, whether it fails or succeeds.&lt;/p&gt;

&lt;p&gt;Then, let&amp;#39;s ensure it is a valid Starcraft2 replay file checking the format name at the beginning:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;formatName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;readNextBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;Parsed format: %s\n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;formatName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;formatName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;MPQ\x1b&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Fatal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;Provided replay file is not in correct format.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;readNextBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;bytes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([]&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Fatal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;bytes&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The most interesting part of this code is the &lt;code&gt;readNextBytes&lt;/code&gt; function. It takes two parameter: the file pointer and a
number of bytes to read. First step, we instanciate a slice of bytes to store our result. In this case, slice is equivalent
to an array with a fixed size of &lt;code&gt;number&lt;/code&gt; bytes. Then, we put into our slice as many bytes as we can through the &lt;code&gt;file.Read&lt;/code&gt;
function.&lt;/p&gt;

&lt;p&gt;You can notice it returns several arguments (another great feature of Go). The first one is the number of read bytes. As
we do not have any use of it, we simply ignore it via the use of an underscore (the equivalent of &lt;code&gt;/dev/null&lt;/code&gt; for Go
variables). The second returned value is error. If it is not &lt;code&gt;nil&lt;/code&gt;, let&amp;#39;s log the error message.&lt;/p&gt;

&lt;p&gt;Finally, we check the format casting our bytes array into a string and ensuring it is equal to &lt;code&gt;MPQ\x1b&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Now we get a valid file, we may continue our parsing manually, using the &lt;code&gt;readNextByte&lt;/code&gt; function to get every next
sequences of bytes. However, there is a far more elegant way, achieved in two simple steps.&lt;/p&gt;

&lt;p&gt;First, define a structure to store all the parsed attributes:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kd&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Header&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;UserDataMaxSize&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint32&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;HeaderOffset&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint32&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;UserDataSize&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint32&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;Starcraft2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;According to our investigations, after format comes the &lt;code&gt;UserDataMaxSize&lt;/code&gt;, encoded on 4 bytes. As it is an integer,
let&amp;#39;s wrap it into an &lt;code&gt;uint32&lt;/code&gt;, which is also encoded on 4 bytes. Respecting fields length using correct types is the key point
here, as binary parsing is based on structure fields memory allocation.&lt;/p&gt;

&lt;p&gt;Notice the attribute &lt;code&gt;_&lt;/code&gt;. As previously seen, it means we don&amp;#39;t care about it. And as we got 5 unknown bytes, it is important
to pinpoint this offset to not parse it. In this case, we simply move the cursor five bytes forward. We may get several
&lt;code&gt;_&lt;/code&gt; if required.&lt;/p&gt;

&lt;p&gt;Now, here is the magical glue between our structure and file:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&amp;quot;bytes&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&amp;quot;encoding/binary&amp;quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;readNextBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;39&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 4 * uint32 (3) + 5 * byte (1) + 22 * byte (1) = 43&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;buffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;NewBuffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;binary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;binary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;LittleEndian&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Fatal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;binary.Read failed&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;Parsed data:\n%+v\n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We read the first 43 bytes, corresponding to the size of our structure. Then, we instantiate a new bytes buffer we are
going to map to our structure through a binary reader. The second argument specifies the &lt;a href=&quot;http://en.wikipedia.org/wiki/Endianness&quot;&gt;Endianess&lt;/a&gt;
of our data: in other words, the way bytes are stored. With &lt;code&gt;binary.LittleEndian&lt;/code&gt;, it means the least significant byte is
stored in the smallest address, at the end of a given bytes sequence.&lt;/p&gt;

&lt;p&gt;That&amp;#39;s all folks! In simply three lines of code, we were able to parse our binary file. Go is so magic, isn&amp;#39;t it?&lt;/p&gt;

&lt;p&gt;Note: the whole code is available as a &lt;a href=&quot;https://gist.github.com/jpetitcolas/28893445d8062d7081d5&quot;&gt;Gist&lt;/a&gt;.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Improve your Linux battery life with TLP</title>
   <link href="http://www.jonathan-petitcolas.com/2014/08/22/improve-linux-battery-life-tlp.html"/>
   <updated>2014-08-22T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2014/08/22/improve-linux-battery-life-tlp</id>
   <content type="html">&lt;p&gt;I used to work on Windows, using some virtual machines for development. It is a good system, and I would have probably
never changed if I was not using &lt;a href=&quot;https://www.docker.com/&quot;&gt;Docker&lt;/a&gt;. Indeed, Docker is based on &lt;strong&gt;LinuX&lt;/strong&gt; Containers (LXC),
which obviously are not available on Windows. And booting a heavy VM to start a lightweight Docker container is not an
acceptable option. That&amp;#39;s why I decided to switch.&lt;/p&gt;

&lt;p&gt;Transition was pretty straightforward, and I had only three main issues:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;HDMI port did not (and still doesn&amp;#39;t) work. Not a big deal as I also got a VGA port.&lt;/li&gt;
&lt;li&gt;Laptop battery life drastically reduced: from 3 hours on Windows, I get only an hour on Linux.&lt;/li&gt;
&lt;li&gt;CPU fan rejected very hot air. Nice feature yet: I had now a laptop/hair dryer. ;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The two last points are linked. The CPU runs at the maximum of its capabilities, draining a lot of energy from the battery
and thus overheating. Fortunately, I found a quick and easy solution: using &lt;a href=&quot;http://linrunner.de/en/tlp/docs/tlp-linux-advanced-power-management.html&quot;&gt;tlp package&lt;/a&gt;.
This tool setups automatically all the requirements for an efficient power management, without having to spend several days to
hack each utilities, hoping to not break your whole system. ;)&lt;/p&gt;

&lt;p&gt;It takes care automatically of CPU scaling, hard disk management, Wifi power saving, etc. To install it, simply execute
the following:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;c&quot;&gt;# Installing TLP&lt;/span&gt;
sudo add-apt-repository ppa:linrunner/tlp
sudo apt-get update
sudo apt-get install tlp tlp-rdw

&lt;span class=&quot;c&quot;&gt;# Running TLP (only required at first time)&lt;/span&gt;
sudo tlp start
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The manual start is only required the first time as TLP is already configured to start at boot. If you want to be sure it is,
just launch the &lt;code&gt;tlp-stat&lt;/code&gt; command and ensure it is enabled:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;sudo tlp-stat &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; grep &lt;span class=&quot;s2&quot;&gt;&amp;quot;power save&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After installing this software, the two last bullets are now solved and my battery lasts more than 2 hours, which is acceptable
even if still below of Windows. Why is this utility not shipped by default with every Linux desktop distributions? It will save
some headaches for some Linux adopters, and would also be a small step against global warming.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Fibonacci sequence generator in Go</title>
   <link href="http://www.jonathan-petitcolas.com/2014/08/18/fibonacci-generator-in-go.html"/>
   <updated>2014-08-18T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2014/08/18/fibonacci-generator-in-go</id>
   <content type="html">&lt;p&gt;When completing one of the mathematical challenge of &lt;a href=&quot;https://projecteuler.net/&quot;&gt;Project Euler&lt;/a&gt;, I had to compute some
Fibonacci numbers. I found, with the help of &lt;a href=&quot;http://redotheweb.com/&quot;&gt;François Zaninotto&lt;/a&gt;, a very elegant way to get the
terms of this famous sequence, based on a &lt;a href=&quot;http://codereview.stackexchange.com/a/28445&quot;&gt;StackOverflow answer&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;As a reminder, the Fibonacci sequence is defined as:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/posts/fibonacci.gif&quot; alt=&quot;Fibonacci sequence definition&quot; title=&quot;Fibonacci sequence definition&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A very naive and simple way to implement it would be the following:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;GetFibonacci&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;second&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rank&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rank&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rank&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;second&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;GetFibonacci&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;second&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rank&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;GetFibonacci&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;second&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rank&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is just a retranscription of previous formulas. But using Go in this case does not bring anything special. So, here
is a more elegant and Go-friendly way, including a generator:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;FibonacciGenerator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;second&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;second&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}()&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As the initial conditions may vary, we parametrize the first and second Fibonacci terms. Then, we create a new channel
containing only integers with the &lt;code&gt;make&lt;/code&gt; function. Consider a channel like a FIFO stack: you can insert some values in
it with the &lt;code&gt;-&amp;gt;&lt;/code&gt; (move towards) operator or consume them with &lt;code&gt;&amp;lt;-&lt;/code&gt; (take from). This is the most awesome and damn simple
feature of Go language. With channels, you can prevent your code from becoming a callback hell all Node.js developers
already experienced.&lt;/p&gt;

&lt;p&gt;Then, we declare an anonymous go-routine. A Go routine is simply executed in a separate thread. Just think about it as
an asynchronous function. All the Fibonacci logical is located in the &lt;code&gt;for&lt;/code&gt; clause, using the possibility to assign
several variables with a single &lt;code&gt;=&lt;/code&gt; operator. The following line is the key one: we write &lt;code&gt;i&lt;/code&gt; value into the channel.
Yet, writing into a channel blocks current thread until the value is read. In this case, it simply yield the returned
Fibonacci term.&lt;/p&gt;

&lt;p&gt;To write a list of 10 first Fibonacci numbers, you can simply use the following code:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;fmt&amp;quot;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Generator code&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;generator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;FibonacciGenerator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So short but elegant code... The more in Go I develop, the more addicted I become! :)&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Changing Arduino RGBL color through a web interface</title>
   <link href="http://www.jonathan-petitcolas.com/2014/05/26/change-arduino-led-color-from-web-interface.html"/>
   <updated>2014-05-26T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2014/05/26/change-arduino-led-color-from-web-interface</id>
   <content type="html">&lt;p&gt;After the first tutorial about &lt;a href=&quot;http://www.jonathan-petitcolas.com/2014/03/16/creating-morse-encoder-with-arduino.html&quot;&gt;a morse encoder with Arduino&lt;/a&gt;, I decided to go further: using a web interface to drive my board. To achieve this purpose, I used the &lt;a href=&quot;https://github.com/rwaldron/johnny-five&quot;&gt;Johnny Five framework&lt;/a&gt; (allowing to program on Arduino with Javascript) and &lt;a href=&quot;http://www.socket.io&quot;&gt;Socket.io&lt;/a&gt; for communication between the browser and the circuit.&lt;/p&gt;

&lt;p&gt;Here is a demonstration video of the expected result:&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;//www.youtube.com/embed/PChgksbXZL0?rel=0&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;

&lt;p&gt;If you just want to grab the source code, here is the &lt;a href=&quot;https://github.com/jpetitcolas/arduino-experiments/tree/master/led-colorpicker&quot;&gt;GitHub link&lt;/a&gt;.&lt;/p&gt;

&lt;h2&gt;Wiring our RGB LED&lt;/h2&gt;

&lt;p&gt;First step is of course to create our circuit. We will need a RGB LED and three 330Ω resistors. The RGB LED (RGBL) is easily recognizable with its four pins. Longest should be linked to the ground. If you put the longest pin at second position, red will be the first, green and blue the third and fourth respectively. Do not forget to add some resistors to avoid to burn out them:&lt;/p&gt;

&lt;p class=&quot;center&quot;&gt;
    &lt;img src=&quot;/img/posts/arduino/rgbl/circuit.png&quot; alt=&quot;Changing Arduino RGBL color through a web interface&quot; title=&quot;Changing Arduino RGBL color through a web interface&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;A RGB LED is simply the association of three LEDs of three different colors (red, blue and green). Gathering them allows you to produce a wide range of colorful lights.&lt;/p&gt;

&lt;p&gt;And here is the textual description of the breadboard:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;RGBL: four pins on A1, A2 (longest pin), A3 and A4&lt;/li&gt;
&lt;li&gt;Resistors: E1/F1, E3/F3, E4/F4&lt;/li&gt;
&lt;li&gt;Ground: C2&lt;/li&gt;
&lt;li&gt;Arduino pin 9~: J1 (red pin)&lt;/li&gt;
&lt;li&gt;Arduino pin 10~: J3 (green pin)&lt;/li&gt;
&lt;li&gt;Arduino pin 11~: J4 (blue pin)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We are using here some analogic-like Arduino outputs (symbolized by a tilde &lt;code&gt;~&lt;/code&gt; near the pin number) as we need some values from 0 to 255. Indeed, with only a binary field, we would only be able to switch on or off each LED, without adjusting their respective intensity. Yet, the Arduino is only capable to output binary signal. That&amp;#39;s why this is not pure analogic signal but simulated one. This is done through a physical trick called pulse width modulation (PWM).&lt;/p&gt;

&lt;h3&gt;Understanding the pulse width modulation (PWM)&lt;/h3&gt;

&lt;p&gt;Pulse Width Modulation (PWM) is a physical trick to simulate an analogic signal from a binary one. It plays with the average voltage of a square wave: if the frequency of this signal is high, we can assimilate the output voltage to the average value of high and low level, ponderated by their respective duration.&lt;/p&gt;

&lt;p&gt;For instance, let&amp;#39;s imagine the following signal, where the period &lt;code&gt;T&lt;/code&gt; is very short:&lt;/p&gt;

&lt;figure style=&quot;max-width: 600px;&quot;&gt;
    &lt;img src=&quot;/img/posts/arduino/rgbl/pulse-wide-wave.svg&quot; title=&quot;Square wave&quot; title=&quot;Square wave&quot; /&gt;
    &lt;figcaption&gt;Square wave - Source: &lt;a href=&quot;http://commons.wikimedia.org/wiki/File:Pulse_wide_wave.svg&quot;&gt;MatthiasDD, via Wikimedia&lt;/a&gt;&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;The average output would simply be &lt;code&gt;(t/T) * Vmax&lt;/code&gt;. This way, it is possible to emulate an output of a wide range of values, from 0V (t&amp;nbsp;=&amp;nbsp;0, a null signal) to 5V (t = T, a full +Vmax signal), just switching the signal on and off with different timings.&lt;/p&gt;

&lt;p&gt;So, now we got the really basic principle of PWM (for more detailed explanations, see &lt;a href=&quot;http://en.wikipedia.org/wiki/Pulse-width_modulation&quot;&gt;Wikipedia&lt;/a&gt;), let&amp;#39;s go back to our IDE!&lt;/p&gt;

&lt;h2&gt;Introducing Johnny Five, the Arduino Javascript framework&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/rwaldron/johnny-five&quot;&gt;Johnny Five&lt;/a&gt; is a Javascript Arduino framework, allowing us to control our circuit using our favorite language. Far more developer friendly than Arduino native language, it will also provide us an easy way to interact with our prototype using websockets.&lt;/p&gt;

&lt;h3&gt;Bootstrapping Johnny Five&lt;/h3&gt;

&lt;p&gt;First, let&amp;#39;s bootstrap our new Node.js LED color picker application, creating a &lt;code&gt;package.json&lt;/code&gt; file in our project folder:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&amp;quot;dependencies&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;johnny-five&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;latest&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, retrieve it effectively using a &lt;code&gt;npm install&lt;/code&gt;. Here is our first testing program:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;five&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;johnny-five&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;led&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;five&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ready&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;led&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;five&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Led&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;RGB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;led&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pulse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;repl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;inject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;led&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;led&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After embedding Johnny Five framework, we wait for our board &lt;code&gt;ready&lt;/code&gt; event. It is the equivalent of DOM ready for our Arduino. Then, we instantiate a new RGB LED, plugged on pins 9, 10 and 11 (for red, green and blue respectively), and then we make our LED pulsing, ie fading between off and on states. As you can see, it is far more intuitive than pure Arduino language.&lt;/p&gt;

&lt;p&gt;Finally, we inject to the interactive shell our LED object. This will allow to manipulate our LED directly through a prompt, with autocompletion and console. So useful for debugging! For instance:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&amp;gt;&amp;gt; led. # Pressing Tab
led.__defineGetter__      led.__defineSetter__      led.__lookupGetter__
led.__lookupSetter__      led.constructor           led.hasOwnProperty
led.isPrototypeOf         led.propertyIsEnumerable  led.toLocaleString
led.toString              led.valueOf

led.brightness            led.color                 led.fade
led.fadeIn                led.fadeOut               led.off
led.on                    led.pulse                 led.stop
led.strobe                led.toggle

led.blue                  led.board                 led.green
led.id                    led.io                    led.pins
led.red

&amp;gt;&amp;gt; led.off();
undefined
&amp;gt;&amp;gt; console.log(led.color)
[Function]
undefined
&amp;gt;&amp;gt; console.log(led.color())
{ red: 0, green: 0, blue: 0 }
undefined
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To compile and upload your program, simply launch your script:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;c&quot;&gt;# Launching as root for access to /dev/ttyUSB0&lt;/span&gt;
sudo node main.js
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If everything has been set up correctly, your LED should go blink smoothly.&lt;/p&gt;

&lt;h3&gt;Listening websockets from Arduino&lt;/h3&gt;

&lt;p&gt;Next step is to make our Arduino listening websockets. This way, we would be able to manipulate it from everywhere, including a web browser. No surprise here, we are going to use &lt;a href=&quot;http://socket.io/&quot;&gt;Socket.io&lt;/a&gt;. So, add it to your &lt;code&gt;package.json&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&amp;quot;dependencies&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;socket.io&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;latest&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And re-run &lt;code&gt;npm install&lt;/code&gt;. Then, let&amp;#39;s dive into the simplicity of this reference library. Edit your &lt;code&gt;main.js&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;io&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;socket.io&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8080&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ready&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;led&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;five&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Led&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;RGB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;led&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// No more pulse here&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sockets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;connection&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;New connection: &amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;changeColor&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;Changing color: &amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;led&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;repl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;inject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;led&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;led&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;First line we include Socket.io and tell it to listen to port 8080. Then in our code, we simply log new connections and wait for a &lt;code&gt;changeColor&lt;/code&gt; event, which will be triggered by our web browser.&lt;/p&gt;

&lt;p&gt;Testing it requires a Socket.io emitter. Let&amp;#39;s create a basic &lt;code&gt;index.html&lt;/code&gt; page. Here is the minimal snippet to test our websocket:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;label&amp;gt;&lt;/span&gt;Color: &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;text&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;color&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;color&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;#ff0000&amp;quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;button&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;changeColor&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Change color!&lt;span class=&quot;nt&quot;&gt;&amp;lt;/button&amp;gt;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Do not forget to eventually change your Socket.io server settings --&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;http://localhost:8080/socket.io/socket.io.js&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;
    var socket = io.connect(&amp;#39;//:8080&amp;#39;);
    document.getElementById(&amp;quot;changeColor&amp;quot;).addEventListener(&amp;quot;click&amp;quot;, function() {
        var color = document.getElementById(&amp;quot;color&amp;quot;).value;
        socket.emit(&amp;quot;changeColor&amp;quot;, color);
    })
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;An input to enter the wished color, a button to validate, and a socket to emit the event when the user click on the button. Do not forget to make the listening and emitting ports match.&lt;/p&gt;

&lt;p&gt;For Socket.io to work, you need to launch a web server on desired port. You are free to use the solution you want: &lt;a href=&quot;http://harpjs.com/&quot;&gt;Harp&lt;/a&gt;, &lt;a href=&quot;https://docs.python.org/2/library/simplehttpserver.html&quot;&gt;Python SimpleHTTPServer&lt;/a&gt;, or whatever. As a PHP developer, I personnaly use:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;php -S 0.0.0.0:8081
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice the web server port is not the same as the Socket.io server port.&lt;/p&gt;

&lt;p&gt;Connect to your very basic Web interface, and try to change the color of your LED. The change should be directly repercuted on your Arduino. Isn&amp;#39;t it beautiful?&lt;/p&gt;

&lt;p&gt;The end of this article is some bonus. It explains how to create a more advanced interface creating a hue picker.&lt;/p&gt;

&lt;h2&gt;Bonus: creating a hue picker&lt;/h2&gt;

&lt;p&gt;The objective of this part is to create a hue picker, allowing our users to select a color on a rainbow ribbon like the following:&lt;/p&gt;

&lt;figure&gt;
    &lt;img src=&quot;/img/posts/arduino/rgbl/hue-picker.png&quot; alt=&quot;Hue picker (aka Rainbow Ribbon)&quot; title=&quot;Hue picker (aka Rainbow Ribbon)&quot; /&gt;
    &lt;figcaption&gt;Final result of our hue picker (aka Rainbow Ribbon)&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;The user would be able to drag and drop the marker across all the ribbon. The color will change at each new position.&lt;/p&gt;

&lt;p&gt;First step to get quickly a rocking interface: let&amp;#39;s install Bootstrap. We also embed JQueryUI as we will need it later.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;bower install --save bootstrap jqueryui
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For more reusability and flexibility, we encapsulate the code of our hue picker into a dedicated class.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HuePicker&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;container&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;container&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;container&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;width&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;marker&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;markerRadius&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;markerRadius&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;markerX&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I won&amp;#39;t explain it further, as variables are self-explained. Our &lt;code&gt;init&lt;/code&gt; function will create a canvas containing our rainbow colors and create the marker:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * Initialize HuePicker widget and bind its events.&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; */&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;HuePicker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;prototype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;init&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_createCanvas&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;marker&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_createMarker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * Create a canvas element and fill it with rainbow colors.&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * @private&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; */&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;HuePicker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;prototype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_createCanvas&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Let enough space to display marker correctly&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;width&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;width&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;markerRadius&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;canvas&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;width&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;quot;&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;canvas&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;css&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;margin-left&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;markerRadius&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;container&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;canvas&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;context&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;canvas&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2d&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;fillStyle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_getRainbowGradient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;fillRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * Return a canvas gradient containing all rainbow colors.&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * @returns {CanvasGradient}&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * @private&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; */&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;HuePicker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;prototype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_getRainbowGradient&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rainbowColors&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;orange&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;yellow&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;green&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;indigo&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;violet&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;gradient&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createLinearGradient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rainbowColors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;gradient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;addColorStop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rainbowColors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;gradient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * Create SVG marker and return it.&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * @returns {*|jQuery|HTMLElement}&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * @private&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; */&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;HuePicker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;prototype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_createMarker&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;svg&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;lt;svg&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;svg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;lt;g id=&amp;quot;marker&amp;quot;&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;svg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;    &amp;lt;line x1=&amp;quot;&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;markerRadius&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;quot; y1=&amp;quot;0&amp;quot; x2=&amp;quot;&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;markerRadius&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;quot; y2=&amp;quot;&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;markerRadius&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;quot;&amp;gt;&amp;lt;/line&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;svg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;    &amp;lt;circle fill=&amp;quot;red&amp;quot; cx=&amp;quot;&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;markerRadius&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;quot; cy=&amp;quot;&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;quot; r=&amp;quot;&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;markerRadius&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;quot;&amp;gt;&amp;lt;/circle&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;svg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;lt;/g&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;container&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;svg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;#marker&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;svg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This snippet is quite long, yet it is just adding some element and styling them. The only tricky part is the creation of the gradient. However, to make it as simple as possible, we simply take the rainbow colors, and attribute a equal part of the final gradient for each.&lt;/p&gt;

&lt;p&gt;If you refresh your page, you should see the same ribbon as previously shown in this post, except there is no possible interaction.&lt;/p&gt;

&lt;p&gt;Let&amp;#39;s add it, using the &lt;code&gt;draggable&lt;/code&gt; component of jQuery-UI. In our &lt;code&gt;init&lt;/code&gt; function, add this event handler:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;circle&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;draggable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cursor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;pointer&amp;#39;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;drag&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ui&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_moveMarker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ui&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;left&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Just some configuration, using a &lt;code&gt;pointer&lt;/code&gt; cursor and the &lt;code&gt;_moveMarker&lt;/code&gt; callback, whose code is:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * Move marker to specified position and emit required events.&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * @param x&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * @private&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; */&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;HuePicker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;prototype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_moveMarker&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;width&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;markerRadius&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;markerX&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;#marker&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;transform&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;translate(&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;)&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;trigger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;changeColor&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()]);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;First, we ensure marker will not go outside allowed bounds. Then, we move the marker, using a SVG translation on the whole marker group (the circle and the line). Then, we trigger a &lt;code&gt;changeColor&lt;/code&gt; event on the hue picker, not the websocket yet, as we do not have it in the &lt;code&gt;HuePicker&lt;/code&gt; context.&lt;/p&gt;

&lt;p&gt;Retrieving a pixel color from the canvas does not return the hexadecimal code of the color. Instead, it returns an array like &lt;code&gt;[R, G, B, alpha]&lt;/code&gt;. We need a transformer to convert array to hexadecimal:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * Return currently selected color.&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * @returns {string}&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; */&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;HuePicker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;prototype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getValue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;currentColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getImageData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;markerX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_convertPixelArrayToHexadecimalCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;currentColor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * Convert a pixel value ([255, 0, 0, 255]) into its RGB equivalent (#ff0000).&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * @param pixelValue&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * @returns {string}&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; */&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;HuePicker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;prototype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_convertPixelArrayToHexadecimalCode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pixelValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;hexadecimalColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;#&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;hexadecimalPart&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pixelValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hexadecimalPart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;hexadecimalPart&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;0&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;hexadecimalPart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;nx&quot;&gt;hexadecimalColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;hexadecimalPart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;hexadecimalColor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To convert a number to its hexadecimal equivalent, we use the &lt;code&gt;toString&lt;/code&gt; method, with the &lt;code&gt;base&lt;/code&gt; parameter.&lt;/p&gt;

&lt;p&gt;Finally, simply use your color picker on your web interface:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;huePicker&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HuePicker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;#color-picker&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;940&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;80&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;huePicker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;changeColor&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;#marker circle&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;fill&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;emit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;changeColor&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Move your cursor, and let&amp;#39;s the magic of websockets happens!&lt;/p&gt;

&lt;p&gt;Code source of this sample is available on &lt;a href=&quot;https://github.com/jpetitcolas/arduino-experiments/tree/master/led-colorpicker&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Creating a Morse encoder with Arduino</title>
   <link href="http://www.jonathan-petitcolas.com/2014/03/16/creating-morse-encoder-with-arduino.html"/>
   <updated>2014-03-16T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2014/03/16/creating-morse-encoder-with-arduino</id>
   <content type="html">&lt;p&gt;A few days ago, I received my &lt;a href=&quot;https://www.sparkfun.com/products/12001&quot;&gt;SparkFun inventor&amp;#39;s kit&lt;/a&gt;. This kit includes an Arduino and many electronic components such as LCD panel or drive motor. And, icing on the cake, it also provides several tutorials to brush up on electronics. In short, a perfect starter kit.&lt;/p&gt;

&lt;p&gt;The first tutorial is about switching on and off a LED. Not really challenging (especially with the 4 lines provided source code). So, let&amp;#39;s raise the bar higher: we will create a &lt;a href=&quot;http://en.wikipedia.org/wiki/Morse_code&quot;&gt;Morse language&lt;/a&gt; encoder. The Morse language maps each letter and number to a unique sequence of dot and dashes (respectively a short and long light flash). So, making the LED blinking, we would be able to transmit a message. Sounds more exciting, isn&amp;#39;t it?&lt;/p&gt;

&lt;h2&gt;Configuring SublimeText for Arduino development&lt;/h2&gt;

&lt;p&gt;First of all, either you use it or not, you have to download the &lt;a href=&quot;http://arduino.cc/en/Main/Software&quot;&gt;Arduino IDE&lt;/a&gt;. I tried to use it for a hour, and honestly, it sucks: no code autocompletion, strange indentation, too small debug output, etc. So, finally, I decided to find an alternative.&lt;/p&gt;

&lt;p&gt;I am using Sublime Text for a while now, and I looked naturally for an Arduino plug-in. And, thanks to &lt;a href=&quot;https://github.com/Robot-Will&quot;&gt;Robot-Will&lt;/a&gt;, I found such a plug-in: &lt;a href=&quot;https://github.com/Robot-Will/Stino&quot;&gt;Stino&lt;/a&gt;. To grab it, simply use the package manager, looking for &amp;quot;Arduino-like IDE&amp;quot;.&lt;/p&gt;

&lt;p&gt;The configuration is not really straightforward. In order to compile and send your program correctly to your Arduino, you will have to configurate several parameters:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Arduino &amp;gt; Preferences &amp;gt; Select Arduino application folder:&lt;/strong&gt; the folder where &lt;code&gt;arduino&lt;/code&gt; bin is,&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Arduino &amp;gt; Preferences &amp;gt; Change Sketchbook folder:&lt;/strong&gt; location of all your Arduino programs,&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Arduino AVR boards:&lt;/strong&gt; select your board model (&amp;quot;Arduino UNO&amp;quot; in the case of the SparkFun&amp;#39;s kit)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Serial port:&lt;/strong&gt; choose the corresponding port on which your Arduino is plugged (&lt;code&gt;/dev/ttyUSB1&lt;/code&gt; in my case)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Selecting folders is pretty unergonomic. After selecting the menu item, a text field appear. Just press &lt;code&gt;/&lt;/code&gt; (in Linux at least) and validate to see the folder hierarchy. Then, navigate with arrows to choose the appropriate input.&lt;/p&gt;

&lt;p&gt;To access serial port devices, you should launch Sublime Text as root. I do not like this unnecessary elevation of privileges for a text editor: does anyone have a workaround?&lt;/p&gt;

&lt;h2&gt;Creating a basic LED circuit&lt;/h2&gt;

&lt;p&gt;Now we got a user-friendly Arduino editor, let&amp;#39;s wire our board. You will need a LED, a 330Ω resistor, and the 5V power source from your Arduino. Here is the corresponding blueprint:&lt;/p&gt;

&lt;p class=&quot;center&quot;&gt;
    &lt;img src=&quot;/img/posts/arduino/morse-transcoder/arduino-led-circuit.png&quot; alt=&quot;Arduino - Blinked LED blueprint&quot; title=&quot;Arduino - Blinked LED blueprint&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;No need of soldering iron as we have a breadboard. The breadboard is the board containing a lot of connection points. The board is split into two parts (electrically independent) by a middle line. Two vertical lines provides the energy source (&lt;code&gt;+&lt;/code&gt;) and the ground (&lt;code&gt;-&lt;/code&gt;). All the components legs plugged on the same horizontal line would be wired together. Knowing that, let&amp;#39;s plug our components:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Power line on the &amp;quot;Power 5V&amp;quot; Arduino pin&lt;/li&gt;
&lt;li&gt;Ground line on the &amp;quot;Power GND&amp;quot; Arduino pin&lt;/li&gt;
&lt;li&gt;LED: longest leg (the &lt;code&gt;+&lt;/code&gt; leg) on C2 and shortest on C3,&lt;/li&gt;
&lt;li&gt;Resistor: A3 + Ground,&lt;/li&gt;
&lt;li&gt;Wire between Arduino pin 13 and E2&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As a LED is a polarized component: you should plug it in the right direction. At these voltage, it should not break anything. Yet, if you plug it wrongly, it would simply works as an opened switch.&lt;/p&gt;

&lt;p&gt;Once our circuit built, let&amp;#39;s try it with this really simple program:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OUTPUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HIGH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOW&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;All Arduino programs should contain both the &lt;code&gt;setup&lt;/code&gt; and &lt;code&gt;loop&lt;/code&gt; functions. The first one initializes all our components. In this case, we tell Arduino the pin 13 will be used only as an output, and no input would be made on it.&lt;/p&gt;

&lt;p&gt;Then, the &lt;code&gt;loop&lt;/code&gt; function will be executed forever (unless Arduino is stopped manually). In this case, we send a &lt;code&gt;HIGH&lt;/code&gt; signal (meaning +5V) on the pin 13, which light on the LED. We wait 1 second, then we send a &lt;code&gt;LOW&lt;/code&gt; signal (0V) to switch it off, and we wait again.&lt;/p&gt;

&lt;p&gt;Now, verify/compile your code and upload it (CTRL + ALT + U). If your circuit is wired correctly, the LED should slowly blink.&lt;/p&gt;

&lt;h2&gt;Developing a Morse encoder&lt;/h2&gt;

&lt;h3&gt;Emitting a &amp;quot;SOS&amp;quot; signal&lt;/h3&gt;

&lt;p&gt;Now that our circuit is done, let&amp;#39;s start by emitting one of the most famous Morse message: &amp;quot;SOS&amp;quot;. The equivalent of &lt;code&gt;S&lt;/code&gt; and &lt;code&gt;O&lt;/code&gt; in Morse language are respectively &lt;code&gt;...&lt;/code&gt; and &lt;code&gt;---&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;We are going to use the following conventions for our project (which are the recommended standards):&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Dot duration is 1 time unit,&lt;/li&gt;
&lt;li&gt;Dash duration is 3 time units,&lt;/li&gt;
&lt;li&gt;Each letter would be separated by 3 time units,&lt;/li&gt;
&lt;li&gt;Each word would be separated by 7 times units.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;So, we are now able to write some very simple functions:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;cp&quot;&gt;#define TIME_UNIT 200&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HIGH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TIME_UNIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOW&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TIME_UNIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HIGH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TIME_UNIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOW&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TIME_UNIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;endLetter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TIME_UNIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;space&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TIME_UNIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We first define the &lt;code&gt;TIME_UNIT&lt;/code&gt; constant as a &lt;code&gt;#DEFINE&lt;/code&gt; directive. It means all occurences of &lt;code&gt;TIME_UNIT&lt;/code&gt; will be automatically replaced during compilation phase, saving some memory. Remember we are on an low memory device: memory is precious.&lt;/p&gt;

&lt;p&gt;Then, we apply our conventions creating a bunch of functions. Emitting a SOS signal is now done through:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endLetter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endLetter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endLetter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;space&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Upload your program, and you should see your distress beacon.&lt;/p&gt;

&lt;h3&gt;Creating a library&lt;/h3&gt;

&lt;p&gt;As our code for Morse specific usage starts to grow, it is a good idea to move it into a separate library. We proceed as if we were doing some C: creating a header file and the library itself. The header file &lt;code&gt;MorseTranslator.h&lt;/code&gt; contains only our function prototypes and class scoped variables:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;cp&quot;&gt;#ifndef MORSE_TRANSLATOR_H&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define MORSE_TRANSLATOR_H&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;#include &amp;quot;Arduino.h&amp;quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MorseTranslator&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;MorseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeUnit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;endLetter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;space&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;nl&quot;&gt;private&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_pin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_timeUnit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;#endif&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Do not forget to embed the &lt;code&gt;Arduino.h&lt;/code&gt;, as the Arduino library is not automatically imported in libraries.&lt;/p&gt;

&lt;p&gt;As you may have noticed, the constructor of our library now takes the pin on which we want to send data, and the duration of our flash light (which is now an attribute of our class, for more flexibility). We split all our data between &lt;code&gt;public&lt;/code&gt; and &lt;code&gt;private&lt;/code&gt; keywords, according to their accessibility.&lt;/p&gt;

&lt;p&gt;We used the type &lt;code&gt;byte&lt;/code&gt; to define the output pin. In all the Arduino examples, pins are &lt;code&gt;int&lt;/code&gt;, yet it consumes too much memory. An integer is indeed coded on two bytes (allowing values up to 32,767), whereas a &lt;code&gt;byte&lt;/code&gt; (synonym of &lt;code&gt;unsigned char&lt;/code&gt;) is coded on a single byte, allowing values up to 256, which is enough for our pins.&lt;/p&gt;

&lt;p&gt;Finally, we just have to move all fonctions into the &lt;code&gt;MorseTranslator.ino&lt;/code&gt; file, prefixing all our method by our class name:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;n&quot;&gt;MorseTranslator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MorseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeUnit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OUTPUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_pin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_timeUnit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeUnit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MorseTranslator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_pin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HIGH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_timeUnit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_pin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOW&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_timeUnit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, your main file should look like:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;cp&quot;&gt;#include &amp;quot;MorseTranslator.h&amp;quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;MorseTranslator&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endLetter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endLetter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endLetter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;space&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Upload again your program to ensure nothing broke during this refactoring.&lt;/p&gt;

&lt;h3&gt;Using a Morse dictionnary&lt;/h3&gt;

&lt;p&gt;Next evolution is to use a dictionnary to map each letter to its Morse signal. As there is no native hash maps in Arduino world, we are going to use a structure, which is simply a new type definition containing several variables of different types.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dictionnaryEntry&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;character&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;dictionnaryEntry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dictionnary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;36&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;.-&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&amp;#39;b&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;-...&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&amp;#39;0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;-----&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We define here a new data type &lt;code&gt;dictionnaryEntry&lt;/code&gt;, composed of the input character and its Morse correspondance, stored in a &lt;code&gt;String&lt;/code&gt;. Then, we define our dictionnary, containing all the translations. For content clarity, I did not include all the equivalences, but you can find it everywhere (for instance, on the &lt;a href=&quot;http://en.wikipedia.org/wiki/Morse_code&quot;&gt;Wikipedia Morse page&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Now, let&amp;#39;s create a private function to get a signal from a given char (do not forget to update your header file):&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MorseTranslator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getSignalForChar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;36&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dictionnary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;character&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dictionnary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// If no matching character, consider it is a space.&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally, let&amp;#39;s create an &lt;code&gt;emit&lt;/code&gt; public function:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MorseTranslator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;emit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;signal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getSignalForChar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;signalLength&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;signalLength&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;charAt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&amp;#39;-&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;dash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;space&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;endLetter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We are now able to change our &lt;code&gt;loop&lt;/code&gt; function to use our newly created &lt;code&gt;emit&lt;/code&gt; method:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;emit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&amp;#39;s&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;emit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&amp;#39;o&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;emit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&amp;#39;s&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Of course, you can now change &lt;code&gt;dot&lt;/code&gt;, &lt;code&gt;dash&lt;/code&gt; and other former used functions accessibility to private, as we are just using &lt;code&gt;emit&lt;/code&gt; now.&lt;/p&gt;

&lt;p&gt;Upload again, and check that our beacon is still alive.&lt;/p&gt;

&lt;h2&gt;Transmit user input to Arduino through Serial port&lt;/h2&gt;

&lt;p&gt;To communicate with our Arduino, we are going to use the &lt;code&gt;Serial&lt;/code&gt; link. If you click on the &lt;em&gt;Arduino &amp;gt; Serial monitor &amp;gt; Start&lt;/em&gt; menu, a new tab opens, allowing you to send some data to the Arduino. We are going to use this feature to communicate with our LED.&lt;/p&gt;

&lt;p&gt;First of all, we have to enable the Serial communication in the &lt;code&gt;setup&lt;/code&gt; function, specifying the transmission rate in bauds. In our case, 9600 bauds would be far enough. Just ensure the speed of transmission is the same on both sides, to prevent from strange issues.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9600&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;Serial link established!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, check if some data are available on the Serial link, and if so, read it and emit the corresponding signal:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// If no serial link is available, do not go further.&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;available&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;morseTranslator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;emit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The whole code is available on &lt;a href=&quot;https://github.com/jpetitcolas/arduino-experiments/tree/master/morse_encoder&quot;&gt;GitHub&lt;/a&gt;, and here is finally the video demonstration of our Morse encoder:&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;//www.youtube.com/embed/4H3hKid6ucA?rel=0&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
</content>
 </entry>
 
 <entry>
   <title>Finding out slowest tests of your PHPUnit test suite</title>
   <link href="http://www.jonathan-petitcolas.com/2014/01/15/finding-out-slowest-tests-of-your-phpunit-test-suite.html"/>
   <updated>2014-01-15T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2014/01/15/finding-out-slowest-tests-of-your-phpunit-test-suite</id>
   <content type="html">&lt;p&gt;Writing tests is a very important and tranquilizing task in developer daily life. Delivering a new feature with green tests removes so much stress, telling the developer he had not break anything. That&amp;#39;s why you should write tests for every single new piece of code you implement.&lt;/p&gt;

&lt;p&gt;If you joined a big project, you should have noticed that tests are very slow to execute. For instance, on a current huge project we have at &lt;a href=&quot;http://www.marmelab.com&quot;&gt;Marmelab&lt;/a&gt;, tests are taking 45 minutes. This is generally not an issue with continuous integration server, as you can execute tests in background without monopolizing your workstation. Yet, long tests are really a bad point
when you are in a matter of urgency.&lt;/p&gt;

&lt;p&gt;Let&amp;#39;s consider this (sadly) common situation where you just released a new version in production and when your customer calls you completely panicked to warn you about a critical bug. Fix may be quick, deployment may also be if you decide to bypass tests. Yet, this is so much stressful and dangerous: you do not have any net and may break something else with your fix. That&amp;#39;s why reducing tests duration is really important.&lt;/p&gt;

&lt;p&gt;But the first step to achieve such a purpose is to visualize which tests are the slowest, to focus efforts on it. That&amp;#39;s why I created &lt;a href=&quot;https://github.com/marmelab/phpunit-d3-report&quot;&gt;PHPUnit d3 report&lt;/a&gt;.&lt;/p&gt;

&lt;h2&gt;PHPUnit debugging report&lt;/h2&gt;

&lt;p&gt;Before reinventing the wheel, I took a look to check if any tool already existed. First, I naively tried to use the debug option of PHPUnit. But it gave me only the overall duration of the whole test suite:&lt;/p&gt;

&lt;pre class=&quot;console&quot;&gt;PHPUnit 3.7.28 by Sebastian Bergmann.

Configuration read from /home/jpetitcolas/dev/Faker/phpunit.xml.dist

Starting test &#39;Faker\Test\GeneratorTest::testAddProviderGivesPriorityToNewlyAddedProvider&#39;.
.
Starting test &#39;Faker\Test\GeneratorTest::testGetFormatterReturnsCallable&#39;.
.
Starting test &#39;Faker\Test\GeneratorTest::testGetFormatterReturnsCorrectFormatter&#39;.
.
[...]
Starting test &#39;Faker\Test\Provider\ja_JP\PersonTest::testLastKanaNameReturnsNagisa&#39;.
.

Time: 1.59 seconds, Memory: 23.75Mb&lt;/pre&gt;

&lt;p&gt;I may have used a bash command to check each test duration individually. It may work, except I would not have accurate data, as each test during less than a second would indicate &amp;quot;0 second&amp;quot;.&lt;/p&gt;

&lt;h2&gt;PHPUnit phing report&lt;/h2&gt;

&lt;p&gt;Then, I took a look for another solution and came on &lt;a href=&quot;http://cweiske.de/tagebuch/visualizing-phpunit-runs.htm&quot;&gt;Christian Weiske&amp;#39;s post&lt;/a&gt; talking about the &lt;a href=&quot;http://www.phing.info/docs/master/webhelp/PHPUnitReport.html&quot;&gt;Phing phpunitreport task&lt;/a&gt;. Producing the same &lt;a href=&quot;https://github.com/fzaninotto/Faker&quot;&gt;Faker&lt;/a&gt; report brought me the following page:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/posts/phing-phpunitreport-faker.png&quot; alt=&quot;Phing PHPUnit report of Faker&quot; title=&quot;Phing PHPUnit report of Faker&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This display is of course truncated. But as you may have noticed, this output only displays raw numbers. Too difficult to interpret.&lt;/p&gt;

&lt;h2&gt;PHPUnit d3 report&lt;/h2&gt;

&lt;p&gt;So, I got raw data on one side, and a great visualization library (&lt;a href=&quot;http://d3js.org&quot;&gt;d3.js&lt;/a&gt;) on the other one. Merging them leads to an easy-to-read visualization tool: &lt;a href=&quot;http://marmelab.com/phpunit-d3-report/&quot;&gt;PHPUnit d3 report&lt;/a&gt;, released under MIT license. Here is a Faker report generated by this tool:&lt;/p&gt;

&lt;div id=&quot;faker_report&quot;&gt;&lt;/div&gt;

&lt;div class=&quot;tooltip&quot; style=&quot;opacity: 0;&quot;&gt;&lt;/div&gt;

&lt;p&gt;&lt;link href=&quot;/labs/phpunit-bubbles/bubbles.css&quot; rel=&quot;stylesheet&quot; /&gt;
&lt;script src=&quot;/labs/phpunit-bubbles/d3.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/labs/phpunit-bubbles/d3.phpunitBubbles.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/labs/phpunit-bubbles/bubbles.js&quot;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;The bigger a bubble is, the longer the test execution time is. Moreover, you can check in a single glance which tests are erred or are failing, thanks to the respective red and yellow colors. And if you hover the rebel bubbles, you will even get more details about the issue. Some fake tests were added to the report, to better see these special cases.&lt;/p&gt;

&lt;p&gt;To create such a report, this tool has now its &lt;a href=&quot;http://marmelab.com/phpunit-d3-report/&quot;&gt;dedicated page&lt;/a&gt;. You simply have to generate an XML report from your PHPUnit test suite, using the &lt;code&gt;phpunit --log-junit report.xml&lt;/code&gt; command, and copy/paste this report into the &lt;a href=&quot;http://marmelab.com/phpunit-d3-report/#report&quot;&gt;corresponding textarea&lt;/a&gt; to blow bubbles!&lt;/p&gt;

&lt;h3&gt;Embedding a report on your own site&lt;/h3&gt;

&lt;p&gt;More over, you can embed this chart into your own application or, as I did, on your project page. To do it, simply retrieve d3.js and the PHPUnit D3 report sources, and embed them on your page:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;faker_report&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;tooltip&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;style=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;opacity: 0;&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;/labs/phpunit-bubbles/bubbles.css&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;stylesheet&amp;quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;/labs/phpunit-bubbles/d3.min.js&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;/labs/phpunit-bubbles/d3.phpunitBubbles.js&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice that for performance reasons, I did not embed the &lt;code&gt;ReportTransformer&lt;/code&gt;. Indeed, as this page is purely static and as I only want to display Faker report, I can store directly the report in JSON format (you can retrieve it clicking on the &lt;em&gt;Download JSON report&lt;/em&gt; link, just under the chart). So, once you get the data, simply write a few Javascript lines:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;chart&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;d3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;chart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;phpunitBubbles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;padding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;d3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;my-report.json&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;d3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;#faker_report&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;datum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;chart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can of course customize colors or tooltip style with CSS. Yet, you can also interact directly with the chart parameters. For instance, you can change space between each bubbles changing the &lt;code&gt;padding&lt;/code&gt; property. This is done really easily using the &lt;a href=&quot;#&quot;&gt;Mike Bostock&amp;#39;s re-usable chart design pattern&lt;/a&gt; with the following code:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;d3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;#faker_report&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;padding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;datum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;chart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We changed the padding here, but a &lt;a href=&quot;https://github.com/marmelab/phpunit-d3-report#parameters&quot;&gt;wide range of parameters&lt;/a&gt; are configurable, such as chart dimensions or hovering events.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Building a static website with Silex</title>
   <link href="http://www.jonathan-petitcolas.com/2013/11/20/building-static-website-with-silex.html"/>
   <updated>2013-11-20T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2013/11/20/building-static-website-with-silex</id>
   <content type="html">&lt;p&gt;I recently helped a contact of mine to develop her company website (&lt;a href=&quot;http://www.up-grading.fr&quot;&gt;up&amp;#39;grading&lt;/a&gt;). Her needs were basic: some static pages and a FAQ.&lt;/p&gt;

&lt;p&gt;I faced three main choices to achieve such a demand:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;WordPress: this blogging platform is also widely used as a static website skeleton. Yet, I am not a big fan of WP code base, and maintenance is painful as hell: upgrading core (even if it seems it is automatic from now), upgrading plugins, and so on... And why a database for such a a simple site?&lt;/li&gt;
&lt;li&gt;Pure PHP: sounds better. It would allow to embed only the strict minimum. Yet, I do not want to reinvent the wheel.&lt;/li&gt;
&lt;li&gt;Symfony2: a full stack framework would fulfill all requirements, but would also be overkill. No need of dependency injection to three simple static pages.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Ideal would be a solution between pure PHP and a full stack framework, a kind of Symfony2-lite. Fortunately, it already exists: &lt;a href=&quot;http://silex.sensiolabs.org&quot;&gt;Silex&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Silex is part of micro-frameworks family. The best definition of what a micro-framework is available on &lt;a href=&quot;http://flask.pocoo.org/docs/foreword/#what-does-micro-mean&quot;&gt;Flask website&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;“Micro” does not mean that your whole web application has to fit into a single [...] file, although it certainly can. Nor does it mean that [it] is lacking in functionality. The “micro” in microframework means [it] aims to keep the core simple but extensible. [It] won’t make many decisions for you, such as what database to use. Those decisions that it does make, such as what templating engine to use, are easy to change. Everything else is up to you, so that [it] can be everything you need and nothing you don’t.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Simplicity with flexibility. Sounds perfectly fitting our needs, isn&amp;#39;t it? Let&amp;#39;s explain the process of creating our static pages with Silex.&lt;/p&gt;

&lt;h2&gt;Bootstrapping Silex&lt;/h2&gt;

&lt;p&gt;Installation is made through Composer. So, simply create a &lt;code&gt;composer.json&lt;/code&gt; file containing the Silex dependency:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;quot;require&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;quot;silex/silex&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;~1.1&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, let the magic happens with the &lt;code&gt;composer install&lt;/code&gt; command. When completed, create a new &lt;code&gt;web/index.php&lt;/code&gt; file containing the following &amp;quot;Hello world!&amp;quot; code:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;k&quot;&gt;require_once&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;__DIR__&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;/../vendor/autoload.php&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Silex\Application&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;/hello&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Hello world!&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;If you have correctly configured your VHost (especially with the document root pointing to the &lt;code&gt;web&lt;/code&gt; directory), you should see the &amp;quot;Hello world!&amp;quot; when browsing the &lt;code&gt;/hello&lt;/code&gt; URL. Managing routes with Silex is incredibly so easy.&lt;/p&gt;

&lt;h2&gt;Installing a template engine: Twig&lt;/h2&gt;

&lt;p&gt;When you once tried Twig (the default template engine provided with Symfony2), you will never want to mix together PHP and HTML. Installing it is a two steps process, beginning with the inclusion of Twig in your composer file (do not forget then to update your dependencies through a composer update):&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;quot;require&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;err&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;quot;symfony/twig-bridge&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;~2.3&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now simply register Twig as a Silex middleware (a middleware is a layer located between user request and framework response):&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Silex\Provider\TwigServiceProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s1&quot;&gt;&amp;#39;twig.path&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;__DIR__&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;/../views&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We just told Twig to look for our templates in the &lt;code&gt;views&lt;/code&gt; directory. Thus, modify our controller to use a template:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;/hello&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;twig&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;hello.html.twig&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You are now able to validate the that Twig is correctly installed, refreshing the previous opened page. Yet, you would probably need to use Twig blocks inheritance for the global layout. Here is a simplified use case:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;{% block title &amp;quot;Welcome on my site!&amp;quot; %}&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
        {% block stylesheets %}
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;css/style.css&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;stylesheet&amp;quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
        {% endblock %}
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
        {% block content &amp;quot;&amp;quot; %}
        {% block javascripts %}
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;script&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;js/jquery.js&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
        {% endblock %}
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here would be our templated hello page:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;{% extends &amp;quot;layout.html.twig&amp;quot; %}

{% block title &amp;quot;Hello world!&amp;quot; %}

{% block content %}
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Hello world!&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;css/hello.css&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;stylesheet&amp;quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
{% endblock %}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice we embed a specific stylesheet for this page only, thanks to the &lt;code&gt;stylesheets&lt;/code&gt; block and a call to the &lt;code&gt;parent&lt;/code&gt; function. It is a good practice to avoid fat resources, where some instructions are single page specific.&lt;/p&gt;

&lt;h2&gt;Internal linking&lt;/h2&gt;

&lt;p&gt;Currently, if we want to make a link to the contact page, we would create something like:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;/contact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Contact&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;us&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Where &lt;code&gt;/contact&lt;/code&gt; route would have been mapped with related view thanks to the &lt;code&gt;$app-&amp;gt;get&lt;/code&gt; method, as seen before. Yet, what would happen if we decide to change this route to &lt;code&gt;/contact-us&lt;/code&gt;? We would have to grep all the contact links of our pages and change them accordingly. Or, we may use the &lt;a href=&quot;http://silex.sensiolabs.org/doc/providers/url_generator.html&quot;&gt;URL generator service&lt;/a&gt;, which would simply turn a route name into its corresponding URL.&lt;/p&gt;

&lt;p&gt;Let&amp;#39;s start by registering this service. In the &lt;code&gt;index.php&lt;/code&gt; file:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Silex\Provider\UrlGeneratorServiceProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then, we have to give a name to our route. This is done through the &lt;code&gt;bind&lt;/code&gt; method:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;/contact&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;contact&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You are now able to generate URL based on your controllers into your Twig templates:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;{{ app.url_generator.generate(&amp;#39;contact&amp;#39;) }}&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    Contact us
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Organizing our routes&lt;/h2&gt;

&lt;p&gt;Even on a static website you should have a lot of really static webpages, resulting in many actions. Here is a snippet showing a way to avoid code duplication:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$routes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s1&quot;&gt;&amp;#39;home&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;url&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;template&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;home.html.twig&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;s1&quot;&gt;&amp;#39;references&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;url&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;references&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;template&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;references.html.twig&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;s1&quot;&gt;&amp;#39;contact&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;url&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;contact&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;template&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;contact.html.twig&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$routes&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$routeName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;url&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;twig&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;template&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$routeName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code&gt;$routes&lt;/code&gt; array contains all the data we need for our static pages: route name (for generating route through URL generator) as a key, URL and template. This is the place to add new pages.&lt;/p&gt;

&lt;h2&gt;Creating the FAQ&lt;/h2&gt;

&lt;p&gt;FAQ is the chunk of this site. There must be a list of question links, each link redirecting to the question response. If we use the same solution as above, we would create a template for list and a template by question.&lt;/p&gt;

&lt;p&gt;This is a bad solution. Indeed, there would be a lot of similar routes, and each time we want to add a question, we will need to update the question list. When something is done manually, it will necessarily break. So, to avoid a desynchronization between our responses and list, we have to be wiser.&lt;/p&gt;

&lt;p&gt;Ideally, we would configure a database to store all our questions. However, as editorial changes would be rare, and as we want a website as light as possible, we would rather store the data in a simple file, a YAML one for instance.&lt;/p&gt;

&lt;p&gt;Here is a possible structure, you may store in a &lt;code&gt;data/questions.yml&lt;/code&gt; file for instance:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;question_1&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;question&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Comment&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;financer&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;ma&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;formation&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;?&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;slug&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;comment-financer-ma-formation&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;answer&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p-Indicator&quot;&gt;|&lt;/span&gt;
        &lt;span class=&quot;no&quot;&gt;&amp;lt;p&amp;gt;Il est possible de faire financer une formation par son employeur en utilisant le DIF,&lt;/span&gt;
        &lt;span class=&quot;no&quot;&gt;Droit Individuel à la Formation ou dans le cadre du CIF, Congés Individuel de Formation,&lt;/span&gt;
        &lt;span class=&quot;no&quot;&gt;ou de la VAE, Validation des Acquis de l’Expérience.&amp;lt;/p&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;no&quot;&gt;[...]&lt;/span&gt;

&lt;span class=&quot;l-Scalar-Plain&quot;&gt;question_2&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;2&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;question&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Qu&amp;#39;est-ce&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;que&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;coaching&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;?&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;slug&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;qu-est-ce-que-le-coaching&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;answer&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p-Indicator&quot;&gt;|&lt;/span&gt;
        &lt;span class=&quot;no&quot;&gt;&amp;lt;p&amp;gt;Le coaching professionnel est l’accompagnement personnalisé et suivi d’un individu ou&lt;/span&gt;
        &lt;span class=&quot;no&quot;&gt;d’un groupe, qui permet d’atteindre un objectif d’ordre professionnel ou privé.&amp;lt;/p&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;no&quot;&gt;[...]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we got our pseudo-database, we can create the listing page. But first, we should add the Symfony YAML parser to our dependencies:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;quot;require&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;err&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;quot;symfony/yaml&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;2.1.*@dev&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, add the following action:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Symfony\Component\Yaml\Yaml&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;/faq&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$yamlQuestions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;file_get_contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__DIR__&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;/../data/questions.yml&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$questions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Yaml&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$yamlQuestions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;twig&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;faq/index.html.twig&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;s1&quot;&gt;&amp;#39;questions&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$questions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;faq&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It simply read the YAML file and pass the retrieved questions to the template. You can then display them very simply as the following:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;{% block body %}
&lt;span class=&quot;nt&quot;&gt;&amp;lt;ul&amp;gt;&lt;/span&gt;
    {% for question in questions %}
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;li&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;{{ app.url_generator.generate(&amp;quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;faq_question&amp;quot;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;err&quot;&gt;&amp;quot;id&amp;quot;:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;question.id,&lt;/span&gt;
                &lt;span class=&quot;err&quot;&gt;&amp;quot;slug&amp;quot;:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;question.slug&lt;/span&gt;
            &lt;span class=&quot;err&quot;&gt;})&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;}}&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
                {{ question.question }}
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
    {% endfor %}
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ul&amp;gt;&lt;/span&gt;
{% endblock %}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally, let&amp;#39;s create the final route for reading a response:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;/faq/{id}/{slug}&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$slug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$yamlQuestions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;file_get_contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__DIR__&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;/../views/faq/questions.yml&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$questions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Yaml&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$yamlQuestions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;nv&quot;&gt;$question&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$questions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;question_&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Ensure URL is correct&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$question&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;slug&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$slug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;abort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;404&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;Question slug does not match.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;twig&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;faq/question.html.twig&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;s1&quot;&gt;&amp;#39;question&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$question&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;faq_question&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Which allows us to retrieve the whole question object in our template. We just operate a check on question slug to avoid duplicate content. If the slug is incorrect, then we stop the rendering and return a 404 response to the user.&lt;/p&gt;

&lt;p&gt;As explained in this article, Silex may fit exactly the requirements of a static website with only a few lines of code. Yet, if you want to provide an administration panel, I would recommend to use either a CMS, or for custom features, a full-stack Symfony2 application with Symfony2 full framework, and &lt;a href=&quot;https://github.com/sonata-project/SonataAdminBundle&quot;&gt;SonataAdmin bundle&lt;/a&gt; for instance.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Create a clickable SVG map</title>
   <link href="http://www.jonathan-petitcolas.com/2013/07/18/create-clickable-svg-france-regions-map.html"/>
   <updated>2013-07-18T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2013/07/18/create-clickable-svg-france-regions-map</id>
   <content type="html">&lt;script src=&quot;/labs/svg/raphael-min.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;In my career, I often faced customers wanting a clickable France regions or departments map. Several years ago, I was used to implementing a Flash map. It was functional, even if it had several disadvantages:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;It requires a plug-in. Even if it was widely installed, it is not native.&lt;/li&gt;
&lt;li&gt;Flash components have really poor performances on Linux.&lt;/li&gt;
&lt;li&gt;You have to learn a specific language to develop with Flash: Actionscript.&lt;/li&gt;
&lt;li&gt;Forget the mobile devices: as iOS, some of them would simply not display your map.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Then, I discovered SVG technology allowing to draw vectorial images and/or animations. With a framework like &lt;a href=&quot;http://www.raphaeljs.com&quot;&gt;Raphaël.js&lt;/a&gt;, it was really simple to achieve a Flash-less map.&lt;/p&gt;

&lt;p&gt;What about compatibility with oldest browsers? Well, no problem here, as this framework is Internet Explorer 6 compliant, falling back to VML if SVG is not available. And as it is currently reasonable to forget IE before the 8th version, you can consider using SVG is safe.&lt;/p&gt;

&lt;p&gt;In this post, we will focus on creating a France regions map. Yet, the process is exactly the same for all maps you may imagine.&lt;/p&gt;

&lt;p&gt;First of all, let&amp;#39;s create our page, containing our map container: a simple div.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html5&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;charset=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;utf-8&amp;quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;France regions map in SVG with Raphaël.js&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;map&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;js/raphael-min.js&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;js/map.js&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We just declare our container and include &lt;a href=&quot;http://www.raphaeljs.com&quot;&gt;Raphaël.js&lt;/a&gt; library, and our map drawing script. Let&amp;#39;s initialize Raphaël:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;MAP_WIDTH&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;620&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;MAP_HEIGHT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;600&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;mapContainer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;map&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Raphael&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;mapContainer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;MAP_WIDTH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;MAP_HEIGHT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This way, Raphaël.js is able to draw into our &lt;code&gt;map&lt;/code&gt; div, in an area of &lt;code&gt;MAP_WIDTH&lt;/code&gt;x&lt;code&gt;MAP_HEIGHT&lt;/code&gt;.  If you refresh the page, you should not see anything, as we drew nothing yet. Let&amp;#39;s fix it by creating our first region.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;style&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;#ddd&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;stroke&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;#aaa&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;stroke-width&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;stroke-linejoin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;round&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;cursor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;pointer&amp;quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 69.78125,123.21875 -1.78125,1.375 -4.46875,0.5625 -1,1.375 -3.125,-2.34375 -4.09375,2.75 1.5625,2.125 -2.71875,3.71875 -3.34375,-1.9375 -5.46875,0.1875 0,3.90625 -1.5625,0 -0.375,-1.75 -2.34375,0.375 -0.40625,-4.5 -2.125,2.34375 -2.34375,-0.96875 -4.3125,0.40625 -0.78125,1.9375 -2.53125,0.59375 -0.40625,-2.15625 -4.46875,0.59375 0,1.375 -3.125,0.1875 -1.375,-0.96875 -1.5625,0.78125 -0.40625,2.34375 -5.25,0.1875 -2.75,3.3125 2.34375,1.75 -3.125,2.5625 0.96875,1.75 -0.78125,4.28125 3.125,0.40625 1.1875,-1.1875 0.59375,0.78125 7.40625,-0.96875 4.875,-3.5 -4.28125,4.09375 0.375,1.9375 3.90625,-1.75 -0.78125,2.75 4.3125,0.1875 -0.1875,1.15625 -4.6875,-0.1875 -3.71875,-0.96875 -4.5,-2.15625 -2.71875,3.125 3.5,1.1875 -0.1875,5.25 0.96875,-0.78125 2.15625,-3.3125 4.09375,2.34375 1.96875,0.40625 0.78125,3.125 -1.1875,2.125 -2.53125,-0.1875 -2.34375,0 -3.90625,0.59375 -6.65625,0.375 L 8.84375,166 l 1.9375,1.15625 2.15625,-0.1875 1.75,1.5625 2.53125,-0.1875 4.125,4.6875 0.96875,5.0625 -1.375,2.75 4.09375,0.78125 4.5,-0.21875 0.96875,-1.75 -1.75,-2.34375 1.75,0.78125 1.78125,-0.1875 3.125,1.75 1.9375,-0.375 0,-3.34375 0.78125,3.34375 2.53125,4.09375 5.46875,0.375 0.21875,-1.15625 1.34375,1.9375 3.34375,0.59375 2.53125,0 2.34375,3.71875 3.125,0.78125 1.15625,-1.75 -0.5625,2.125 2.71875,1.1875 3.53125,3.5 1.15625,2.15625 -0.375,2.53125 -0.40625,2.5625 2.34375,1.75 1.1875,-1.375 -1.1875,-1.5625 0,-3.5 2.34375,0.5625 0.78125,-2.34375 0.59375,1.375 2.53125,2.15625 1.1875,-1.96875 -1.1875,-2.71875 L 77,197.25 l 2.71875,-0.40625 -0.5625,-1.375 2.53125,0.59375 1.9375,2.34375 -0.96875,1.5625 -2.53125,-0.78125 -2.9375,-1.375 -1.5625,1.96875 2.34375,0.78125 1.75,2.71875 10.5625,-0.96875 2.71875,0.59375 -1.34375,1.15625 0.1875,1.78125 0.375,0.28125 0.84375,-0.15625 1.75,-1.75 1.15625,1.34375 3.125,0 3.71875,-1.9375 5.46875,-2.15625 0.1875,-5.46875 5.09375,-2.71875 12.09375,-0.59375 0.78125,-2.15625 1.96875,-1.9375 4.28125,-0.59375 0.1875,-2.15625 2.9375,0.40625 1.75,2.34375 3.9375,0.96875 0.75,-1.5625 1,-3.53125 2.53125,-6.25 1.375,-0.78125 3.3125,0.40625 0,-5.28125 -1.375,-1.375 0,-5.65625 -0.59375,-1.9375 0,-3.125 1.96875,-1.96875 0,-3.90625 -0.96875,-0.78125 0.1875,-5.46875 -1.5625,-0.78125 -2.34375,0 -1.96875,-1.5625 -2.125,2.53125 -1.75,0.21875 -1.5625,2.125 -1.5625,-0.375 -3.34375,-2.9375 -1.15625,-3.71875 -0.59375,-2.46875 -9.59375,0 -3.53125,-2.15625 2.34375,-3.125 -4.6875,-0.1875 -3.125,3.53125 -3.71875,-0.40625 -0.375,2.15625 -2.34375,0.1875 -0.1875,-2.71875 -1.96875,-0.59375 -1.375,1.5625 0,-3.90625 -2.34375,1.75 -3.5,-0.59375 -1.1875,2.34375 -7.21875,3.90625 0,1.96875 -1.5625,0 0,-3.53125 -4.09375,-1.9375 0.375,-3.53125 -3.6875,-2.71875 0,-3.3125 -2.75,-0.59375 0.1875,-3.125 -2.125,-0.1875 0.1875,-2.15625 -3.90625,0 -0.59375,1.9375 -1.15625,-2.71875 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We first define a style for our map: we want to draw a gray map, with darker borders (&lt;code&gt;stroke&lt;/code&gt;) of 1px. All segments composing our region are softly linked, by rounded line joins. Several types of joins are available, as shown on the &lt;a href=&quot;http://www.w3.org/TR/SVG/painting.html#StrokeProperties&quot;&gt;W3C normalization page&lt;/a&gt;:&lt;/p&gt;

&lt;p class=&quot;center&quot;&gt;
    &lt;img src=&quot;/img/posts/svg-linejoins.png&quot; alt=&quot;SVG linejoins&quot; title=&quot;SVG linejoins&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;Then, we draw our region with &lt;code&gt;path&lt;/code&gt; function, before setting it corresponding style, which produces the following (I just moved the region with &lt;code&gt;translate&lt;/code&gt; method to avoid a big blank in this article):&lt;/p&gt;

&lt;div id=&quot;map-00&quot;&gt;&lt;/div&gt;

&lt;script src=&quot;/labs/svg/clickable-map/00.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;The code is not really difficult to understand, but the region path is rather enigmatic, isn&amp;#39;t it?&lt;/p&gt;

&lt;p&gt;The theory is simple. The &lt;code&gt;m&lt;/code&gt; stands for &lt;code&gt;MoveTo&lt;/code&gt;. Then, we specify a set of coordinates, corresponding to each vertice of our region. At the end, the &lt;code&gt;z&lt;/code&gt; letter means &lt;code&gt;ClosePath&lt;/code&gt;: it links the last point to the first one. Yet, in practice, there is a very simple way. For the France map, I just opened the &lt;a href=&quot;http://fr.wikipedia.org/wiki/Fichier:R%C3%A9gions_de_France.svg&quot;&gt;SVG picture of French regions&lt;/a&gt; on Wikipedia with a text editor. Then, I looked for all French region. For the previous case, I found the following:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;path&lt;/span&gt;
       &lt;span class=&quot;na&quot;&gt;style=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;fill:#00ff03;fill-opacity:0.21000001;fill-rule:evenodd;stroke:#7f7f7f;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;display:inline&amp;quot;&lt;/span&gt;
       &lt;span class=&quot;na&quot;&gt;d=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;m 69.78125,123.21875 -1.78125,1.375 -4.46875,0.5625 -1,1.375 -3.125,-2.34375 -4.09375,2.75 1.5625,2.125 -2.71875,3.71875 -3.34375,-1.9375 -5.46875,0.1875 0,3.90625 -1.5625,0 -0.375,-1.75 -2.34375,0.375 -0.40625,-4.5 -2.125,2.34375 -2.34375,-0.96875 -4.3125,0.40625 -0.78125,1.9375 -2.53125,0.59375 -0.40625,-2.15625 -4.46875,0.59375 0,1.375 -3.125,0.1875 -1.375,-0.96875 -1.5625,0.78125 -0.40625,2.34375 -5.25,0.1875 -2.75,3.3125 2.34375,1.75 -3.125,2.5625 0.96875,1.75 -0.78125,4.28125 3.125,0.40625 1.1875,-1.1875 0.59375,0.78125 7.40625,-0.96875 4.875,-3.5 -4.28125,4.09375 0.375,1.9375 3.90625,-1.75 -0.78125,2.75 4.3125,0.1875 -0.1875,1.15625 -4.6875,-0.1875 -3.71875,-0.96875 -4.5,-2.15625 -2.71875,3.125 3.5,1.1875 -0.1875,5.25 0.96875,-0.78125 2.15625,-3.3125 4.09375,2.34375 1.96875,0.40625 0.78125,3.125 -1.1875,2.125 -2.53125,-0.1875 -2.34375,0 -3.90625,0.59375 -6.65625,0.375 L 8.84375,166 l 1.9375,1.15625 2.15625,-0.1875 1.75,1.5625 2.53125,-0.1875 4.125,4.6875 0.96875,5.0625 -1.375,2.75 4.09375,0.78125 4.5,-0.21875 0.96875,-1.75 -1.75,-2.34375 1.75,0.78125 1.78125,-0.1875 3.125,1.75 1.9375,-0.375 0,-3.34375 0.78125,3.34375 2.53125,4.09375 5.46875,0.375 0.21875,-1.15625 1.34375,1.9375 3.34375,0.59375 2.53125,0 2.34375,3.71875 3.125,0.78125 1.15625,-1.75 -0.5625,2.125 2.71875,1.1875 3.53125,3.5 1.15625,2.15625 -0.375,2.53125 -0.40625,2.5625 2.34375,1.75 1.1875,-1.375 -1.1875,-1.5625 0,-3.5 2.34375,0.5625 0.78125,-2.34375 0.59375,1.375 2.53125,2.15625 1.1875,-1.96875 -1.1875,-2.71875 L 77,197.25 l 2.71875,-0.40625 -0.5625,-1.375 2.53125,0.59375 1.9375,2.34375 -0.96875,1.5625 -2.53125,-0.78125 -2.9375,-1.375 -1.5625,1.96875 2.34375,0.78125 1.75,2.71875 10.5625,-0.96875 2.71875,0.59375 -1.34375,1.15625 0.1875,1.78125 0.375,0.28125 0.84375,-0.15625 1.75,-1.75 1.15625,1.34375 3.125,0 3.71875,-1.9375 5.46875,-2.15625 0.1875,-5.46875 5.09375,-2.71875 12.09375,-0.59375 0.78125,-2.15625 1.96875,-1.9375 4.28125,-0.59375 0.1875,-2.15625 2.9375,0.40625 1.75,2.34375 3.9375,0.96875 0.75,-1.5625 1,-3.53125 2.53125,-6.25 1.375,-0.78125 3.3125,0.40625 0,-5.28125 -1.375,-1.375 0,-5.65625 -0.59375,-1.9375 0,-3.125 1.96875,-1.96875 0,-3.90625 -0.96875,-0.78125 0.1875,-5.46875 -1.5625,-0.78125 -2.34375,0 -1.96875,-1.5625 -2.125,2.53125 -1.75,0.21875 -1.5625,2.125 -1.5625,-0.375 -3.34375,-2.9375 -1.15625,-3.71875 -0.59375,-2.46875 -9.59375,0 -3.53125,-2.15625 2.34375,-3.125 -4.6875,-0.1875 -3.125,3.53125 -3.71875,-0.40625 -0.375,2.15625 -2.34375,0.1875 -0.1875,-2.71875 -1.96875,-0.59375 -1.375,1.5625 0,-3.90625 -2.34375,1.75 -3.5,-0.59375 -1.1875,2.34375 -7.21875,3.90625 0,1.96875 -1.5625,0 0,-3.53125 -4.09375,-1.9375 0.375,-3.53125 -3.6875,-2.71875 0,-3.3125 -2.75,-0.59375 0.1875,-3.125 -2.125,-0.1875 0.1875,-2.15625 -3.90625,0 -0.59375,1.9375 -1.15625,-2.71875 z&amp;quot;&lt;/span&gt;
       &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;FRA2&amp;quot;&lt;/span&gt;
       &lt;span class=&quot;na&quot;&gt;inkscape:label=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;Bretagne&amp;quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We note our path in the eponymous tag. In this case, pathes are labelled correctly, helping us to find pathes really easily. Now, we just have to finalize our whole France map:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{};&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;alsace&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;M 480.71875,112.28125 477,113.3125 l -1.71875,3 0,2.9375 -1.5625,1.375 -1.375,0 -2.53125,-1.78125 -1.96875,1.375 -2.34375,0 -1.9375,-1.9375 -3.71875,-0.59375 -2.15625,-0.96875 -0.78125,-2.9375 -1.75,1.9375 -0.96875,4.5 -2.5625,0.78125 0,2.53125 2.5625,1.1875 1.9375,1.375 -0.78125,1.75 1.78125,1.15625 3.125,-2.34375 5.4375,3.125 -2.3125,4.3125 0.1875,1.375 1.5625,1.5625 -1.1875,4.09375 -3.90625,3.90625 -2.15625,-0.1875 1.375,1.34375 -0.78125,3.53125 L 459.25,155 l 3.71875,0.96875 -2.15625,4.875 -2.34375,4.6875 0.59375,2.9375 -1.9375,4.5 -3.34375,2.90625 -0.1875,7.625 -2.4375,2.09375 0.0937,0.0625 0.78125,1.5625 3.125,0.1875 3.53125,2.75 0.5625,1.34375 -0.1875,2.34375 -0.96875,1.78125 0.375,2.34375 2.75,-0.40625 0.59375,2.15625 0.96875,4.15625 2.3125,-0.375 -0.40625,2.125 1.375,1.1875 7.21875,-0.1875 3.71875,-2.9375 0.1875,-4.3125 1.96875,-2.53125 -2.5625,-2.9375 -1.34375,-3.125 1.5625,-2.125 0,-4.90625 0.96875,-2.34375 0,-3.90625 1.75,-2.53125 -1.9375,-2.71875 -0.21875,-6.25 5.09375,-9.96875 -0.59375,-5.65625 2.34375,-7.625 0.59375,-6.65625 5.0625,-3.6875 0,-2.34375 1.96875,-2.5625 1.5625,0 1.75,-1.75 -0.375,-3.3125 1.75,-4.6875 2.71875,-0.59375 L 496.5312,115 l -4.875,-0.5625 -4.3125,-2.15625 -2.9375,1.75 -1.5625,-1.75 -2.125,0 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;nord-pas-de-calais&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 285.78125,4.0625 -6.25,2.9375 -9.75,1.5625 -11.34375,2.15625 -8.59375,6.625 0,26.375 -0.0625,0.78125 3.03125,0.71875 0.96875,2.15625 2.34375,-0.59375 1.375,-1.75 1.75,0.59375 3.71875,2.90625 1.375,-0.5625 0.96875,2.34375 3.5,1.5625 0,1.9375 2.5625,0.96875 2.53125,-0.96875 4.875,-0.59375 1.1875,1 2.34375,-1 1.15625,1.96875 -2.90625,1.9375 0,2.75 0.96875,0.96875 0.78125,-0.1875 0.5625,-1.5625 1.78125,-1.1875 1.75,1.375 4.09375,1.375 1.75,0 0,-1.96875 2.5625,1.78125 0.1875,1.5625 -1.1875,1.75 2.15625,-1.1875 1.78125,-0.78125 0.75,1.375 0,1.375 2.9375,-1.5625 4.6875,0 1.75,1.75 1.5625,0.40625 1.5625,-1 2.15625,0 0.59375,1.1875 0.78125,-0.1875 2.34375,-1.375 2.34375,1.375 3.125,-2.15625 1.375,0 1.5625,1.375 3.125,-2.15625 1.34375,0.1875 1.1875,0.96875 4.3125,0.40625 0.375,1.75 2.15625,-1.9375 1.15625,0 0.78125,2.53125 3.71875,0.96875 1.0625,-0.71875 -0.3125,0 -0.1875,-1.9375 3.90625,-2.34375 -0.59375,-3.71875 -3.71875,-0.96875 0.96875,-1 0,-2.71875 2.9375,-2.15625 -0.78125,-1.5625 -6.25,-4.875 -10.9375,0.59375 -1.15625,1.9375 -1.375,0 0.1875,-6.84375 -3.125,-3.6875 -2.34375,0.375 -1.375,-1.5625 -3.90625,1.75 -1.34375,-1.34375 -2.75,-0.40625 -0.78125,-2.53125 -0.1875,-7.8125 -1.75,-0.78125 -0.21875,-1.1875 -1.15625,0 -0.40625,-2.34375 -2.53125,0.21875 -4.875,1.5625 -2.34375,2.90625 -2.34375,0 -1.5625,-1.9375 -0.59375,-2.15625 -1.9375,-2.15625 -2.75,0 -1.15625,-2.125 0,-3.34375 1.34375,-2.125 -0.78125,-2.9375 -2.53125,-5.09375 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;corse&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 568.92104,452.72493 -2.92969,1.95313 0.39062,1.95312 1.5625,1.95313 -1.75781,1.36719 0.78125,1.5625 -1.17187,1.36718 0,1.75782 1.95312,1.75781 0,2.73437 -1.17187,2.53907 -1.36719,0.58593 -1.5625,-2.14843 -2.73438,0.19531 -0.58593,-0.39063 -2.34375,0 -2.14844,1.95313 -0.78125,3.32031 -5.07813,0.97656 -3.90625,3.32032 -0.78125,2.14843 -1.95312,-0.19531 -0.97656,-1.17187 -0.58594,3.32031 -1.36719,0.58594 -0.39062,3.125 0.58593,1.36718 -2.14843,1.5625 -0.58594,1.5625 -1.5625,0 0,2.14844 1.95312,1.36719 3.32032,1.95312 0.19531,1.56251 -1.95313,0.58593 -3.125,0.58594 0,1.36719 1.17188,1.17187 0.19531,3.90625 4.29688,1.36719 1.5625,0.39063 1.36718,2.14843 -0.97656,1.36719 -1.5625,0.58594 -1.17187,2.14844 -1.17188,1.36718 0.58594,3.51563 2.92969,-0.19531 0.78125,0.58593 2.73437,-1.36718 0.78125,0.78125 -1.36719,2.92968 1.36719,1.36719 -2.34375,1.75781 -1.5625,3.51563 4.29688,0.97656 6.05468,0.58594 -2.53906,2.92969 c 0,0 -1.95312,-0.78125 -1.95312,0.19531 0,0.97656 -1.36719,3.32031 -1.36719,3.32031 l 1.95312,2.14844 3.51563,2.14844 6.64062,1.75781 1.95313,0.78125 1.75781,0.78125 -1.17187,2.14844 3.125,-0.19532 0.58593,1.36719 3.125,0 0.78125,-3.71094 -1.95312,-0.39062 2.73437,-2.92969 -0.97656,-0.97656 0.19531,-1.75781 3.51563,-1.95313 0.19531,-2.14844 -2.34375,-0.19531 -1.5625,1.36719 0,-1.95313 3.125,-0.19531 0.97656,-2.34375 0.78125,-6.83594 -0.58593,-2.92968 -0.19532,-8.59375 4.6875,-6.64063 0,-10.9375 -1.95312,-3.71094 -0.58594,-11.71875 -1.36719,-2.14844 -2.53906,-1.95312 -0.39062,-7.22656 1.17187,-3.32032 -1.5625,-5.27343 -0.97656,-4.29688 -0.78125,-1.17187 -1.75781,-0.97657 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;rhone-alpes&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 383.28125,262.59375 -2.15625,0.21875 -1.375,2.53125 -3.6875,14.4375 -1.1875,2.75 -1.375,-0.1875 -0.75,-3.90625 -1,-3.125 -2.125,0.1875 -1.78125,1.75 -1.15625,-1.5625 -1.75,1.5625 -2.375,-1.5625 -1.9375,0 -0.78125,0.59375 -1.15625,6.25 -2.15625,0 -1.5625,1.5625 -1.1875,-1.1875 -6.25,-0.96875 -2.34375,1.375 -1.5625,0 -0.375,-1.375 -2.9375,-0.59375 -0.1875,-3.125 -0.59375,-0.1875 L 336,278.625 l -0.5625,2.15625 1.375,2.71875 0.375,11.125 -4.6875,0.21875 -0.1875,1.75 3.125,2.53125 -1.75,1.75 -0.59375,4.3125 2.34375,3.125 2.125,5.0625 5.09375,3.34375 1.75,6.4375 -3.71875,3.5 0.59375,2.34375 5.46875,1.78125 4.3125,-3.53125 2.125,-0.1875 6.25,2.71875 -0.375,3.71875 3.125,-0.1875 2.53125,2.9375 -1.15625,4.6875 -2.75,1.15625 -1.15625,1.96875 0.78125,2.53125 0.5625,1.375 -2.90625,0 -0.21875,3.6875 -3.125,0.21875 -1.5625,4.875 -4.6875,0 -5.0625,3.71875 -2.8125,4.46875 0.46875,0.59375 1.375,7.1875 3.3125,3.59375 -0.5625,4.125 4.15625,2.5 0,5.53125 2.21875,-1.125 4.6875,3.0625 2.21875,0.8125 0.53125,-3.875 2.78125,-0.53125 0.8125,3.03125 2.78125,-0.28125 0.53125,-3.03125 6.34375,3.5625 1.03125,-2.09375 5.28125,-0.78125 1.15625,1.375 -0.5625,3.90625 0.78125,0.96875 2.90625,-2.9375 2.5625,-0.1875 0.5625,-1.5625 -3.3125,-0.40625 -0.5625,-3.5 2.125,-3.3125 2.75,-0.21875 2.71875,2.5625 -2.71875,3.6875 0.78125,1.375 3.90625,0.40625 2.53125,-2.15625 -1.375,2.9375 0.40625,2.34375 4.09375,0.375 5.46875,0.40625 0.78125,2.53125 2.9375,2.15625 2.53125,0.1875 1.75,-1.5625 1,-2.9375 1.5625,1.375 1.15625,1.375 0.78125,-7.25 -1.9375,-0.375 -1.1875,-2.53125 -6.625,-1.78125 -0.8125,-3.3125 2.375,-1.5625 -1.96875,-1.375 0.40625,-1.75 3.125,0.1875 2.71875,1.375 2.15625,-2.53125 -2.15625,-1.75 0.1875,-2.34375 1.1875,-3.71875 4.09375,-0.40625 3.3125,-1.34375 0.59375,-1.375 -1.5625,-0.78125 0,-2.34375 4.875,0 1.5625,-1.5625 -0.96875,-1.75 2.53125,-1.96875 1.78125,0.78125 2.53125,-2.15625 4.46875,0.78125 1.5625,-1.75 3.71875,0.1875 0,-4.28125 -1.5625,-0.78125 -0.78125,-2.53125 L 434.84375,346 434.25,345.03125 l 0.78125,-4.09375 1.375,-1.1875 3.53125,-0.375 1.15625,1.15625 0.59375,2.75 3.5,-0.40625 0.40625,-2.9375 1.75,-0.78125 3.75,0.1875 -0.0625,-0.125 5.84375,-2.34375 2.15625,1.375 2.15625,0 0.1875,-2.34375 2.53125,-1.375 0.96875,-1.15625 5.09375,-1.96875 0.59375,-3.3125 -1,-1.5625 2.75,-4.6875 L 469.78125,320.875 469,318.125 463.71875,315 c 0,0 0.31502,-5.98725 -0.1875,-7.0625 -0.0158,-0.0269 -0.0497,-0.0773 -0.0625,-0.0937 -0.005,-0.005 -0.0261,-0.0266 -0.0313,-0.0313 -0.004,2.2e-4 -0.0284,-7e-5 -0.0313,0 -5e-5,-0.007 -1.7e-4,-0.0294 0,-0.0313 -0.004,1.2e-4 -0.0284,-4e-5 -0.0313,0 -0.003,-1.5e-4 -0.0283,-7e-5 -0.0313,0 -0.004,-8e-5 -0.0284,10e-6 -0.0313,0 -0.78125,0.19532 -3.6875,0.40625 -3.6875,0.40625 l -2.9375,-3.34375 0.1875,-6.625 6.65625,-2.75 0.78125,-1.9375 -0.40625,-4.3125 -4.28125,-4.46875 -1.375,0.78125 0,-1.78125 0,-2.90625 -3.71875,-1.78125 -0.1875,-1.5625 2.15625,-2.34375 0,-2.71875 -3.53125,-3.71875 -0.1875,-2.53125 -6.65625,0 -4.46875,0.78125 -4.3125,3.5 -1.15625,-1.75 -2.15625,0.1875 -1.96875,4.3125 0.21875,1.75 2.125,1.75 -3.90625,2.5625 -2.53125,2.34375 -6.4375,0 0,-3.71875 2.34375,-1.375 3.5,-0.375 0.21875,-1.96875 -1.1875,-0.78125 2.9375,-3.71875 -0.40625,-1.15625 -3.34375,-1.78125 -8.125,8.9375 -5.65625,0 0,-2.34375 -3.125,-1.5625 -3.71875,4.09375 -2.9375,0.40625 0,-2.75 -2.53125,-1.15625 -3.90625,-5.46875 -3.53125,-1.375 -1.15625,-2.53125 -1.96875,-0.40625 -1.9375,1.375 -1.5625,0.40625 -2.15625,-1.78125 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;franche-comte&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 423.5,175.5 -3.6875,0.59375 -0.59375,1.9375 -1.96875,1.375 -1.34375,-1.5625 -0.96875,0.59375 0.75,1.15625 -1.9375,1.1875 0.59375,1.5625 -2.15625,0.78125 0,2.53125 -2.75,0 -0.1875,1.5625 -2.71875,0.59375 0.1875,2.34375 1.75,0.1875 L 407.5,191.5 l -0.59375,3.90625 -1.75,0 -2.9375,1.1875 -3.125,-1.1875 -2.71875,1.1875 0,1.96875 2.125,0.375 1.5625,3.125 0.21875,1.5625 -2.53125,2.9375 -1.1875,0.375 -0.78125,0.96875 2.15625,1 0.375,3.125 1.75,0.1875 0.21875,3.90625 0.78125,0.78125 0.1875,1.15625 -0.78125,0 -0.40625,3.125 -0.5625,2.15625 0.375,1.375 -1.15625,1.5625 -1.1875,1.5625 0,1.5625 -3.3125,1.5625 -0.96875,1.5625 0.375,1.15625 0.1875,1 -1.34375,0.78125 L 392.25,238 l 1.5625,0.1875 1.78125,2.9375 2.15625,0 1.15625,1.375 1.375,0 -0.40625,1.5625 -4.5,0.5625 0.40625,1.5625 1.5625,1 0,1.9375 -0.59375,0.59375 1.1875,1.5625 1.75,3.125 -0.78125,3.3125 -1.96875,1.375 0.21875,2.71875 2.34375,0.78125 0.78125,1.1875 -1.96875,1.5625 -5.125,0.625 2.40625,0.9375 3.90625,5.46875 2.53125,1.15625 0,2.75 2.9375,-0.40625 3.71875,-4.09375 3.125,1.5625 0,2.34375 5.65625,0 8.125,-8.9375 -0.34375,-0.1875 0.375,-4.09375 2.9375,-3.5 -1.96875,-0.78125 0.21875,-1.375 12.09375,-11.34375 -0.375,-9.375 4.28125,-2.125 2.9375,-1.375 2.71875,-2.53125 0.21875,-3.71875 2.71875,-1.375 6.25,-7.21875 -0.96875,-2.34375 2.15625,-0.96875 2.53125,-3.125 -1.375,-1.375 -4.6875,0.96875 -0.1875,-0.78125 5.0625,-5.84375 2.59375,-0.40625 -0.96875,-4.15625 -0.59375,-2.15625 -2.75,0.40625 -0.375,-2.34375 0.96875,-1.78125 0.1875,-2.34375 -0.5625,-1.34375 -3.53125,-2.75 -3.125,-0.1875 -0.78125,-1.5625 -6.25,-3.3125 -1.75,-1.96875 -1.75,-1.15625 -1.5625,0.78125 -0.21875,1.15625 -1.5625,0.96875 -0.96875,0 -2.9375,-3.3125 -4.09375,0 -1.75,1.375 -1.5625,0.1875 -2.53125,-1.9375 0.1875,-2.15625 -1,-0.78125 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;lorraine&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 390.125,86.53125 -1.375,2.25 -1.75,1.15625 -1.375,-1.34375 -2.9375,0 -0.5625,-0.78125 -1.96875,3.6875 -0.78125,1.375 2.34375,2.9375 -0.78125,3.90625 -2.15625,1.75 0.21875,1.375 0.75,1.9375 -1.15625,1.1875 -2.34375,1.15625 0.375,2.15625 1,0.1875 -1.75,1.5625 1.34375,2.9375 1.375,4.3125 -1.75,1.9375 3.125,-0.1875 -1.5625,4.875 -2.15625,0.96875 -1.1875,2.9375 1.1875,0.96875 -1.375,2.34375 0.40625,1.5625 3.71875,2.9375 0.1875,6.84375 4.09375,0.59375 2.53125,2.71875 4.6875,2.34375 1.75,0.59375 4.125,4.5 -1.75,1.75 1.34375,1.9375 3.125,0.21875 2.75,3.6875 2.34375,0 0.5625,2.5625 2.5625,0.375 0.5625,1.75 -1.75,1.1875 -1.15625,5.28125 5.46875,2.71875 0,4.09375 2.125,-0.78125 1.78125,1.40625 1.34375,-0.8125 -0.75,-1.15625 0.96875,-0.59375 1.34375,1.5625 1.96875,-1.375 0.59375,-1.9375 3.6875,-0.59375 1,0.78125 -0.1875,2.15625 2.53125,1.9375 1.5625,-0.1875 1.75,-1.375 4.09375,0 2.9375,3.3125 0.96875,0 1.5625,-0.96875 0.21875,-1.15625 1.5625,-0.78125 1.75,1.15625 1.75,1.96875 6.15625,3.25 2.4375,-2.09375 0.1875,-7.625 3.34375,-2.90625 1.9375,-4.5 -0.59375,-2.9375 2.34375,-4.6875 2.15625,-4.875 L 459.25,155 l -0.78125,-5.28125 0.78125,-3.53125 -1.375,-1.34375 2.15625,0.1875 3.90625,-3.90625 1.1875,-4.09375 -1.5625,-1.5625 -0.1875,-1.375 2.3125,-4.3125 -5.4375,-3.125 -3.125,2.34375 -1.78125,-1.15625 0.78125,-1.75 -1.9375,-1.375 -2.5625,-1.1875 0,-2.53125 2.5625,-0.78125 0.96875,-4.5 1.75,-1.9375 0.78125,2.9375 2.15625,0.96875 3.71875,0.59375 1.9375,1.9375 2.34375,0 1.96875,-1.375 2.53125,1.78125 1.375,0 1.5625,-1.375 0,-2.9375 1.71875,-3 -0.40625,0.125 -1.34375,-1.9375 -3.90625,-2.34375 -1.375,-2.15625 -4.6875,0.40625 -2.75,2.53125 -6.625,0.1875 -1.96875,-1.375 c -0.13199,-0.23943 -1.09313,-1.93562 -1.9375,-2.40625 -0.0327,-0.0174 -0.0865,-0.0457 -0.125,-0.0625 -0.0285,-0.0117 -0.0699,-0.0243 -0.0937,-0.0313 -0.0107,-0.005 -0.0512,-0.0255 -0.0625,-0.0313 -0.003,1e-5 -0.0278,-1.4e-4 -0.0313,0 -0.025,-10e-4 -0.0737,0 -0.0937,0 -0.91552,1e-5 -2.6881,-1.0275 -2.90625,-1.15625 l -2.75,1.15625 -0.1875,2.34375 -3.3125,0.40625 -1.96875,-3.71875 -1.15625,-0.40625 0,-2.71875 -2.75,-1.1875 -0.1875,-4.6875 -1.96875,-1.9375 -4.09375,-1.96875 -1.9375,0 -0.59375,0.40625 -1.96875,0 -2.71875,-2.34375 -2.9375,0.1875 -2.34375,1.96875 -0.59375,0.96875 -3.3125,0 -1.15625,-1.1875 -3.125,0 -3.53125,-3.90625 -4.5,0 -2.34375,2.15625 -3.3125,0.1875 -1.15625,1.1875 -1.1875,0 -0.7813,-3.71865 -1.5625,-1.5625 -1.125,-0.15625 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;champagne-ardenne&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 367.625,55.84375 -1.96875,2.90625 -1.75,1.78125 0,1.75 0,2.34375 -2.34375,1.5625 -4.28125,1.375 -2.34375,0.96875 -2.75,-2.15625 -3.71875,0 -0.53125,3.46875 1.75,3.3125 -1.75,1.5625 -0.1875,2.9375 0.96875,1.5625 -0.78125,2.34375 -2.9375,1.5625 0,2.53125 -3.71875,0.78125 -0.59375,1.5625 2.5625,1.375 -0.78125,2.71875 -0.59375,2.34375 0.1875,6.65625 -1.375,0.375 -3.3125,-2.15625 -2.34375,1 0.40625,1.9375 -4.125,0 -3.6875,2.75 0,5.25 2.71875,1.78125 0.78125,1.75 -4.5,0.375 -0.5625,1.78125 1.75,1.15625 -0.78125,1.1875 -1.75,0.78125 0.375,1.34375 2.53125,0 1,1.375 -1.75,1.1875 -1.5625,4.09375 -2.9375,1.375 -1,2.125 -0.96875,1.1875 0.21875,1.15625 -1.5625,1 -0.40625,2.71875 1.5625,0.96875 0.78125,2.9375 -0.96875,1.75 0.59375,1.375 2.90625,-0.1875 0,1.5625 -2.71875,1.15625 -0.1875,2.34375 -1.375,1.78125 -0.78125,3.90625 -0.4375,3.28125 1.21875,1 2.34375,0 5.0625,5.28125 -0.59375,5.28125 3.53125,2.71875 1.96875,-1.375 3.125,3.71875 0.375,3.53125 2.15625,2.90625 0.96875,2.15625 7.8125,0.40625 3.90625,-1.96875 1.15625,2.15625 1.375,0.1875 1,-2.15625 6.4375,-0.1875 2.53125,-1.375 0.40625,-2.53125 5.65625,0 3.125,1.75 3.5,3.71875 4.5,6.0625 -2.53125,2.71875 1.75,1.1875 0.1875,3.3125 3.125,-0.1875 0.78125,1.5625 2.34375,0.1875 1.75,-0.96875 3.125,3.90625 0.40625,0.96875 4.28125,-0.96875 0.8125,-1.96875 0.1875,0.0313 0,-1.96875 2.71875,-1.1875 3.125,1.1875 2.9375,-1.1875 1.75,0 0.59375,-3.9063 0.96875,-1.15625 -1.75,-0.1875 -0.1875,-2.34375 2.71875,-0.59375 0.1875,-1.5625 2.75,0 0,-2.53125 2.15625,-0.78125 -0.59375,-1.5625 0.59375,-0.375 L 412.5625,179 l -2.125,0.78125 0,-4.09375 -5.46875,-2.71875 1.15625,-5.28125 1.75,-1.1875 -0.5625,-1.75 -2.5625,-0.375 -0.5625,-2.5625 -2.34375,0 -2.75,-3.6875 -3.125,-0.21875 -1.34375,-1.9375 1.75,-1.75 -4.125,-4.5 -1.75,-0.59375 -4.6875,-2.34375 -2.53125,-2.71875 -4.09375,-0.59375 L 379,136.625 l -3.71875,-2.9375 -0.40625,-1.5625 1.375,-2.34375 -1.1875,-0.96875 1.1875,-2.9375 2.15625,-0.96875 1.5625,-4.875 -3.125,0.1875 1.75,-1.9375 -1.375,-4.3125 -1.34375,-2.9375 1.75,-1.5625 -1,-0.1875 -0.375,-2.15625 2.34375,-1.15625 1.15625,-1.1875 -0.75,-1.9375 -0.21875,-1.375 2.15625,-1.75 0.78125,-3.90625 -2.34375,-2.9375 0.78125,-1.375 1.96875,-3.6875 0.5625,0.78125 2.9375,0 1.375,1.34375 1.75,-1.15625 1.375,-2.25 -1.40625,-0.21875 -0.78125,-3.90625 -1.5625,-1.1875 -5.46875,-0.59375 -0.96875,-2.53125 -1.78125,-1.15625 -6.25,-0.78125 -0.375,-4.5 0.78125,-0.78125 0,-1.75 -3.125,-1.96875 0.59375,-2.15625 0.78125,-1.9375 -1.375,-1.1875 2.15625,-1.9375 0,-3.53125 -0.78125,-0.5625 -2.9375,0 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;picardie&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 249.78125,44.5 -0.53125,6.4375 4.3125,3.90625 0,1.96875 -5.28125,-3.125 -6.34375,7.8125 1.6875,0.71875 2.15625,-0.1875 0.96875,1.9375 8.59375,8.40625 0.59375,3.5 1.9375,3.53125 -1.9375,2.34375 -0.78125,1.9375 1.5625,0 -0.78125,1.96875 -0.78125,3.90625 1.15625,1.9375 0,3.34375 1.96875,0 -0.78125,1.34375 -1.375,2.5625 -0.5625,1.75 1.75,1.5625 0.5625,4.5 1,1.5625 -1.375,0.375 -1.75,-0.96875 -0.3125,2.3125 0.125,-0.15625 0.75,1.75 1.1875,1.9375 5.28125,0.40625 3.71875,-0.40625 2.53125,-1.9375 3.125,1.9375 1.5625,1.1875 2.34375,-0.59375 2.125,-0.96875 4.125,2.15625 4.28125,2.53125 1.375,1.375 2.34375,-1.5625 1.9375,1.15625 1.1875,0.96875 1.75,-0.1875 1.1875,-1.5625 2.71875,1.5625 3.34375,-1.375 1.9375,0.59375 1.9375,-1.5625 1.1875,-0.59375 2.15625,1.5625 0.59375,4.3125 5.25,5.0625 1.75,0.59375 1,2.34375 3.28125,0.6875 0.40625,-0.5 1,-2.125 2.9375,-1.375 1.5625,-4.09375 1.75,-1.1875 -1,-1.375 -2.53125,0 -0.375,-1.34375 1.75,-0.78125 0.78125,-1.1875 -1.75,-1.15625 0.5625,-1.78125 4.5,-0.375 -0.78125,-1.75 -2.71875,-1.78125 0,-5.25 3.6875,-2.75 4.125,0 -0.40625,-1.9375 2.34375,-1 3.3125,2.15625 1.375,-0.375 -0.1875,-6.65625 0.59375,-2.34375 L 343.25,89.375 340.6875,88 341.28125,86.4375 345,85.65625 l 0,-2.53125 2.9375,-1.5625 0.78125,-2.34375 -0.96875,-1.5625 0.1875,-2.9375 1.75,-1.5625 -1.75,-3.3125 0.53125,-3.46875 -3.96875,0 -1.0625,0.71875 -3.71875,-0.96875 -0.78125,-2.53125 -1.15625,0 -2.15625,1.9375 -0.375,-1.75 -4.3125,-0.40625 -1.1875,-0.96875 -1.34375,-0.1875 -3.125,2.15625 -1.5625,-1.375 -1.375,0 -3.125,2.15625 -2.34375,-1.375 -2.34375,1.375 -0.78125,0.1875 -0.59375,-1.1875 -2.15625,0 -1.5625,1 -1.5625,-0.40625 -1.75,-1.75 -4.6875,0 -2.9375,1.5625 0,-1.375 -0.75,-1.375 -1.78125,0.78125 -2.15625,1.1875 1.1875,-1.75 -0.1875,-1.5625 -2.5625,-1.78125 0,1.96875 -1.75,0 -4.09375,-1.375 -1.75,-1.375 -1.78125,1.1875 -0.5625,1.5625 -0.78125,0.1875 -0.96875,-0.96875 0,-2.75 2.90625,-1.9375 -1.15625,-1.96875 -2.34375,1 -1.1875,-1 -4.875,0.59375 -2.53125,0.96875 -2.5625,-0.96875 0,-1.9375 -3.5,-1.5625 -0.96875,-2.34375 -1.375,0.5625 -3.71875,-2.90625 -1.75,-0.59375 -1.375,1.75 L 253.78125,47.375 252.8125,45.21875 249.78125,44.5 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;haute-normandie&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 241.9375,61.5 -1.28125,1.5625 -8.375,6.4375 -14.84375,3.71875 -9.78125,3.5 -8,4.3125 -4.6875,7.03125 -0.96875,5.46875 3.90625,2.9375 5.65625,1.15625 -0.90625,0.15625 0.9375,7.40625 1.96875,0.59375 0,0.78125 -1.96875,1.15625 2.34375,3.3125 1.1875,4.6875 -0.21875,1.96875 -1.75,1.15625 0.1875,1.375 1.96875,0.78125 0.1875,1.75 -1.5625,4.5 1.5625,1.96875 5.46875,0.1875 1.15625,2.71875 1.96875,1.96875 2.71875,0.96875 0.8125,2.9375 -1.375,1.9375 2.84375,1.90625 2.8125,-2.6875 2.71875,0 7.0625,-3.6875 2.3125,0.96875 4.90625,0 1.15625,-1.375 0,-2.9375 3.90625,-1.9375 0,-3.125 1.0625,-0.875 -0.0937,-0.875 1,-1 -1.75,-0.375 0,-1.5625 -1,-1.5625 0.78125,-0.96875 5.46875,-1.5625 1.375,-2.34375 1.1875,-4.3125 1.4375,-1.78125 0.3125,-2.3125 1.75,0.96875 1.375,-0.375 -1,-1.5625 -0.5625,-4.5 -1.75,-1.5625 0.5625,-1.75 1.375,-2.5625 0.78125,-1.34375 -1.96875,0 0,-3.34375 -1.15625,-1.9375 0.78125,-3.90625 0.78125,-1.96875 -1.5625,0 0.78125,-1.9375 1.9375,-2.34375 -1.9375,-3.53125 -0.59375,-3.5 -8.59375,-8.40625 -0.96875,-1.9375 -2.15625,0.1875 L 241.9375,61.5 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;basse-normandie&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 119.5625,77.5 -0.78125,1.96875 4.125,3.3125 0,4.3125 -1.5625,1.9375 L 122.3125,90 122.90625,90.40625 122.5,94.125 l 1.375,3.125 4.5,5.0625 0.96875,4.5 0.96875,1.375 0,7.03125 2.34375,4.6875 0,5.46875 -2.53125,5.0625 2.71875,7.03125 4.3125,0.96875 0.375,1.96875 -2.125,0.96875 -3.6875,0 0.59375,2.46875 1.15625,3.71875 3.34375,2.9375 1.5625,0.375 1.5625,-2.125 1.75,-0.21875 2.125,-2.53125 1.96875,1.5625 2.34375,0 1.5625,0.78125 0,0.375 3.3125,0.40625 1.96875,-1.5625 2.90625,1.1875 1.375,2.34375 2.15625,1.5625 2.9375,-1.96875 1.9375,1.375 5.28125,-3.125 5.28125,0.78125 2.90625,-1.1875 0.8125,-1.9375 1.9375,-0.1875 1.75,1.5625 0.78125,4.28125 2.53125,0.96875 1,3.53125 3.3125,0.1875 5.28125,-4.875 5.28125,-0.1875 L 204,154 l 0.96875,7.03125 3.3125,1.1875 1.96875,2.9375 4.09375,0 0.1875,1.34375 0.1875,-1.9375 0.78125,0 2.75,4.09375 2.125,0.34375 0,-4.625 -1.34375,-1.78125 -0.40625,-1.5625 2.9375,-1.75 2.9375,-0.59375 1.9375,-2.34375 -0.375,-7.21875 -4.125,-3.5 -0.1875,-3.34375 -3.5,-2.34375 1.375,-1.9375 -0.8125,-2.9375 -2.71875,-0.96875 -1.96875,-1.96875 -1.15625,-2.71875 -5.46875,-0.1875 -1.5625,-1.96875 1.5625,-4.5 -0.1875,-1.75 -1.96875,-0.78125 -0.1875,-1.375 1.75,-1.15625 0.21875,-1.96875 -1.1875,-4.6875 -2.34375,-3.3125 1.96875,-1.15625 0,-0.78125 -1.96875,-0.59375 -0.9375,-7.40625 -4.5625,0.8125 -7.4375,4.3125 -8.375,3.3125 -6.65625,-3.71875 -16,-2.34375 -3.71875,-1.9375 -7.625,1.9375 -0.1875,-4.6875 L 143,89.4375 l 1.5625,-3.90625 2.15625,0 -1.9375,-5.28125 -8.40625,-0.40625 -4.5,3.125 -5.0625,-3.3125 -7.25,-2.15625 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;bretagne&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 69.78125,123.21875 -1.78125,1.375 -4.46875,0.5625 -1,1.375 -3.125,-2.34375 -4.09375,2.75 1.5625,2.125 -2.71875,3.71875 -3.34375,-1.9375 -5.46875,0.1875 0,3.90625 -1.5625,0 -0.375,-1.75 -2.34375,0.375 -0.40625,-4.5 -2.125,2.34375 -2.34375,-0.96875 -4.3125,0.40625 -0.78125,1.9375 -2.53125,0.59375 -0.40625,-2.15625 -4.46875,0.59375 0,1.375 -3.125,0.1875 -1.375,-0.96875 -1.5625,0.78125 -0.40625,2.34375 -5.25,0.1875 -2.75,3.3125 2.34375,1.75 -3.125,2.5625 0.96875,1.75 -0.78125,4.28125 3.125,0.40625 1.1875,-1.1875 0.59375,0.78125 7.40625,-0.96875 4.875,-3.5 -4.28125,4.09375 0.375,1.9375 3.90625,-1.75 -0.78125,2.75 4.3125,0.1875 -0.1875,1.15625 -4.6875,-0.1875 -3.71875,-0.96875 -4.5,-2.15625 -2.71875,3.125 3.5,1.1875 -0.1875,5.25 0.96875,-0.78125 2.15625,-3.3125 4.09375,2.34375 1.96875,0.40625 0.78125,3.125 -1.1875,2.125 -2.53125,-0.1875 -2.34375,0 -3.90625,0.59375 -6.65625,0.375 L 8.84375,166 l 1.9375,1.15625 2.15625,-0.1875 1.75,1.5625 2.53125,-0.1875 4.125,4.6875 0.96875,5.0625 -1.375,2.75 4.09375,0.78125 4.5,-0.21875 0.96875,-1.75 -1.75,-2.34375 1.75,0.78125 1.78125,-0.1875 3.125,1.75 1.9375,-0.375 0,-3.34375 0.78125,3.34375 2.53125,4.09375 5.46875,0.375 0.21875,-1.15625 1.34375,1.9375 3.34375,0.59375 2.53125,0 2.34375,3.71875 3.125,0.78125 1.15625,-1.75 -0.5625,2.125 2.71875,1.1875 3.53125,3.5 1.15625,2.15625 -0.375,2.53125 -0.40625,2.5625 2.34375,1.75 1.1875,-1.375 -1.1875,-1.5625 0,-3.5 2.34375,0.5625 0.78125,-2.34375 0.59375,1.375 2.53125,2.15625 1.1875,-1.96875 -1.1875,-2.71875 L 77,197.25 l 2.71875,-0.40625 -0.5625,-1.375 2.53125,0.59375 1.9375,2.34375 -0.96875,1.5625 -2.53125,-0.78125 -2.9375,-1.375 -1.5625,1.96875 2.34375,0.78125 1.75,2.71875 10.5625,-0.96875 2.71875,0.59375 -1.34375,1.15625 0.1875,1.78125 0.375,0.28125 0.84375,-0.15625 1.75,-1.75 1.15625,1.34375 3.125,0 3.71875,-1.9375 5.46875,-2.15625 0.1875,-5.46875 5.09375,-2.71875 12.09375,-0.59375 0.78125,-2.15625 1.96875,-1.9375 4.28125,-0.59375 0.1875,-2.15625 2.9375,0.40625 1.75,2.34375 3.9375,0.96875 0.75,-1.5625 1,-3.53125 2.53125,-6.25 1.375,-0.78125 3.3125,0.40625 0,-5.28125 -1.375,-1.375 0,-5.65625 -0.59375,-1.9375 0,-3.125 1.96875,-1.96875 0,-3.90625 -0.96875,-0.78125 0.1875,-5.46875 -1.5625,-0.78125 -2.34375,0 -1.96875,-1.5625 -2.125,2.53125 -1.75,0.21875 -1.5625,2.125 -1.5625,-0.375 -3.34375,-2.9375 -1.15625,-3.71875 -0.59375,-2.46875 -9.59375,0 -3.53125,-2.15625 2.34375,-3.125 -4.6875,-0.1875 -3.125,3.53125 -3.71875,-0.40625 -0.375,2.15625 -2.34375,0.1875 -0.1875,-2.71875 -1.96875,-0.59375 -1.375,1.5625 0,-3.90625 -2.34375,1.75 -3.5,-0.59375 -1.1875,2.34375 -7.21875,3.90625 0,1.96875 -1.5625,0 0,-3.53125 -4.09375,-1.9375 0.375,-3.53125 -3.6875,-2.71875 0,-3.3125 -2.75,-0.59375 0.1875,-3.125 -2.125,-0.1875 0.1875,-2.15625 -3.90625,0 -0.59375,1.9375 -1.15625,-2.71875 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;auvergne&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 301.625,247.96875 -2.71875,3.5 -1.5625,0.1875 -1.75,1.78125 -1.96875,-2.15625 -5.25,5.28125 0,3.125 0.96875,0.78125 0.1875,1.5625 -2.71875,2.125 -2.5625,-0.78125 -4.875,1 -2.53125,2.90625 -0.9375,2 0.15625,-0.0313 2.34375,3.3125 0,2.34375 1.34375,1.75 1.375,-1.75 1.5625,2.75 2.15625,0.78125 L 287,283.5 l 0.375,6.0625 1.5625,1.9375 0.78125,3.71875 -2.34375,1.75 -0.5625,2.75 -2.15625,1.15625 -3.71875,2.15625 0.375,1.75 4.5,4.5 0.40625,2.75 -1.78125,2.90625 0,2.75 1.1875,1.375 0.59375,3.3125 -0.96875,3.5 0.96875,2.34375 -1.1875,1.375 -1.9375,0 -1.96875,-2.15625 -1.75,-0.96875 -0.1875,5.46875 -3.53125,2.15625 -2.53125,3.5 0.59375,3.53125 -0.78125,1.5625 -1,3.125 -1.5625,0 -1.5625,1.9375 1.1875,1.1875 0.78125,1.9375 -2.53125,1.78125 1.03125,6.53125 3.3125,2.46875 -2.5,5.8125 2.5,1.09375 -1.09375,3.3125 2.1875,0.28125 1.65625,-2.75 2.78125,0 0.53125,0.8125 6.09375,0 1.09375,-2.46875 1.375,-0.5625 0.5625,-4.40625 1.375,0 0,-4.6875 5.53125,-4.71875 0.5625,0.84375 0.53125,3.59375 3.875,-0.5625 0.84375,5.53125 1.90625,0 0.5625,5.53125 1.71875,2.125 2.8125,-6.46875 2.75,-8.59375 3.5,2.34375 1.5625,-3.5 5.46875,-1.96875 3.53125,9 5.0625,-1.5625 0.375,-2.34375 1.96875,0 0.78125,2.71875 3.625,-0.875 4.5,5.75 2.8125,-4.46875 5.0625,-3.71875 4.6875,0 1.5625,-4.875 3.125,-0.21875 0.21875,-3.6875 2.90625,0 -0.5625,-1.375 -0.78125,-2.53125 1.15625,-1.96875 2.75,-1.15625 1.15625,-4.6875 -2.53125,-2.9375 -3.125,0.1875 0.375,-3.71875 -6.25,-2.71875 -2.125,0.1875 -4.3125,3.53125 -5.46875,-1.78125 -0.59375,-2.34375 3.71875,-3.5 -1.75,-6.4375 -5.09375,-3.34375 -2.125,-5.0625 -2.34375,-3.125 0.59375,-4.3125 1.75,-1.75 -3.125,-2.53125 0.1875,-1.75 4.6875,-0.21875 -0.375,-11.125 -1.375,-2.71875 0.5625,-2.15625 3.25,-0.5625 0.0937,-0.21875 4.09375,-3.125 0.1875,-7.625 -1.375,-1.9375 -3.125,0 -1.15625,-1.5625 -3.3125,0 -0.96875,-1.1875 0,-2.9375 -3.9375,-7.40625 -1.9375,-1.375 -3.71875,5.09375 -1.5625,0.375 -0.59375,-2.53125 -1.75,-0.78125 -0.78125,1.5625 -2.90625,0 -0.40625,-1.75 -1.9687,1.15625 L 312,255 l -2.34375,-2.5625 -3.34375,-1.5625 -0.1875,-2.53125 -4.5,-0.375 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;pays-de-la-loire&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 182.5,146.40625 -1.9375,0.1875 -0.8125,1.9375 -2.90625,1.1875 -5.28125,-0.78125 -5.28125,3.125 -1.9375,-1.375 -2.9375,1.96875 -2.15625,-1.5625 -1.375,-2.34375 -2.90625,-1.1875 -1.96875,1.5625 -3.3125,-0.40625 -0.1875,5.09375 0.96875,0.78125 0,3.90625 -1.96875,1.96875 0,3.125 0.59375,1.9375 0,5.65625 1.375,1.375 0,5.28125 -3.3125,-0.40625 -1.375,0.78125 -2.53125,6.25 -1,3.53125 -0.75,1.5625 -3.9375,-0.96875 -1.75,-2.34375 -2.9375,-0.40625 -0.1875,2.15625 -4.28125,0.59375 -1.96875,1.9375 -0.78125,2.15625 -12.09375,0.59375 -5.09375,2.71875 -0.1875,5.46875 -5.46875,2.15625 -3.71875,1.9375 -3.125,0 -1.15625,-1.34375 -1.75,1.75 -0.84375,0.15625 1,0.6875 -3.71875,3.3125 0.78125,0.78125 0.78125,1.5625 -1.96875,2.75 2.15625,1.15625 3.71875,0.78125 0.375,-1.5625 2.15625,2.75 3.53125,0 2.53125,-2.75 3.3125,0 -3.5,1.75 0.1875,1.96875 0.78125,1.75 -2.15625,2.15625 -2.34375,0 0.40625,2.9375 4.28125,-0.78125 5.09375,4.6875 -6.0625,7.8125 -0.1875,4.6875 6.03125,5.84375 -0.1875,1.75 1.75,0 3.71875,11.15625 3.90625,1.9375 3.90625,3.90625 4.5,0 1.75,3.90625 4.3125,0 L 135,274 l 4.3125,2.15625 0.1875,-2.75 1.09375,1.03125 5.96875,-3.625 2.75,-0.1875 1.15625,3.125 3.71875,-1.5625 3.125,2.34375 2.53125,-1.1875 L 162,272.75 l 0.96875,-1.15625 2.71875,-1.75 -1.9375,-1.96875 -1.5625,1.1875 L 162,267.5 l 1.375,-2.5625 -1.375,-2.34375 1.15625,-1.5625 -0.59375,-5.46875 -1.9375,-2.90625 1.375,-1.78125 -3.125,-3.5 1.15625,-2.53125 -4.6875,-3.90625 0,-2.34375 -1.9375,-2.75 4.09375,-1.75 6.0625,1.375 2.71875,-1.78125 0,-2.71875 5.28125,-0.40625 4.875,-0.96875 5.28125,-0.1875 0.59375,1.375 1.375,1.15625 1.34375,-2.34375 3.71875,-3.90625 1.5,0 2.21875,-8 3.125,-3.71875 -0.21875,-4.28125 1.96875,-2.5625 0,-1.15625 -0.96875,-1.1875 1.9375,-3.90625 3.90625,2.75 2.15625,0 -1.1875,-3.90625 2.375,1.5625 1.34375,-1.96875 5.65625,-1.5625 -0.96875,-2.34375 1.375,-1.75 2.9375,-1.15625 2.71875,-3.53125 0,-3.71875 1.96875,0 0.78125,-2.71875 0.1875,-4.09375 -1.9375,-1.78125 1.5625,-2.71875 L 223.5,171 l -2.71875,-1.9375 -2.53125,-0.40625 -2.75,-4.09375 -0.78125,0 -0.1875,1.9375 -0.1875,-1.34375 -4.09375,0 -1.96875,-2.9375 -3.3125,-1.1875 L 204,154 l -1.5625,-2.125 -5.28125,0.1875 -5.28125,4.875 -3.3125,-0.1875 -1,-3.53125 -2.53125,-0.96875 -0.78125,-4.28125 -1.75,-1.5625 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ile-de-france&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;M 255.5625,109.6875 254,111.625 l -1.1875,4.3125 -1.375,2.34375 -5.46875,1.5625 -0.78125,0.96875 1,1.5625 0,1.5625 1.75,0.375 -1,1 0.0937,0.875 0.125,-0.0937 1.9375,1.9375 0.59375,2.34375 1.5625,1.5625 -0.78125,2.15625 0,1.9375 1.375,1.5625 -1.375,2.34375 1.375,3.34375 2.71875,1.9375 0.40625,2.15625 2.34375,0.375 0.5625,4.3125 1.78125,2.15625 4.0938,0.7812 0.375,2.53125 0.40625,0.59375 0.40625,5.25 6.25,-0.5625 2.53125,-2.34375 2.15625,1.75 5.25,0.375 1.96875,2.9375 2.34375,1.1875 0.1875,3.3125 -3.125,2.15625 1.75,1.5625 2.15625,-1.375 5.28125,0.1875 1.9375,-0.375 0.59375,-1.5625 2.15625,0.1875 0.375,1.5625 4.875,-2.75 1.78125,-2.125 2.34375,-2.75 -1.5625,-1.75 1.375,-2.9375 3.5,-1.75 7.625,0.375 1.75,-1.34375 0.15625,0.15625 0.4375,-3.28125 0.78125,-3.90625 1.375,-1.78125 0.1875,-2.34375 2.71875,-1.15625 0,-1.5625 -2.90625,0.1875 -0.59375,-1.375 0.96875,-1.75 -0.78125,-2.9375 -1.5625,-0.96875 0.40625,-2.71875 1.5625,-1 -0.21875,-1.15625 0.5625,-0.6875 -3.28125,-0.6875 -1,-2.34375 -1.75,-0.59375 -5.25,-5.0625 -0.59375,-4.3125 L 307.5,116.5 l -1.1875,0.59375 -1.9375,1.5625 -1.9375,-0.59375 -3.34375,1.375 -2.71875,-1.5625 -1.1875,1.5625 -1.75,0.1875 -1.1875,-0.96875 -1.9375,-1.15625 -2.34375,1.5625 -1.375,-1.375 -4.28125,-2.53125 -4.125,-2.15625 -2.125,0.96875 -2.34375,0.59375 -1.5625,-1.1875 -3.125,-1.9375 -2.53125,1.9375 -3.71875,0.40625 -5.28125,-0.40625 -1.1875,-1.9375 -0.75,-1.75 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;centre&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 247.15625,126.09375 -1.1875,0.96875 0,3.125 -3.90625,1.9375 0,2.9375 -1.15625,1.375 -4.90625,0 -2.3125,-0.96875 -7.0625,3.6875 -2.71875,0 -2.8125,2.6875 0.65625,0.4375 0.1875,3.34375 4.125,3.5 0.375,7.21875 -1.9375,2.34375 -2.9375,0.59375 -2.9375,1.75 0.40625,1.5625 1.34375,1.78125 0,4.625 0.40625,0.0625 L 223.5,171 l -2.3125,2.9375 -1.5625,2.71875 1.9375,1.78125 -0.1875,4.09375 -0.78125,2.71875 -1.96875,0 0,3.71875 -2.71875,3.53125 -2.9375,1.15625 -1.375,1.75 0.96875,2.34375 -5.65625,1.5625 -1.34375,1.96875 -2.375,-1.5625 1.1875,3.90625 -2.15625,0 -3.90625,-2.75 -1.9375,3.90625 0.96875,1.1875 0,1.15625 -1.96875,2.5625 0.21875,4.28125 -3.125,3.71875 -2.21875,8 0.25,0 0.78125,3.125 3.71875,0.78125 0,2.34375 4.6875,1.375 0,3.71875 -0.1875,2.34375 5.84375,0 5.09375,-1.1875 -0.40625,-2.15625 1.5625,-0.96875 1.5625,2.15625 1.375,0.59375 1.15625,4.6875 3.34375,3.5 0.375,2.75 3.53125,3.5 0,3.71875 -0.78125,2.34375 3.71875,2.9375 1.9375,1.9375 3.125,0.40625 1.1875,4.09375 2.125,1.15625 -0.375,2.9375 -1.5625,0.28125 0.5625,0.125 4.90625,0.375 1.75,-1.75 3.125,3.125 3.90625,-4.5 1.75,1.1875 2.34375,-0.21875 0.78125,0.40625 3.53125,0.1875 1.15625,-3.125 9.78125,1.1875 3.71875,0.96875 6.28125,-0.75 0.9375,-2 2.53125,-2.90625 4.875,-1 2.5625,0.78125 2.71875,-2.125 -0.1875,-1.5625 -0.96875,-0.78125 0,-3.125 5.25,-5.28125 1.96875,2.15625 1.75,-1.78125 1.5625,-0.1875 2.71875,-3.5 4.5,0.375 0.0625,1.0625 1.5,-4.78125 -0.96875,-1.75 0.1875,-2.53125 0.59375,-5.09375 -2.15625,-2.125 0.40625,-4.6875 -1.96875,-4.125 -0.1875,-2.71875 -3.53125,-2.75 L 299.5,216.5 l 1.75,-2.53125 0,-3.71875 -2.34375,-2.71875 -0.1875,-1.96875 3.90625,-1.15625 -0.59375,-2.15625 -0.59375,-3.125 -2.53125,-3.5 -0.59375,-2.15625 3.90625,0 2.75,-1.96875 0.375,-2.90625 -1.75,-1.96875 5.09375,-4.28125 0,-3.53125 -2.5625,-2.71875 -0.96875,-3.125 -3.53125,-3.34375 -4.875,2.75 -0.375,-1.5625 -2.15625,-0.1875 -0.59375,1.5625 -1.9375,0.375 -5.28125,-0.1875 -2.15625,1.375 -1.75,-1.5625 3.125,-2.15625 -0.1875,-3.3125 -2.34375,-1.1875 -1.96875,-2.9375 -5.25,-0.375 -2.15625,-1.75 -2.53125,2.34375 -6.25,0.5625 -0.40625,-5.25 L 264.125,157.53125 263.75,155 l -4.09375,-0.78125 -1.78125,-2.15625 -0.5625,-4.3125 -2.34375,-0.375 -0.40625,-2.15625 -2.71875,-1.9375 -1.375,-3.34375 1.375,-2.34375 -1.375,-1.5625 0,-1.9375 0.78125,-2.15625 -1.5625,-1.5625 -0.59375,-2.34375 -1.9375,-1.9375 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;bourgogne&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 318.4375,157.34375 -1.75,1.34375 -7.625,-0.375 -3.5,1.75 -1.375,2.9375 1.5625,1.75 -2.34375,2.75 -1.78125,2.125 3.53125,3.34375 0.96875,3.125 2.5625,2.71875 0,3.53125 -5.09375,4.28125 1.75,1.96875 -0.375,2.90625 -2.75,1.96875 -3.90625,0 0.59375,2.15625 2.53125,3.5 0.59375,3.125 0.59375,2.15625 -3.90625,1.15625 0.1875,1.96875 2.34375,2.71875 0,3.71875 -1.75,2.53125 0.5625,2.34375 3.53125,2.75 0.1875,2.71875 1.96875,4.125 -0.40625,4.6875 2.15625,2.125 -0.59375,5.09375 -0.1875,2.53125 0.96875,1.75 -1.5,4.78125 0.125,1.46875 3.34375,1.5625 L 312,255 l 2.125,-1.1875 1.96875,-1.15625 0.40625,1.75 2.90625,0 0.78125,-1.5625 1.75,0.78125 0.59375,2.53125 1.5625,-0.375 3.71875,-5.09375 1.9375,1.375 3.9375,7.40625 0,2.9375 0.96875,1.1875 3.3125,0 1.15625,1.5625 3.125,0 1.375,1.9375 -0.1875,7.625 -4.09375,3.125 -0.0937,0.21875 0.28125,-0.0313 0.59375,0.1875 0.1875,3.125 2.9375,0.59375 0.375,1.375 1.5625,0 2.34375,-1.375 6.25,0.96875 1.1875,1.1875 1.5625,-1.5625 2.15625,0 1.15625,-6.25 0.78125,-0.59375 1.9375,0 2.375,1.5625 1.75,-1.5625 1.15625,1.5625 1.78125,-1.75 2.125,-0.1875 1,3.125 0.75,3.90625 1.375,0.1875 1.1875,-2.75 3.6875,-14.4375 1.375,-2.53125 2.15625,-0.21875 2.15625,1.78125 1.5625,-0.40625 1.9375,-1.375 1.96875,0.40625 1.15625,2.53125 1.125,0.4375 5.125,-0.625 1.96875,-1.5625 -0.78125,-1.1875 -2.34375,-0.78125 -0.21875,-2.71875 1.96875,-1.375 0.78125,-3.3125 -1.75,-3.125 -1.1875,-1.5625 0.59375,-0.59375 0,-1.9375 -1.5625,-1 -0.40625,-1.5625 4.5,-0.5625 0.40625,-1.5625 -1.375,0 -1.15625,-1.375 -2.15625,0 -1.78125,-2.9375 L 392.25,238 l 0.21875,-2.53125 1.34375,-0.78125 -0.1875,-1 -0.375,-1.15625 0.96875,-1.5625 3.3125,-1.5625 0,-1.5625 1.1875,-1.5625 1.15625,-1.5625 -0.375,-1.375 0.5625,-2.15625 0.40625,-3.125 0.78125,0 -0.1875,-1.15625 -0.78125,-0.78125 -0.21875,-3.90625 -1.75,-0.1875 -0.375,-3.125 -2.15625,-1 0.78125,-0.96875 1.1875,-0.375 2.53125,-2.9375 -0.21875,-1.5625 -1.5625,-3.125 -2.3125,-0.40625 -0.8125,1.96875 -4.28125,0.96875 -0.40625,-0.96875 -3.125,-3.90625 -1.75,0.96875 -2.34375,-0.1875 -0.78125,-1.5625 -3.125,0.1875 -0.1875,-3.3125 -1.75,-1.1875 2.53125,-2.71875 -4.5,-6.0625 -3.5,-3.71875 -3.125,-1.75 -5.65625,0 -0.40625,2.53125 -2.53125,1.375 -6.4375,0.1875 -1,2.15625 -1.375,-0.1875 -1.15625,-2.15625 -3.90625,1.96875 -7.8125,-0.40625 -0.96875,-2.15625 -2.15625,-2.90625 -0.375,-3.53125 -3.125,-3.71875 -1.96875,1.375 -3.53125,-2.71875 0.59375,-5.28125 -5.0625,-5.28125 -2.34375,0 -1.375,-1.15625 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;poitou-charentes&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 188.75,225.6875 -3.71875,3.90625 -1.34375,2.34375 -1.375,-1.15625 -0.59375,-1.375 -5.28125,0.1875 -4.875,0.96875 -5.28125,0.40625 0,2.71875 -2.71875,1.78125 -6.0625,-1.375 -4.09375,1.75 1.9375,2.75 0,2.34375 4.6875,3.90625 -1.15625,2.53125 3.125,3.5 -1.375,1.78125 1.9375,2.90625 0.59375,5.46875 -1.15625,1.5625 1.375,2.34375 -1.375,2.5625 0.1875,1.5625 1.5625,-1.1875 1.9375,1.96875 -2.71875,1.75 L 162,272.75 l -2.15625,0.59375 -2.53125,1.1875 -3.125,-2.34375 -3.71875,1.5625 -1.15625,-3.125 -2.75,0.1875 -5.96875,3.625 1.4375,1.3125 -3.125,2.53125 -0.375,1.96875 -2.9375,0.375 -1.5625,-1.75 -3.90625,-0.375 -0.40625,-1.96875 -2.34375,-1.5625 -3.3125,1.1875 2.15625,3.125 2.71875,0 2.75,1.75 2.15625,1.75 4.09375,-0.1875 0.78125,1.75 2.71875,0.59375 1,2.71875 1.75,0.78125 -0.1875,2.15625 -2.34375,-0.375 -0.78125,1.15625 1.75,2.53125 -0.96875,4.3125 -2.34375,-0.1875 0.1875,2.71875 0.59375,0.96875 -2.75,0 -0.375,-1.5625 1.75,-2.34375 -0.59375,-1.34375 -0.96875,-0.78125 L 136.75,291 l -3.3125,-0.40625 -2.71875,-3.3125 -0.40625,6.84375 4.5,3.3125 0.375,3.71875 0.78125,4.28125 0.40625,4.3125 2.34375,-0.21875 4.09375,3.34375 2.75,1.5625 0.1875,1.9375 2.15625,0.40625 6.25,6.25 1.46875,6.75 5.78125,0 0.96875,-0.96875 0.1875,2.9375 5.09375,0.59375 0.78125,6.25 2.75,0.1875 4.46875,4.5 2.34375,0.375 2.75,-1.375 1.9375,1.375 1.5625,-3.3125 2.15625,-3.71875 3.90625,0.40625 1.9375,-1.78125 3.53125,-3.5 0.1875,-6.84375 9.1875,-6.25 0.1875,-4.6875 2.75,-0.375 1.75,-3.125 1.09375,0.0313 0.65625,-2.96875 1.5625,-0.1875 0.96875,-2.75 1.96875,-0.59375 2.34375,-1.5625 -0.375,-4.875 1.75,-0.59375 3.5,-0.78125 -0.1875,-1.75 -0.59375,-2.71875 -2.71875,-0.21875 -1.5625,-1.75 0.96875,-1.75 0.1875,-5.28125 -1.34375,-1.5625 1.5625,-1.15625 2.53125,-2.9375 4.28125,-0.1875 0,-2.34375 2.15625,-1.78125 5.28125,-0.96875 0.375,-2.9375 -2.125,-1.15625 -1.1875,-4.09375 -3.125,-0.40625 -1.9375,-1.9375 -3.71875,-2.9375 0.78125,-2.34375 0,-3.71875 -3.53125,-3.5 -0.375,-2.75 -3.34375,-3.5 -1.15625,-4.6875 -1.375,-0.59375 -1.5625,-2.15625 -1.5625,0.96875 0.40625,2.15625 -5.09375,1.1875 -5.84375,0 0.1875,-2.34375 0,-3.71875 -4.6875,-1.375 0,-2.34375 -3.71875,-0.78125 -0.78125,-3.125 -1.75,0 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;limousin&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 256.125,267.875 -1.15625,3.125 -3.53125,-0.1875 -0.78125,-0.40625 -2.34375,0.21875 -1.75,-1.1875 -3.90625,4.5 -3.125,-3.125 -1.75,1.75 -4.90625,-0.375 -0.5625,-0.125 -3.71875,0.6875 -2.15625,1.78125 0,2.34375 -4.28125,0.1875 -2.53125,2.9375 -1.5625,1.15625 1.34375,1.5625 -0.1875,5.28125 -0.96875,1.75 1.5625,1.75 2.71875,0.21875 0.59375,2.71875 0.1875,1.75 -3.5,0.78125 -1.75,0.59375 0.375,4.875 -2.34375,1.5625 -1.96875,0.59375 -0.96875,2.75 -1.5625,0.1875 -0.65625,2.96875 4.5625,0.15625 1,1.9375 -0.8125,2.15625 1.78125,2.34375 1.34375,-0.375 1.375,-1.96875 6.25,0.59375 1,3.90625 4.28125,0.59375 0.96875,1.34375 -2.9375,1.375 1.375,0.96875 4.125,0.59375 1.15625,2.9375 2.15625,1.75 -3.90625,3.53125 0,2.71875 1.5625,0.78125 -1.5625,1.96875 2.15625,1.75 -1.5625,1.9375 1.75,1.1875 4.28125,-0.1875 -0.1875,4.28125 1.625,2.5625 0.59375,-0.0937 4.15625,-1.9375 4.96875,2.21875 3.84375,5.5 2.21875,-0.28125 3.3125,-3.3125 1.09375,1.9375 2.21875,-2.1875 3.03125,0.8125 0.0937,0.65625 2.53125,-1.78125 -0.78125,-1.9375 -1.1875,-1.1875 1.5625,-1.9375 1.5625,0 1,-3.125 0.78125,-1.5625 -0.59375,-3.53125 2.53125,-3.5 3.53125,-2.15625 0.1875,-5.46875 1.75,0.96875 1.96875,2.15625 1.9375,0 1.1875,-1.375 -0.96875,-2.34375 0.96875,-3.5 -0.59375,-3.3125 -1.1875,-1.375 0,-2.75 1.78125,-2.90625 -0.40625,-2.75 -4.5,-4.5 -0.375,-1.75 3.71875,-2.15625 2.15625,-1.15625 0.5625,-2.75 2.34375,-1.75 L 288.9375,291.5 287.375,289.5625 287,283.5 l -2.15625,-5.0625 -2.15625,-0.78125 -1.5625,-2.75 -1.375,1.75 -1.34375,-1.75 0,-2.34375 -2.34375,-3.3125 -6.4375,0.78125 -3.71875,-0.96875 -9.78125,-1.1875 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;aquitaine&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 209.84375,310.46875 -1.75,3.125 -2.75,0.375 -0.1875,4.6875 -9.1875,6.25 -0.1875,6.84375 -3.53125,3.5 -1.9375,1.78125 -3.90625,-0.40625 -2.15625,3.71875 -1.5625,3.3125 -1.9375,-1.375 -2.75,1.375 -2.34375,-0.375 -4.46875,-4.5 -2.75,-0.1875 -0.78125,-6.25 -5.09375,-0.59375 -0.1875,-2.9375 -0.96875,0.96875 -5.78125,0 0.28125,1.25 1.375,5.65625 0.375,5.65625 -0.96875,1.5625 -0.96875,-4.6875 -2.75,-10.71875 -9.96875,-9 0.21875,-4.09375 -1.96875,-0.1875 -3.125,4.6875 -0.96875,16.40625 -2.53125,16.59375 -1.78125,12.875 -0.1875,3.34375 1.375,-4.5 2.71875,-3.53125 3.90625,3.53125 0.40625,1.15625 1.15625,1.5625 -4.875,0.21875 -0.78125,-1.1875 -1.9375,0.78125 -0.40625,2.9375 -2.15625,2.9375 0,4.46875 -3.5,18.75 -4.5,17.1875 -1.375,6.65625 -1.15625,4.6875 -3.71875,6.4375 -4.5,5.46875 -3.5,1.375 -2.53125,0.375 0,2.15625 2.34375,2.15625 3.5,0.1875 0.1875,2.53125 2.75,0.21875 0.78125,-1.78125 3.71875,1.5625 2.34375,0.59375 0.5625,2.34375 -1.34375,1.1875 0,3.6875 -2.75,1.375 -0.1875,1.75 1.75,1.96875 3.125,0.96875 0.59375,-2.9375 1.75,-1.9375 -0.1875,2.53125 1.375,1.96875 3.5,0 1.5625,2.125 4.6875,0.78125 4.5,2.75 7.40625,0 0.40625,4.09375 5.0625,3.90625 1.96875,2.34375 2.15625,-1.15625 1.9375,-0.40625 0.96875,0.96875 1.78125,-0.96875 3.40625,-1.875 0.3125,-4.03125 1.5625,-1.1875 0.8125,-6.4375 2.90625,0.59375 1.1875,-0.78125 -1.375,-2.75 5.28125,-4.5 3.125,-7.03125 1.9375,-2.53125 -2.34375,-3.5 -1.5625,-2.34375 2.15625,-1.96875 -3.3125,-5.46875 -5.28125,-0.375 -1.5625,-2.75 1.375,-3.71875 1.9375,-2.53125 -0.59375,-3.3125 1.5625,-1.5625 -2.3125,-3.90625 1.9375,-2.34375 2.15625,-0.40625 1.9375,0.78125 2.75,-2.34375 0.96875,2.9375 0.96875,1.375 2.15625,-0.59375 -0.1875,-2.53125 1.375,-2.9375 2.3125,1.96875 3.125,-3.125 1.375,1.9375 3.3125,-0.59375 3.53125,-0.375 1.5625,-2.75 5.84375,-0.5625 2.9375,2.90625 1,-0.96875 1.9375,-0.59375 -0.78125,-2.71875 2.9375,-0.78125 3.71875,-0.78125 -0.8125,-2.34375 1.1875,-1.375 0.96875,-3.71875 -2.15625,-2.34375 1.375,-4.46875 2.9375,1.75 4.3125,-0.78125 -1.96875,-4.3125 -1.5625,-5.84375 3.90625,-0.1875 0.96875,-2.5625 1.78125,-1.75 0.1875,-2.9375 4.28125,-0.375 2.75,-3.90625 -1.1875,-0.40625 -0.1875,-2.125 3.3125,-0.40625 0.21875,-1.9375 1.5625,-1 1.75,-3.125 -1.75,-1.9375 0,-2.15625 1.34375,-1.15625 -1.75,-2.75 0.1875,-4.28125 -4.28125,0.1875 -1.75,-1.1875 1.5625,-1.9375 -2.15625,-1.75 1.5625,-1.96875 -1.5625,-0.78125 0,-2.71875 3.90625,-3.53125 -2.15625,-1.75 -1.15625,-2.9375 -4.125,-0.59375 -1.375,-0.96875 2.9375,-1.375 -0.96875,-1.34375 -4.28125,-0.59375 -1,-3.90625 -6.25,-0.59375 -1.375,1.96875 -1.34375,0.375 -1.78125,-2.34375 0.8125,-2.15625 -1,-1.9375 -5.65625,-0.1875 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;midi-pyrenees&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 247.46875,347.3125 -4.15625,1.9375 -0.59375,0.0937 0.125,0.1875 -1.34375,1.15625 0,2.15625 1.75,1.9375 -1.75,3.125 -1.5625,1 -0.21875,1.9375 -3.3125,0.40625 0.1875,2.125 1.1875,0.40625 -2.75,3.90625 -4.28125,0.375 -0.1875,2.9375 -1.78125,1.75 -0.96875,2.5625 -3.90625,0.1875 1.5625,5.84375 1.96875,4.3125 -4.3125,0.78125 -2.9375,-1.75 -1.375,4.46875 2.15625,2.34375 -0.96875,3.71875 -1.1875,1.375 0.8125,2.34375 -3.71875,0.78125 -2.9375,0.78125 0.78125,2.71875 -1.9375,0.59375 -1,0.96875 -2.9375,-2.90625 -5.84375,0.5625 -1.5625,2.75 -3.53125,0.375 -3.3125,0.59375 -1.375,-1.9375 -3.125,3.125 -2.3125,-1.96875 -1.375,2.9375 0.1875,2.53125 -2.15625,0.59375 -0.96875,-1.375 -0.96875,-2.9375 -2.75,2.34375 -1.9375,-0.78125 -2.15625,0.40625 -1.9375,2.34375 2.3125,3.90625 -1.5625,1.5625 0.59375,3.3125 -1.9375,2.53125 -1.375,3.71875 1.5625,2.75 5.28125,0.375 3.3125,5.46875 -2.15625,1.96875 1.5625,2.34375 2.34375,3.5 -1.9375,2.53125 -3.125,7.03125 -5.28125,4.5 1.375,2.75 -1.1875,0.78125 -2.90625,-0.59375 -0.8125,6.4375 -1.5625,1.1875 -0.3125,4.03125 0.5,-0.28125 3.3125,1.96875 3.90625,2.9375 0.375,2.34375 3.125,2.53125 2.5625,0 6.4375,-2.75 2.71875,3.125 3.71875,1 1.375,-2.34375 1.75,0.78125 11.71875,0.78125 0.40625,-9.59375 2.71875,0.40625 5.09375,2.9375 6.03125,1.15625 2.5625,0 3.3125,4.3125 8.40625,-0.40625 3.3125,5.28125 2.9375,-1.1875 8.59375,1.1875 0.625,3.59375 6.0625,-1.40625 2.21875,-1.9375 3.3125,-0.84375 0.8125,-1.65625 7.1875,-0.53125 -4.40625,-5.25 -3.59375,1.9375 -6.34375,-5.25 1.375,-1.9375 4.96875,0 -0.5625,-4.6875 0,-3.59375 -0.8125,-6.65625 -9.6875,-4.6875 0.5625,-1.65625 -2.21875,-2.46875 2.5,-1.125 0.53125,-3.03125 3.0625,-1.375 -0.84375,-1.9375 2.78125,-2.5 1.375,2.5 4.125,-1.375 1.9375,-0.28125 -0.28125,1.375 3.875,0 3.59375,1.125 0.28125,-3.59375 1.65625,0 6.0625,1.09375 5.8125,0 4.40625,-1.375 1.125,-3.59375 -3.03125,-2.78125 0.8125,-2.75 1.65625,-2.46875 2.75,1.90625 7.1875,-2.46875 1.125,-2.21875 1.65625,0 3.3125,0 -0.28125,-5.78125 0,-1.9375 1.65625,0 3.03125,1.65625 3.03125,0 -0.53125,-3.3125 1.65625,-1.40625 3.3125,-0.53125 0,-2.78125 3.59375,-1.65625 -0.84375,-3.84375 -3.03125,0 -2.75,-0.5625 -0.5625,-2.21875 2.21875,-0.53125 0,-2.78125 2.1875,-1.9375 -1.65625,-0.8125 -4.6875,0.8125 0.28125,-2.1875 -3.3125,-1.40625 -0.84375,-6.625 0,-4.6875 -2.75,-1.9375 0.28125,-3.875 -5.8125,-7.15625 -0.5625,-5.53125 -1.90625,0 -0.84375,-5.53125 -3.875,0.5625 -0.53125,-3.59375 -0.5625,-0.84375 -5.53125,4.71875 0,4.6875 -1.375,0 -0.5625,4.40625 -1.375,0.5625 -1.09375,2.46875 -6.09375,0 -0.53125,-0.8125 -2.78125,0 -1.65625,2.75 -2.1875,-0.28125 1.09375,-3.3125 -2.5,-1.09375 2.5,-5.8125 -3.3125,-2.46875 -1.125,-7.1875 -3.03125,-0.8125 -2.21875,2.1875 -1.09375,-1.9375 -3.3125,3.3125 -2.21875,0.28125 -3.84375,-5.5 -4.96875,-2.21875 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;languedoc-roussillon&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 320.78125,352.25 -5.46875,1.96875 -1.5625,3.5 -3.5,-2.34375 -2.75,8.59375 -2.8125,6.46875 4.09375,5.03125 -0.28125,3.875 2.75,1.9375 0,4.6875 0.84375,6.625 3.3125,1.40625 -0.28125,2.1875 4.6875,-0.8125 1.65625,0.8125 -2.1875,1.9375 0,2.78125 -2.21875,0.53125 0.5625,2.21875 2.75,0.5625 3.03125,0 0.84375,3.84375 -3.59375,1.65625 0,2.78125 -3.3125,0.53125 -1.65625,1.40625 0.53125,3.3125 -3.03125,0 -3.03125,-1.65625 -1.65625,0 0,1.9375 0.28125,5.78125 -3.3125,0 -1.65625,0 -1.125,2.21875 -7.1875,2.46875 -2.75,-1.90625 -1.65625,2.46875 -0.8125,2.75 3.03125,2.78125 -1.125,3.59375 -4.40625,1.375 -5.8125,0 -6.0625,-1.09375 -1.65625,0 -0.28125,3.59375 -3.59375,-1.125 -3.875,0 0.28125,-1.375 -1.9375,0.28125 -4.125,1.375 -1.375,-2.5 -2.78125,2.5 0.84375,1.9375 -3.0625,1.375 -0.53125,3.03125 -2.5,1.125 2.21875,2.46875 -0.5625,1.65625 9.6875,4.6875 0.8125,6.65625 0,3.59375 0.5625,4.6875 -4.96875,0 -1.375,1.9375 6.34375,5.25 3.59375,-1.9375 4.40625,5.25 -7.1875,0.53125 -0.8125,1.65625 -3.3125,0.84375 -2.21875,1.9375 -6.0625,1.40625 0.34375,2.0625 2.9375,2.75 5.84375,1.5625 0.1875,3.5 3.125,2.75 2.34375,-0.40625 3.34375,-4.09375 4.09375,-0.78125 6.4375,2.15625 5.46875,4.6875 1.5625,-1.96875 1.375,0 1.375,0.96875 1.15625,-0.5625 0.1875,-2.75 5.875,-1.375 1.9375,-2.53125 2.9375,-0.96875 4.09375,0 2.5625,2.71875 3.125,0.21875 0,-3.125 -1.5625,-2.15625 -2.75,-1.1875 -0.59375,-22.65625 0.21875,-6.4375 -2.34375,0.1875 -1.96875,-2.90625 1.5625,-2.5625 3.3125,3.125 2.9375,-2.34375 1.96875,-1.9375 0.375,-3.125 7.03125,-2.15625 0.78125,-1.75 5.46875,-0.1875 1.75,-2.15625 10.5625,-8.40625 6.625,-4.6875 5.6875,0.40625 0,3.90625 4.46875,-0.21875 2.40625,0.125 1.75,-4.0625 6.34375,-3.875 -1.375,-1.9375 1.65625,-4.40625 5.78125,0.8125 1.40625,-10.5 7.71875,-4.40625 0,-2.5 -5.8125,-5.78125 0,-4.4375 -3.3125,-5.5 -6.90625,-3.875 -0.53125,3.03125 -2.78125,0.28125 -0.8125,-3.03125 -2.78125,0.53125 -0.53125,3.875 -2.21875,-0.8125 -4.6875,-3.0625 -2.21875,1.125 0,-5.53125 -4.15625,-2.5 0.5625,-4.125 -3.3125,-3.59375 -1.375,-7.1875 -4.96875,-6.34375 -3.625,0.875 -0.78125,-2.71875 -1.96875,0 -0.375,2.34375 -5.0625,1.5625 -3.53125,-9 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;provence-alpes-cote-dazur&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;m 447.34375,339.15625 -1.75,0.78125 -0.40625,2.9375 -3.5,0.40625 -0.59375,-2.75 -1.15625,-1.15625 -3.53125,0.375 -1.375,1.1875 -0.78125,4.09375 0.59375,0.96875 4.09375,0.40625 0.78125,2.53125 1.5625,0.78125 0,4.28125 -3.71875,-0.1875 -1.5625,1.75 -4.46875,-0.78125 -2.53125,2.15625 -1.78125,-0.78125 -2.53125,1.96875 0.96875,1.75 -1.5625,1.5625 -4.875,0 0,2.34375 1.5625,0.78125 -0.59375,1.375 -3.3125,1.34375 -4.09375,0.40625 -1.1875,3.71875 -0.1875,2.34375 2.15625,1.75 -2.15625,2.53125 -2.71875,-1.375 -3.125,-0.1875 -0.40625,1.75 1.96875,1.375 -2.375,1.5625 0.8125,3.3125 6.625,1.78125 1.1875,2.53125 1.9375,0.375 -0.78125,7.25 -1.15625,-1.375 -1.5625,-1.375 -1,2.9375 -1.75,1.5625 -2.53125,-0.1875 -2.9375,-2.15625 -0.78125,-2.53125 -5.46875,-0.40625 -4.09375,-0.375 -0.40625,-2.34375 1.375,-2.9375 -2.53125,2.15625 -3.90625,-0.40625 -0.78125,-1.375 2.71875,-3.6875 -2.71875,-2.5625 -2.75,0.21875 -2.125,3.3125 0.5625,3.5 3.3125,0.40625 -0.5625,1.5625 -2.5625,0.1875 -2.90625,2.9375 -0.78125,-0.96875 0.5625,-3.90625 -1.15625,-1.375 -5.28125,0.78125 -1.03125,2.09375 0.5625,0.3125 3.3125,5.5 0,4.4375 5.8125,5.78125 0,2.5 -7.71875,4.40625 -1.40625,10.5 -5.78125,-0.8125 -1.65625,4.40625 1.375,1.9375 -6.34375,3.875 -1.75,4.0625 6.1875,0.28125 8.21875,0.59375 1.5625,1.5625 -2.9375,0 -1.9375,3.3125 8.375,1.75 6.65625,-1.15625 -3.53125,-3.34375 2.34375,-1.9375 3.71875,1.5625 1.75,3.71875 11.15625,0.1875 2.90625,-1.1875 0.59375,1.78125 -3.125,2.71875 4.3125,0.1875 -0.78125,1.96875 -1.1875,1.375 9.5625,0 4.6875,1.5625 1,1.34375 3.5,1.5625 0.96875,3.90625 2.15625,0.40625 1.96875,-1.375 3.5,-2.15625 6.0625,0.59375 -0.1875,1.5625 -1.96875,0.96875 4.6875,0.21875 -1.15625,-1.1875 -0.40625,-2.53125 2.53125,-1.75 2.9375,0.96875 1.1875,0.375 0.96875,1.1875 1.375,-0.96875 0.375,-2.5625 1.5625,-1.34375 4.09375,0 1.1875,-1.78125 2.71875,0.78125 3.125,-1.34375 0,-5.09375 -4.09375,0.1875 3.125,-1.9375 1.5625,-2.15625 0.40625,-3.125 5.65625,-0.78125 3.3125,-3.71875 0.1875,-4.46875 3.90625,0.78125 1.375,-1.78125 1.96875,0.40625 0.1875,-6.0625 4.5,-0.375 3.90625,-3.53125 3.5,0 0.1875,-2.15625 3.53125,-2.125 -1.96875,-4.5 2.9375,-2.53125 -0.59375,-2.9375 4.3125,-1.375 1.15625,-4.28125 -0.5625,-2.9375 -1,-1.75 L 496.125,390 l -2.90625,0.21875 -9.1875,3.3125 -2.9375,0 -5.0625,-4.09375 -5.09375,-1.375 -2.9375,0 0,-3.53125 -4.09375,-2.53125 0,-3.90625 2.75,-0.375 -1.5625,-1.375 -1.96875,-0.59375 -0.96875,-2.53125 0.78125,-1.75 3.5,-3.71875 -0.5625,-2.75 2.34375,-2.53125 2.125,0.1875 0,-1.75 -2.71875,-1.375 -0.59375,-5.65625 -2.15625,-0.78125 -2.71875,0.40625 -5.09375,-2.5625 -0.78125,-5.84375 -2.90625,-0.96875 -1,-1.96875 -1.28125,-2.8125 -3.75,-0.1875 z&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;regionName&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;regionName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Which produce:&lt;/p&gt;

&lt;div id=&quot;map-01&quot;&gt;&lt;/div&gt;

&lt;script src=&quot;/labs/svg/clickable-map/01.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;A great advantage of using SVG instead of canvas element is the ability to manipulate drawn figures like a classic DOM element. This way, we are able to add some event listeners on them. Let&amp;#39;s add a hover effect to our regions:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;animationSpeed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;hoverStyle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;#A8BED5&amp;quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;regionName&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;nx&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;mouseover&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;animate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hoverStyle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;animationSpeed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;nx&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;mouseout&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;nx&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;animate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;animationSpeed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;})(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;regionName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We iterate through all the regions to draw them and to attach a &lt;code&gt;mouseover&lt;/code&gt; and a &lt;code&gt;mouseout&lt;/code&gt; events to deal with the hover effect. These extra lines gives the following result:&lt;/p&gt;

&lt;div id=&quot;map-02&quot;&gt;&lt;/div&gt;

&lt;script src=&quot;/labs/svg/clickable-map/02.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;You may have noticed the closure at line 7. This closure is essential to make this sample working. If you directly attach event inside the &lt;code&gt;for&lt;/code&gt; loop, you will always hover the last region. To better understand why, let&amp;#39;s simplify the previous snippet:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// This code does not work&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;regionName&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;region&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;regions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;regionName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;mouseover&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;animate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hoverStyle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;animationSpeed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code&gt;region&lt;/code&gt; variable is defined outside the event listener. So, its scope is the &lt;code&gt;for&lt;/code&gt; loop. So, when the loop iterates, the variable &lt;code&gt;region&lt;/code&gt; will be changed, even for the previous added event listeners. That&amp;#39;s why you should imperatively add a closure to avoid scoping issues. You may find a good explanation on the blog of &lt;a href=&quot;http://robertnyman.com/2008/10/09/explaining-javascript-scope-and-closures/&quot;&gt;Robert Nyman&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This map is, in its current state, probably useless as you may want to redirect user to another URL on a click on a region. To do so, just add a &lt;code&gt;href&lt;/code&gt; attribute to your region. And it will behaves like a link.&lt;/p&gt;

&lt;p&gt;Few lines of code and a nice look and feel. Why some people are still using Flash for this kind of stuff? :)&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Simulate marquee tag in CSS and Javascript</title>
   <link href="http://www.jonathan-petitcolas.com/2013/05/06/simulate-marquee-tag-in-css-and-javascript.html"/>
   <updated>2013-05-06T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2013/05/06/simulate-marquee-tag-in-css-and-javascript</id>
   <content type="html">&lt;p&gt;Several days ago, one of my following &lt;a href=&quot;https://twitter.com/Ornux/status/324451213171109888&quot;&gt;asked on Twitter&lt;/a&gt; how to simulate &lt;code&gt;marquee&lt;/code&gt; tag in full CSS. For the youngest developers who may not know this strongly unadvised tag, it allows to slide a text from right to left. I know it is a deprecated one, because of a huge lack of accessibility. Yet, customers are always right. And, even if you try to convince them that it is a real disaster for readability and accessibility, some simply don&amp;#39;t care. So, here is a CSS alternative.&lt;/p&gt;

&lt;p&gt;First, the HTML:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;p&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;marquee&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Do not use marquee tag for improve accessibility and readability.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And now the related CSS:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-css&quot; data-lang=&quot;css&quot;&gt;&lt;span class=&quot;k&quot;&gt;@keyframes&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;marquee&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;text-indent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;430px&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;text-indent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;-485px&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@-webkit-keyframes&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;marquee&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;text-indent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;430px&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;text-indent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;-485px&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nc&quot;&gt;.marquee&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;overflow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;hidden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;white-space&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;nowrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;animation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;marquee&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;17s&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;linear&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;infinite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;webkit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;animation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;marquee&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;17s&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;linear&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;infinite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nc&quot;&gt;.marquee&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;:hover&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;webkit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;animation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;paused&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;animation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;paused&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This trick deals with a &lt;code&gt;text-indent&lt;/code&gt; animation. I do not use a padding animation, to avoid some issues with border-box specifications. Here is a small schema to better explain the value I set:&lt;/p&gt;

&lt;p class=&quot;center&quot;&gt;
    &lt;img src=&quot;/img/posts/marquee-limits.png&quot; alt=&quot;Marquee limits&quot; title=&quot;Marquee limits&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;As you may see below, this solution is fluider than the old &lt;code&gt;marquee&lt;/code&gt; tag:&lt;/p&gt;

&lt;iframe width=&quot;80%&quot; height=&quot;150&quot; src=&quot;/labs/marquee/marquee-01.html&quot; frameborder=&quot;0&quot; style=&quot;margin: 0 10%;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;Moreover, there are two extra features with this solution:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;It&amp;#39;s easy to &lt;strong&gt;change sliding speed&lt;/strong&gt;: just modify the animation duration (here 17 seconds). However, the animation speed will not be the same across all browsers (Firefox is slower than Chrome for instance).&lt;/li&gt;
&lt;li&gt;You can &lt;strong&gt;pause the sliding&lt;/strong&gt; when hovering for instance, simply by changing the animation state.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;However, previous solution has a major issue: it requires to specify hard-written text indentation extremes. We are going to use some Javascript to change keyframe values on the fly:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;getStringWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;span&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;span&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;span&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;innerText&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;span&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;visibility&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;hidden&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getElementsByTagName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;body&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;span&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;textWidth&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;span&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;offsetWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;removeChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;span&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;textWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;getAnimationRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;animationName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;KEYFRAME_RULE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CSSRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;WEBKIT_KEYFRAMES_RULE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CSSRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;MOZ_KEYFRAMES_RULE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CSSRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;KEYFRAMES_RULE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;stylesheets&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;styleSheets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;stylesheets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rules&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;stylesheets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cssRules&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rule&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;rule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;KEYFRAME_RULE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;marquee&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;updateMarqueeAmplitude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;element&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;animationName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;marquee&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;marqueeRule&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;getAnimationRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;animationName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;marqueeRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// remove the old animation (if any)&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;element&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;webkitAnimationName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;none&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;textWidth&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;getStringWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;element&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;innerText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// update the values of our keyframe animation&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;marqueeRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;deleteRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0%&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;marqueeRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;deleteRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;100%&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;marqueeRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;insertRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;0% { text-indent: &amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;element&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;offsetWidth&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;px; }&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;marqueeRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;insertRule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;100% { text-indent: &amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;textWidth&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;px; }&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// re-assign the animation (to make it run)&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;element&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;webkitAnimationName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;animationName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;updateMarqueeAmplitude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;querySelector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;.marquee&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The first function &lt;code&gt;getStringWidth&lt;/code&gt; is straightforward: we calculate the length in pixel of a string by hiding it into the DOM. It is a far more reliable way to measure it than to use string length and font size.&lt;/p&gt;

&lt;p&gt;The second one, &lt;code&gt;getAnimationRule&lt;/code&gt; is far more interesting. This method browses the CSS-OM (the equivalent of DOM for stylesheets) to retrieve animation keyframes declaration.&lt;/p&gt;

&lt;p&gt;Finally, &lt;code&gt;updateMarqueeAmplitude&lt;/code&gt;. This is the main function of our script. We retrieve the animation, we stop it by changing its name, and then we update the keyframe rules before restarting it.&lt;/p&gt;

&lt;p&gt;Here is the related result:&lt;/p&gt;

&lt;iframe width=&quot;100%&quot; height=&quot;60&quot; src=&quot;/labs/marquee/marquee-02.html&quot; frameborder=&quot;0&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;What about performances? As you may have guess, the bottleneck of this application is in the &lt;code&gt;getAnimationRule&lt;/code&gt; function. The more stylesheets and declaration you have, the more resource you will consume to retrieve the rule. It is a major issue, especially if you use some big frameworks such as Twitter Bootstrap.&lt;/p&gt;

&lt;p&gt;That&amp;#39;s why I do not recommend to use this script to get the extreme values of &lt;code&gt;text-indent&lt;/code&gt;. Here are three ways to avoid this bottleneck:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;If your text is always the same, just use hard-written values.&lt;/li&gt;
&lt;li&gt;If you text is dynamic (generated from database for instance), pre-generate the stylesheet server-side with correct values.&lt;/li&gt;
&lt;li&gt;If neither of two previous solutions satisfy you, just use a separate stylesheet for your marquee animation and modify the &lt;code&gt;getAnimationRule&lt;/code&gt; to parse only the marquee stylesheet.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Create a rotating cube in WebGL with Three.js</title>
   <link href="http://www.jonathan-petitcolas.com/2013/04/02/create-rotating-cube-in-webgl-with-threejs.html"/>
   <updated>2013-04-02T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2013/04/02/create-rotating-cube-in-webgl-with-threejs</id>
   <content type="html">&lt;p&gt;During the last hackday at &lt;a href=&quot;http://www.marmelab.com&quot;&gt;Marmelab&lt;/a&gt;, I decided to play with &lt;a href=&quot;http://mrdoob.github.com/three.js/&quot;&gt;Three.js&lt;/a&gt;, one of the most famous WebGL library. As hackdays are not hackweeks, I restricted myself to a simple purpose: a rotating Marmelab logo. Today, I am going to present to you the results of my experiments.&lt;/p&gt;

&lt;p&gt;I splitted it into two posts. The first one is aimed to be a simple introduction to Three.js shows how to generate a rotating cube. The second one will learn you how to modelize a (not so) complex mesh in Blender and how to import it with correct texture. But for now, let&amp;#39;s focus on the simple cube.&lt;/p&gt;

&lt;h2&gt;Initializing Three.js scene&lt;/h2&gt;

&lt;p&gt;First, let&amp;#39;s initialize our project. We just create a basic empty HTML page, including the Three.js library. At first thought, I wanted to include Three.js as a submodule, as every third-party library I use. Yet, Mrdoob, maintainer of Three.js himself, recommends to not do such a thing (&lt;a href=&quot;https://github.com/mrdoob/three.js/issues/2179#issuecomment-6889647&quot;&gt;source&lt;/a&gt;):&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The lib doesn&amp;#39;t update too often. And when it updates it tends to break code. So a submodule approach wouldn&amp;#39;t really work...&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;So, just include the minified &lt;a href=&quot;https://raw.github.com/mrdoob/three.js/master/build/three.min.js&quot;&gt;three.min.js&lt;/a&gt; file as following:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;Rotating logo - WebGL experiment&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;container&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;js/three.min.js&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;js/main.js&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now, let&amp;#39;s write our &lt;code&gt;main.js&lt;/code&gt; file, containing all the logic of our rendering.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;requestAnimationFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We split our code into two parts: the initialization and rendering. The only interesting thing to notice here is the call to &lt;code&gt;requestAnimationFrame&lt;/code&gt;. This function acts similarly than &lt;code&gt;setTimeout&lt;/code&gt;, but in a slightly better way. To better understand it, let&amp;#39;s compare the ways Javascript offers to repeat a function call.&lt;/p&gt;

&lt;h3&gt;How to call a function periodically in Javascript?&lt;/h3&gt;

&lt;p&gt;The simplest is &lt;code&gt;setInterval&lt;/code&gt; function. It takes two arguments: a function &lt;em&gt;f&lt;/em&gt; to call and a time interval &lt;em&gt;n&lt;/em&gt; in milliseconds. This function will simply call &lt;em&gt;f&lt;/em&gt; every &lt;em&gt;n&lt;/em&gt; milliseconds, whatever may happen. Sounds good at first glance. But what about if &lt;em&gt;f&lt;/em&gt; execution time lasts more than &lt;em&gt;n&lt;/em&gt; milliseconds? Well, another call will be made, even if the first one was not terminated, which may cause some glitches.&lt;/p&gt;

&lt;p&gt;A better solution is to use the &lt;code&gt;setTimeout&lt;/code&gt;  function, which has the same signature. The advantage with this one is it will not proceed to the next call until the current one has been entirely processed. Yet, it is not the optimal solution.&lt;/p&gt;

&lt;p&gt;The best solution you should use is the &lt;code&gt;requestAnimationFrame&lt;/code&gt; function. Its signature takes only one single argument: the function to call. Indeed, the browser will call it only when it needs. Furthermore, this function is by far more clever than the other two ones, as it pauses when current tab is not visible, saving battery and resources.&lt;/p&gt;

&lt;p&gt;That&amp;#39;s why using &lt;code&gt;requestAnimationFrame&lt;/code&gt; is the best choice (in this case). However, this is not a generality. For long polling for instance, you should better use a &lt;code&gt;setInterval&lt;/code&gt;, unless you want to flood uselessly your server.&lt;/p&gt;

&lt;h3&gt;Three elements for rendering: scene, camera and renderer&lt;/h3&gt;

&lt;p&gt;After this small digression, let&amp;#39;s come back to our main topic. To display something, you need three elements: a scene, a camera and a renderer.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;scene&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;camera&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;renderer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WIDTH&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;innerWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HEIGHT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;innerHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;scene&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;THREE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Scene&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;initCamera&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;initRenderer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;renderer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;domElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;initCamera&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;camera&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;THREE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;PerspectiveCamera&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;70&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WIDTH&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HEIGHT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;camera&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;3.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;camera&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;lookAt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;scene&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;initRenderer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;renderer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;THREE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;WebGLRenderer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;antialias&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;renderer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;WIDTH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HEIGHT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We first define global variables to store our three main elements. You should rather use nested namespaces instead of. But for clarity, I voluntarily ignored this best practice. We also defined two constants to keep the dimensions of our WebGL element (here, the whole window).&lt;/p&gt;

&lt;p&gt;Then, we initialize the scene. Nothing to say here, except the use of the &lt;code&gt;THREE&lt;/code&gt; namespace.&lt;/p&gt;

&lt;p&gt;Next line, we initialize the camera. We use a perspective camera, as it is the most natural choice. It takes four arguments:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;the vertical viewing angle (also known as the &lt;em&gt;field of view&lt;/em&gt;, or &lt;em&gt;fov&lt;/em&gt;). Generally, a value between 60 and 70° is natural.&lt;/li&gt;
&lt;li&gt;the ratio&lt;/li&gt;
&lt;li&gt;the distance where the screen is located from the camera. Objects before this distance will not be rendered (&lt;em&gt;zNear&lt;/em&gt; in following schema).&lt;/li&gt;
&lt;li&gt;the maximum sight of the camera: beyond this point objects will not be visible (&lt;em&gt;zFar&lt;/em&gt; in schema).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Here is a good and simple schema, taken from a &lt;a href=&quot;http://icwww.epfl.ch/%7Esam/prjinfoSV/tutorial-wxWidget/cours/fonctionnement-openGL/&quot;&gt;tutorial of a Swiss university&lt;/a&gt;, explaining previous points:&lt;/p&gt;

&lt;p class=&quot;center&quot;&gt;
    &lt;img src=&quot;/img/posts/perspective-ecran.png&quot; alt=&quot;Perspective camera in WebGL&quot; title=&quot;Perspective camera in WebGL&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;The viewport limits help to improve performances by restricting number of computations to operate. Thus, the elements before the lower limit or after the higher one will not be treated. Always keep in mind the performance problematic when you are doing 3D rendering.&lt;/p&gt;

&lt;p&gt;We move the camera at coordinates (0, 3.5, 5) and then orientate it to look at the center of the scene through the &lt;code&gt;lookAt&lt;/code&gt; position.&lt;/p&gt;

&lt;p&gt;Finally, we initialize our renderer. As we are making WebGL, we use the &lt;code&gt;WebGLRenderer&lt;/code&gt;. Some other, such as &lt;code&gt;CanvasRenderer&lt;/code&gt; exist, but they suffer of some restrictions. Do not forget to append the renderer container into the DOM (here with a simple &lt;code&gt;appendChild&lt;/code&gt; call).&lt;/p&gt;

&lt;h2&gt;Drawing a rotating cube&lt;/h2&gt;

&lt;p&gt;Now we are ready to display our first mesh. So, let&amp;#39;s begin by drawing a cube:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cube&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ... (scene initialization)&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;initCube&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;initCube&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;cube&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;THREE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Mesh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;THREE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CubeGeometry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;THREE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;MeshNormalMaterial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;scene&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cube&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;renderer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;scene&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;camera&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The previous code will display a cube seen from high angle view (as &lt;code&gt;y&lt;/code&gt; position of our camera is greater than our cube position).&lt;/p&gt;

&lt;p&gt;If you looked more precisely to our renderer initialization, we passed it an &lt;code&gt;antialias&lt;/code&gt; option. This option is set to have a better rendering by smoothing all pixellized edges. It has of course an impact on performances.&lt;/p&gt;

&lt;p&gt;Here are the two versions, respectively the anti-aliased and the aliased ones:&lt;/p&gt;

&lt;p class=&quot;center&quot; style=&quot;margin: 20px auto;&quot;&gt;
    &lt;img src=&quot;/img/posts/antialiased-cube.png&quot; alt=&quot;Simple antialiased cube in WebGL&quot; title=&quot;Simple antialiased cube in WebGL&quot; style=&quot;margin-right: 30px;&quot; /&gt;
    &lt;img src=&quot;/img/posts/aliased-cube.png&quot; alt=&quot;Simple aliased cube in WebGL&quot; title=&quot;Simple aliased cube in WebGL&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;Bad looking on a simple mesh. I let you guess the result on more complex ones.&lt;/p&gt;

&lt;p&gt;In the previous code, we just add a new mesh to the scene through the &lt;code&gt;initCube&lt;/code&gt; function. A mesh initialization requires two arguments:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Mesh geometry: where are located all the vertices and faces of our mesh.&lt;/li&gt;
&lt;li&gt;Mesh material: how each face should be rendered? Colors and physical properties (as brightness or opacity) are set here.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We just define a cube of 2 units edge, with default material (each face will be of a different color).&lt;/p&gt;

&lt;p&gt;Do not forget to call the renderer to see your cube, by calling the &lt;code&gt;render&lt;/code&gt; function. We could have put it in the &lt;code&gt;init&lt;/code&gt; function in this static case. However, as our cube will move, we have to render the scene at each frame.&lt;/p&gt;

&lt;p&gt;Now, let&amp;#39;s rotate it with the simple following code:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;SPEED&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rotateCube&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;cube&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;rotation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;SPEED&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;cube&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;rotation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;SPEED&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;cube&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;rotation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;SPEED&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;requestAnimationFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;rotateCube&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;renderer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;scene&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;camera&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We play with the rotation angle of our cube, and just call the rotation function before rendering our cube.&lt;/p&gt;

&lt;p&gt;Nice looking result for very few lines of code, isn&amp;#39;t it? &lt;a href=&quot;http://www.jonathan-petitcolas.com/webgl-experiments/00-rotating-cube/&quot;&gt;Demonstration&lt;/a&gt; and &lt;a href=&quot;https://github.com/jpetitcolas/webgl-experiments/tree/gh-pages/00-rotating-cube&quot;&gt;source code&lt;/a&gt; are both available on GitHub.&lt;/p&gt;

&lt;p&gt;In the next post, we will see how to render a more complex mesh with Three.js, modelized in &lt;a href=&quot;http://www.blender.org/&quot;&gt;Blender&lt;/a&gt;.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Using Sublime Text 2 for web development</title>
   <link href="http://www.jonathan-petitcolas.com/2013/03/23/configuring-sublime-text-2-for-web-development.html"/>
   <updated>2013-03-23T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2013/03/23/configuring-sublime-text-2-for-web-development</id>
   <content type="html">&lt;p&gt;As everyone else, I started development with basic utility, such as Notepad (without the ++). Then, I gave a try to more advanced tools allowing me to have some syntax highlighting, basic auto-completion, etc. When I started professional development, I switched to more robust looking IDEs (especially Eclipse and Netbeans). It was pleasant at the beginning, when my needs were really basic. Yet, they are often based on Java, which provide them a particular heaviness (and critical security flaws). And, if you HAVE the misfortune to work on a remote Samba share, it is better you are really patient...&lt;/p&gt;

&lt;p&gt;Today, I play with several brand new exciting technologies, such as Symfony2 or Node.js, versionning it through the powerful Git, and having tamed Bash commands pretty well. Developing on Windows has become a terrible pain. Some solutions exist, such as Cygwin. Yet, they are not satisfactory, because of some limitations. The best solution I found is to use a virtual machine (for the Linux power) interfaced with a Samba network drive to my host system.&lt;/p&gt;

&lt;p&gt;That&amp;#39;s why I decided to quit IDE to switch back to basic text editors. Indeed, I am not using any of the extra features provided by the big softs. I just edit my text, sometimes using auto-completion, and then switching to my browser to press manually F5. I never used integrated debugger or other such features. And even for my versionning, I rather like command line to wobbly integrated contextual menus.&lt;/p&gt;

&lt;p&gt;I started to use Vim. And for several years, it was perfect for my needs. Really light, so powerful (even if it has a so steep learning curve) and a little bit geeky. Until I discovered another light solution, working natively on Windows, allowing me to do all what I was used to on Vim, but with a more user-friendly interface: Sublime Text 2.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.sublimetext.com/2&quot;&gt;Sublime Text 2&lt;/a&gt; is an awesome text editor, a worthy successor to Notepad++. It supports great features (more details on it later in this post), is really reactive and is cross platform. Moreover, it embeds a package manager allowing you to install or remove very easily community plug-in.&lt;/p&gt;

&lt;p&gt;Even if it is a paid software, you can use it as a trial as much as you want, without any restrictions. This is probably the main reason of this software success. You will only get some rare pop-ups encouraging you to register if you liked the program. And, icing on the cake, the licence is per user, not by machine. So, you may use it on every machine and every desktop you wish.&lt;/p&gt;

&lt;p&gt;But, let&amp;#39;s dive into the basics of this awesome software.&lt;/p&gt;

&lt;h2&gt;List of useful shortcuts&lt;/h2&gt;

&lt;p&gt;Here is a list of useful shortcuts:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;CTRL + P: quick go to file command&lt;/li&gt;
&lt;li&gt;CTRL + SHIFT + P: command line&lt;/li&gt;
&lt;li&gt;CTRL + J: put all the selected lines on a single line&lt;/li&gt;
&lt;li&gt;CTRL + K, CTRL + B: display or hide navigation sidebar if folder opened&lt;/li&gt;
&lt;li&gt;CTRL + K, CTRL + U: put in uppercase&lt;/li&gt;
&lt;li&gt;CTRL + K, CTRL + L: put in lowercase&lt;/li&gt;
&lt;li&gt;CTRL + SHIFT + UP/DOWN: move a line upward/downward&lt;/li&gt;
&lt;li&gt;CTRL + SHIFT + D: duplicate current line&lt;/li&gt;
&lt;li&gt;CTRL + SHIFT + K: delete current line&lt;/li&gt;
&lt;li&gt;CTRL + SHIFT + /: wrap selected content into a comment block&lt;/li&gt;
&lt;li&gt;F9: sort all selected lines by alphabetical order&lt;/li&gt;
&lt;li&gt;CTRL + click(s): multiple selection&lt;/li&gt;
&lt;li&gt;CTRL + D: add next occurence of current search to multiple selection&lt;/li&gt;
&lt;li&gt;CTRL + ALT + UP/DOWN: add previous/next line (same column) to the multiple selection&lt;/li&gt;
&lt;li&gt;SHIFT + F11: go to no distraction mode. Only text and you, great to focus on your thought while writing a post.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This is not an exhaustive list: I discover new ones regularly. Moreover, I did not tell about standard commands, such as &lt;em&gt;Search and replace&lt;/em&gt;, which are the same than in every other text editors.&lt;/p&gt;

&lt;h2&gt;Configuring Sublime Text 2 for Web development&lt;/h2&gt;

&lt;p&gt;All configuration is done through the edition of a simple JSON file. Here are the settings I use for web development.&lt;/p&gt;

&lt;p&gt;First, open the preference settings thanks to the command line (CTRL + SHIFT + P) by typing &lt;code&gt;settings&lt;/code&gt;. The default settings contains a description of all available parameters, which are overwritten by the user settings. So, rather like editing the user configuration file.&lt;/p&gt;

&lt;p&gt;Here are the parameters I overrode:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// The number of spaces a tab is considered equal to&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&amp;quot;tab_size&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Set to true to insert spaces when tab is pressed&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&amp;quot;translate_tabs_to_spaces&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Set to true to removing trailing white space on save&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&amp;quot;trim_trailing_white_space_on_save&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Set to true to ensure the last line of the file ends in a newline&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// character when saving&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&amp;quot;ensure_newline_at_eof_on_save&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Determines what character(s) are used to terminate each line in new files.&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Valid values are &amp;#39;system&amp;#39; (whatever the OS uses), &amp;#39;windows&amp;#39; (CRLF) and&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// &amp;#39;unix&amp;#39; (LF only).&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&amp;quot;default_line_ending&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;unix&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// By default, shift+tab will only unindent if the selection spans&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// multiple lines. When pressing shift+tab at other times, it&amp;#39;ll insert a&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// tab character - this allows tabs to be inserted when tab_completion is&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// enabled. Set this to true to make shift+tab always unindent, instead of&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// inserting tabs.&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&amp;quot;shift_tab_unindent&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Not a lot to say here. I just use development standards, removing all unneccessary spaces and using 4 spaces instead of a tab.&lt;/p&gt;

&lt;p&gt;I also hide the right minimap (I never found any utility to that) and menubar (still accessible by pressing Alt) to get as less distraction as possible when going to fullscreen (F11). You can do it in the menu &lt;code&gt;View&lt;/code&gt;. However, it seems menu can not be hidden in Linux version. At least, I did not find any solution.&lt;/p&gt;

&lt;h2&gt;Configuring your project&lt;/h2&gt;

&lt;p&gt;As previously said, my files are located on a virtual Linux machine (to use the power of Git command line) and my Sublime Text is on my Windows host. To manipulate my sources, I am using a Samba share. As a result, communication is sometimes really slow when dealing with a high number of items. Especially on Sublime Text.&lt;/p&gt;

&lt;p&gt;When I work on a Symfony2 application, external bundles represent a huge part of the project content. And when I try to &lt;code&gt;Refresh folders&lt;/code&gt;, I have to wait several minutes to get the whole project folder fully updated. That&amp;#39;s why I generally always modify my project settings.&lt;/p&gt;

&lt;p&gt;Project management in Sublime Text is really basic (yet efficient). Just open a folder through the &lt;code&gt;File&lt;/code&gt; menu. Then, save your selection as a project: &lt;code&gt;Project &amp;gt; Save project as&lt;/code&gt;. A &lt;code&gt;.sublime-project&lt;/code&gt; file will be created. Once it is saved, just edit your project settings, still in &lt;code&gt;Project&lt;/code&gt; menu. You should get a similar configuration file:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&amp;quot;folders&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&amp;quot;path&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;my-project&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Simply turn it into:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&amp;quot;folders&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&amp;quot;path&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;app&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&amp;quot;folder_exclude_patterns&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;cache&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;logs&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&amp;quot;path&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;src&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&amp;quot;file_exclude_patterns&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;*.css&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This way, you will import &lt;code&gt;app&lt;/code&gt;, &lt;code&gt;src&lt;/code&gt; and &lt;code&gt;web&lt;/code&gt; folders only, the three main folders you should edit in a Symfony2 project. Moreover, I excluded cache and logs files, thanks to the &lt;code&gt;folder_exclude_patterns&lt;/code&gt;. Finally, I chose to not include CSS files from &lt;code&gt;web&lt;/code&gt; folders, assuming I am using LESS to stylize my website.&lt;/p&gt;

&lt;h2&gt;Grab some extensions&lt;/h2&gt;

&lt;p&gt;Even if Sublime Text is a great editor, it may be far more powerful with some extensions. But, before browsing my installed ones, let install the package manager, allowing you to deal very easily with all the community plugins.&lt;/p&gt;

&lt;h3&gt;Use package manager&lt;/h3&gt;

&lt;p&gt;To install package manager, simply open the Python console (CTRL + `, or &lt;em&gt;View &amp;gt; Show console&lt;/em&gt;) and enter the following:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;urllib2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;#39;Package Control.sublime-package&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ipp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sublime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;installed_packages_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;makedirs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ipp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ipp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;urllib2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;install_opener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;urllib2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;build_opener&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;urllib2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ProxyHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()));&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ipp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;#39;wb&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;urllib2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;urlopen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;#39;http://sublime.wbond.net/&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;#39;%20&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;#39;Please restart Sublime Text to finish installation&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If it does not work, you can still use the &lt;a href=&quot;http://wbond.net/sublime_packages/package_control/installation#Manual_Instructions&quot;&gt;manual procedure&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Once done, restart Sublime and then you should have access to the package manager. Just open the command line (CTRL + SHIFT + P) and look for &amp;quot;Package control: install package&amp;quot;. Just type the name of the plug-in you want, and that&amp;#39;s all.&lt;/p&gt;

&lt;p&gt;Here are few plug-ins I daily use.&lt;/p&gt;

&lt;h3&gt;Emmet: write HTML the zen coding way&lt;/h3&gt;

&lt;p&gt;Zen coding allows to write HTML very quickly. If you do not already know it, just watch the following video:&lt;/p&gt;

&lt;div class=&quot;js-video vimeo&quot;&gt;
    &lt;iframe src=&quot;http://player.vimeo.com/video/7405114&quot; width=&quot;500&quot; height=&quot;344&quot; frameborder=&quot;0&quot; webkitAllowFullScreen mozallowfullscreen allowFullScreen&gt;&lt;/iframe&gt;
&lt;/div&gt;

&lt;p&gt;Autocompleting is as simple as pressing &lt;code&gt;Tab&lt;/code&gt; key. The abbreviation command is available through is CTRL + ALT + ENTER.&lt;/p&gt;

&lt;p&gt;Plug-in repository: &lt;a href=&quot;https://github.com/sergeche/emmet-sublime&quot;&gt;Emmet&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;Sublime Linter: parse your code before executing it&lt;/h3&gt;

&lt;p&gt;All developers are faced with typos. To avoid trivial inattention errors, Sublime Linter is a good plugin. It highlights in real-time the syntaxical mistakes you made: missing semi-column, misspelled keyword, and so on.&lt;/p&gt;

&lt;p&gt;For Windows users, you have to &lt;a href=&quot;http://nodejs.org/&quot;&gt;install Node.js&lt;/a&gt; if you want CSS and Javascript parser to work.&lt;/p&gt;

&lt;p&gt;Plug-in repository: &lt;a href=&quot;https://github.com/SublimeLinter/SublimeLinter&quot;&gt;SublimeLinter&lt;/a&gt;&lt;/p&gt;

&lt;h2&gt;Adding some snippets&lt;/h2&gt;

&lt;p&gt;Another interesting feature is the possibility to use pre-configured snippets. Let&amp;#39;s take an example.&lt;/p&gt;

&lt;p&gt;Imagine you want to create a new method in PHP. Simply write &lt;code&gt;fun&lt;/code&gt;, and press Tab. Sublime Text will show you:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;x&quot;&gt;public function FunctionName($value=&amp;#39;&amp;#39;)&lt;/span&gt;
&lt;span class=&quot;x&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;x&quot;&gt;    # code...&lt;/span&gt;
&lt;span class=&quot;x&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Just navigate through the different editable items of snippets by pressing Tab.&lt;/p&gt;

&lt;p&gt;To create your custom snippets, it is also really easy. Let&amp;#39;s consider we want to write a snippet &lt;code&gt;sf2mail&lt;/code&gt; which will be replaced by the whole code to send an email from a controller. Very useful, as I never remember the exact code, forcing me to ask Google.&lt;/p&gt;

&lt;p&gt;To create a snippet, simply go to &lt;code&gt;Tools &amp;gt; New snippet&lt;/code&gt;. An XML file will appear:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;snippet&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;content&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;![CDATA[&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;Hello, ${1:this} is a ${2:snippet}.&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;]]&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/content&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Optional: Set a tabTrigger to define how to trigger the snippet --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- &amp;lt;tabTrigger&amp;gt;hello&amp;lt;/tabTrigger&amp;gt; --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Optional: Set a scope to limit where the snippet will trigger --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- &amp;lt;scope&amp;gt;source.python&amp;lt;/scope&amp;gt; --&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/snippet&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The snippet is composed of three items:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;content:&lt;/em&gt; code replacing the typed trigger,&lt;/li&gt;
&lt;li&gt;&lt;em&gt;tabTrigger:&lt;/em&gt; the trigger you should type to deploy the snippet,&lt;/li&gt;
&lt;li&gt;&lt;em&gt;scope:&lt;/em&gt; a link between the snippet and a file extension.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;So, in our case, the corresponding snippet would be:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;snippet&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;content&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;![CDATA[&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;\$message = \Swift_Message::newInstance()&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;    -&amp;gt;setSubject(&amp;#39;${1:subject}&amp;#39;)&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;    -&amp;gt;setFrom(&amp;#39;${2:from}&amp;#39;)&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;    -&amp;gt;setTo(&amp;#39;${3:to}&amp;#39;)&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;    -&amp;gt;setBody(\$this-&amp;gt;renderView(&amp;#39;${4:template}&amp;#39;, ${5:parameters}))&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;\$this-&amp;gt;get(&amp;#39;mailer&amp;#39;)-&amp;gt;send(\$message);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;    ]]&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/content&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;tabTrigger&amp;gt;&lt;/span&gt;sf2mail&lt;span class=&quot;nt&quot;&gt;&amp;lt;/tabTrigger&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;source.php&lt;span class=&quot;nt&quot;&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/snippet&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Do not forget to include the content between CDATA tags and to escape dollar sign.&lt;/p&gt;

&lt;p&gt;As you may have already guessed, the &lt;code&gt;${1:subject}&lt;/code&gt; and such others are placeholders. You navigate through them with tab key.&lt;/p&gt;

&lt;p&gt;Save your file with &lt;code&gt;.sublime-snippet&lt;/code&gt; extension. It is now available from PHP files.&lt;/p&gt;

&lt;h2&gt;Sharing configuration across machines&lt;/h2&gt;

&lt;p&gt;I regularly use several machines, on different OS (Linux and Windows). I am using Sublime Text on all of these systems. So, I looked for a solution to share my configuration through all my computers.&lt;/p&gt;

&lt;p&gt;I am using GitHub every day. So, it was logical to use it to store my config. To store your own configuration, you just have to send remotely (on GitHub or on Dropbox for instance) your user settings folder. It is located, depending of your system, at:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Windows:&lt;/em&gt; C:\Users[YOUR NAME]\AppData\Roaming\Sublime Text 2\Packages&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Linux:&lt;/em&gt; ~/.config/sublime-text-2/Packages&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Mac:&lt;/em&gt; ~/Library/Application\ Support/Sublime\ Text\ 2/Packages/&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This way, I was able to share my configuration on GitHub: &lt;a href=&quot;https://github.com/jpetitcolas/sublime-text-config&quot;&gt;https://github.com/jpetitcolas/sublime-text-config&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To use it, I simply clone the repository to the previous path. For instance, on Linux:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;rm -Rf ~/.config/sublime-text-2/Packages
git clone git@github.com:jpetitcolas/sublime-text-config.git ~/.config/sublime-text-2/Packages
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Easy, isn&amp;#39;t it?&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>New year, new start...</title>
   <link href="http://www.jonathan-petitcolas.com/2013/01/07/new-year-new-start.html"/>
   <updated>2013-01-07T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2013/01/07/new-year-new-start</id>
   <content type="html">&lt;p&gt;I have decided to commit myself into two major professional changes this new year: accepting a new job proposal and closing my own company. Here are the reasons of these two big steps.&lt;/p&gt;

&lt;h2&gt;End of my adventure at MyStudioFactory&lt;/h2&gt;

&lt;p&gt;I am currently at the end of my current lead developer position at &lt;a href=&quot;http://www.mystudiofactory.com&quot;&gt;MyStudioFactory&lt;/a&gt;, a mobile development company in Paris. I discovered here the smartphones and tablets world, with its specific constraints, such as offline data persistence or battery problematics. I also discovered some responsive framework, especially &lt;a href=&quot;http://zurb.foundation.com&quot;&gt;Zurb Foundation one&lt;/a&gt;, and some &amp;quot;MVC&amp;quot; Javascript frameworks like &lt;a href=&quot;http://backbonejs.org&quot;&gt;Backbone.js&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I was also in charge of &lt;a href=&quot;http://apps.microsoft.com/windows/fr-fr/app/seloger/25d5dcea-1020-46f6-8b82-6ceeaf9943fa&quot;&gt;SeLoger.com&lt;/a&gt; and of the incoming AirFrance Windows8 applications. It gave me the opportunity to discover the whole new powerful Windows8 framework, using the languages I love: HTML, CSS and Javascript. I really had a great feeling about the WinJS SDK. Simple and efficient.&lt;/p&gt;

&lt;p&gt;I was also implicated into the development of an analytics API and back-office for monitoring all our mobile applications traffic. Using Symfony2 and advanced Propel features, it was the first time I had to deal with a very high-volumetry system (several millions records are inserted each day, records which should be computed nearly in real-time to fill all customers demands, even the wackiest). Very challenging.&lt;/p&gt;

&lt;p&gt;By the way, they are still looking for a developer replacing me. Here is the &lt;a href=&quot;http://remixjobs.com/emploi/Developpement/Developpeur-PHP-Symfony-confirme-H-F/17089&quot;&gt;job proposal (in French)&lt;/a&gt; if you are interested in.&lt;/p&gt;

&lt;h2&gt;Joining Marmelab, a digital innovation company&lt;/h2&gt;

&lt;p&gt;I moved in Nancy (my birth city, in the East of France) a year ago. Yet, I still worked in Paris (at 90 minutes of train from Nancy). I moved there for personal reasons (better way of life, a lot of friends and family there, etc.). I did not know that &lt;a href=&quot;http://dotheweb.posterous.com/&quot;&gt;François Zaninotto&lt;/a&gt;, the former technical director of &lt;a href=&quot;http://www.tf1.fr&quot;&gt;eTF1&lt;/a&gt; (the interactive department of the first French channel) would take the same decision, a few months later.&lt;/p&gt;

&lt;p&gt;We met together again in a PHP drink, and he told me about his next project: founding a company based on innovation where developers would have fun creating exciting projects including a wide range of new technologies in a agile way. Sounds pretty cool, isn&amp;#39;t it?&lt;/p&gt;

&lt;p&gt;I worked with him during two years at eTF1. And I must admit it was the best experience of my career. A lot of high-skilled developers on some very innovative projects, where knowledge sharing was the most important thing. I never learnt so much than in these two years. And I strongly think it is in major part thanks to François&amp;#39; lead.&lt;/p&gt;

&lt;p&gt;That&amp;#39;s why when I learnt he was looking for some developers, I immediately sent him a message. And after a few talks, we have decided to begin this new adventure together. I am going to start on an exciting Node.js project at the beginning of February, with a Scrum methodology.&lt;/p&gt;

&lt;h2&gt;Diving deeper into the open-source world&lt;/h2&gt;

&lt;p&gt;The other main decision I took is the closure of my company. Indeed, I developed for several years websites, blogs or Intranets as a freelance. It allowed me to increase my experience in WordPress and Symfony2 on concrete professional projects (and of course to earn a little extra money). Yet, this side activity was really time-consuming and having a personal life in these conditions was not really easy.&lt;/p&gt;

&lt;p&gt;I love open-source. I discovered it a several years ago, with my first Linux installation. Then, I felt in love with development, and I often inspired me from online snippets. Yet, at this time, GitHub did not exist. And it was difficult to share patches and other code changes with the main developers. So, it was essentially a unidirectional relationship.&lt;/p&gt;

&lt;p&gt;When I started to use PHP in a professional environment, I gathered all my functions and modified snippets into my own framework (Symfony or Zend were not so famous as today). I shared it with several people: friends, colleagues, etc. We all brought some changes to improve security, performances, features, and so on. It was open-source, but in a restricted circle.&lt;/p&gt;

&lt;p&gt;Then, I registered on GitHub, and found a awesome tool to share code modifications, to talk with other developers, to have code reviews, to improve my favorite bundles, and so on. I always had the envy, I found the right tool, I missed some time. So, I have decided to fix this last point, and I am going to implicate myself more deeply into open-source community from now.&lt;/p&gt;

&lt;p&gt;I am very enthusiast about this new year. Being paid for making things I love, with great people, taking part into the open-source community. Can&amp;#39;t wait anymore! :)&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Migrating to GitHub Pages</title>
   <link href="http://www.jonathan-petitcolas.com/2012/12/25/migrating-to-github-pages.html"/>
   <updated>2012-12-25T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2012/12/25/migrating-to-github-pages</id>
   <content type="html">&lt;h2&gt;WordPress, an overkill CMS&lt;/h2&gt;

&lt;p&gt;I used &lt;a href=&quot;http://wordpress.org&quot;&gt;WordPress&lt;/a&gt; during several years, since the first time I blogged. This incredible platform helps to put online very easily a website and offers a great community, with a wide choice of themes or plugins. I really enjoyed it. Yet, as time passes, this blogging platform turns deeper and deeper into a big CMS with a wide range of features. It is a good thing. This tool is greatly designed (for user experience at least... I always had some trouble with WordPress code). Yet, it is now a overkill solution for my humble blog, gathering only simple posts and pages.&lt;/p&gt;

&lt;p&gt;I am always looking for minimalist tools. I rather like a single task efficient utility instead of a wide-featured platform. It may seem quite odd, but I will probably write a lot more with a very simple interface, or even in Vim. Writing everything in a single place, without any visual distraction. This is the key for effectiveness. For instance, I am currently writing this post on a fullscreen Vim. Only me, the keyboard and my terminal screen. And it rocks!&lt;/p&gt;

&lt;p&gt;The use of a MySQL database is also a bad point. It is slow for my content which is mostly static. Of course, I correct some typos or clarify some points, but there is no major changes once a post is published. And the database tends to grow up very quickly. Simply writing a post inserts a lot of records for versionning (another feature I do not really care). And I do not speak about the plug-ins, which are keen on adding a lot of options stored in the base.&lt;/p&gt;

&lt;h2&gt;Back to basics with GitHub Pages&lt;/h2&gt;

&lt;h3&gt;Jekyll, Git and MarkDown: a winning trio&lt;/h3&gt;

&lt;p&gt;That’s why I was looking for a light solution. I first discovered &lt;a href=&quot;http://scriptogr.am&quot;&gt;Scriptogr.am&lt;/a&gt;, a blogging solution based on MarkDown format and DropBox storage. The ability to write posts in &lt;a href=&quot;http://en.wikipedia.org/wiki/Markdown&quot;&gt;MarkDown&lt;/a&gt; (a very simple yet powerful descriptive language) is a great choice. And keeping the control of all my files on my computer is also another important point. However, customizing my blog design was really painful and there were some big SEO issues (the biggest was probably the lack of 301 redirection between the Scriptogr.am domain and the custom one). That’s why I decided to look for other similar solutions. And I found GitHub Pages.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://pages.github.com/&quot;&gt;GitHub Pages&lt;/a&gt; keep the MarkDown format, allowing me to keep in sync all my posts on my devices thanks to Git. and with the use of &lt;a href=&quot;https://github.com/mojombo/jekyll&quot;&gt;Jekyll&lt;/a&gt;, I can render my pages the way I want, writing the HTML I need. It is a little bit difficult to set up such a blog from scratch. Yet, first cloning &lt;a href=&quot;https://github.com/mojombo/mojombo.github.com&quot;&gt;Mojombo’s blog repository&lt;/a&gt; helps a lot. Some graphical adjustments, and here I go.&lt;/p&gt;

&lt;p&gt;Jekyll is the engine converting my MarkDown pages into static HTML files. No PHP or other dynamic languages, no SQL request... All is pre-processed to increase at maximum the overall speed, has you may have perhaps already noticed.&lt;/p&gt;

&lt;p&gt;Another great advantage of this solution is to provide you a &lt;a href=&quot;https://github.com/jpetitcolas/jpetitcolas.github.com&quot;&gt;Fork me on GitHub!&lt;/a&gt; link. If I committed a big mistake or if you have further details to give, you will be able to contribute to my articles for the community sake.&lt;/p&gt;

&lt;h3&gt;GitHub Pages restriction&lt;/h3&gt;

&lt;p&gt;I was worried about some hosting restrictions. After all, GitHub is not a blogging platform, but a huge open-source repositories gatherer. So, I asked their support, and got an answer within the 24h (really reactive, especially taking the jet lag into account). Here is their answer (I extracted the only interesting part):&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Good questions!  About bandwidth limits, there are no hard limits, but our terms of service has a section on bandwidth usage under section G item 12. And about the number of pages you can have, there is no explicit limit here, but since your Pages are hosted in a GitHub repository, it’s subject to the same size limits as other repositories as discussed here.&lt;/p&gt;

&lt;p&gt;Finally, about topic restrictions, we have another item in our terms of service under section G item 7 that explains our position on content.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;What do the terms of service say? I extracted related parts:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;If your bandwidth usage significantly exceeds the average bandwidth usage (as determined solely by GitHub) of other GitHub customers, we reserve the right to immediately disable your account or throttle your file hosting until you can reduce your bandwidth consumption.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;What is the average used bandwidth? I do not really know. Yet, I do not really worry about that. I am hosting a technical blog about web development and open-source, with no big need of bandwidth (only static entries with a little bit of minified CSS and Javascript). And as a lot of other developers host their blog on GitHub without any problem, I am confident for the long term.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;For best performance, we recommend repositories be kept under 1GB each. This limit is easy to stay within if large files (typically, binaries) are kept out of the repo. If your repository exceeds 1GB, you might receive a polite email from support requesting that you reduce the size of the repository to bring it back down under 1GB.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Disk space use must be lower than 1GB by repository. Otherwise GitHub will warn you gently. No problem for this blog, containing essentially text posts (and perhaps sometimes some embedded videos or slideshows from an external source). According to the size of this post (almost 7kb), I would be able to write more than 160,000 posts before reaching the limit. I will think more about it when I will get more than 150,000 pages. ;)&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;We may, but have no obligation to, remove Content and Accounts containing Content that we determine in our sole discretion are unlawful, offensive, threatening, libelous, defamatory, pornographic, obscene or otherwise objectionable or violates any party’s intellectual property or these Terms of Service.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;No special limitation about the pages content. You have to respect the law, and it is normal. So, if you want to use GitHub to talk about your passion for Ancient Greece, it should not be a legal problem. Even if I do not think it is a correct platform to act so.&lt;/p&gt;

&lt;p&gt;To sum up, my decision is taken: I am moving to GitHub pages. I am going to move all the former technical articles to this new platform progressively. It represents a huge amount of work, translating all the previous French content into English.&lt;/p&gt;

&lt;p&gt;I take the opportunity given by this post to congratulate another time GitHub team. They are doing such a great job maintaining this awesome platform. Thank you all! :)&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Installing WordPress as a Git submodule</title>
   <link href="http://www.jonathan-petitcolas.com/2012/11/26/install-wordpress-as-git-submodule.html"/>
   <updated>2012-11-26T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2012/11/26/install-wordpress-as-git-submodule</id>
   <content type="html">&lt;h2&gt;Installing WordPress submodule&lt;/h2&gt;

&lt;p&gt;Updating a WordPress blog with all its plug-ins may be very time-consuming, especially for those who maintain several blogs. Fortunately, there is a solution to reduce maintenance time. Using Git, you will be able to update your blogs just by checking out the new tag of your WordPress submodule.&lt;/p&gt;

&lt;p&gt;First, create a project and initialize it:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;mkdir blog
git init
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, retrieve &lt;a href=&quot;https://github.com/WordPress/WordPress&quot;&gt;WordPress Git repository&lt;/a&gt; and add it as a submodule:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;git submodule add https://github.com/WordPress/WordPress wordpress
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For stability reasons, it is recommended to stabilize submodules to tags or branches considered as stable. So, let&amp;#39;s apply this best practice by fixing WordPress version to current one (3.4.2 when I wrote this post).&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;wordpress
git fetch -a
git tag
git checkout 3.4.2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;These lines simply go to the submodule repository to retrieve all remote tags (with &lt;code&gt;git fetch&lt;/code&gt; command). Then, we display all available tags and fix the version to 3.4.2 with &lt;code&gt;checkout&lt;/code&gt; command.&lt;/p&gt;

&lt;p&gt;Commit your work before configuring WordPress to use this Git architecture:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;git commit -m &lt;span class=&quot;s2&quot;&gt;&amp;quot;Install WordPress 3.4.2 as a submodule&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Configuring WordPress to use Git submodule&lt;/h2&gt;

&lt;p&gt;Duplicate all files you will change to be able to commit them into your own repository (and not into WordPress core):&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;cp wordpress/index.php index.php
cp wordpress/wp-config-sample.php wp-config.php
cp -Rf wordpress/wp-content .

rm -Rf wp-content/plugins/hello.php wp-content/themes/twentyten
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The three first lines simply copy files we will modify. The last one cleans our repository, removing useless &lt;em&gt;hello&lt;/em&gt; plug-in and default &lt;em&gt;twentyten&lt;/em&gt; theme.&lt;/p&gt;

&lt;p&gt;Commit these changes:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;git commit -am &lt;span class=&quot;s2&quot;&gt;&amp;quot;Duplicate all non-core WordPress files&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, we have to tell WordPress to use our new structure: the submodule for all the core files, and the root &lt;code&gt;wp-content&lt;/code&gt; folder for all other stuff.&lt;/p&gt;

&lt;p&gt;First, let&amp;#39;s edit the &lt;code&gt;index.php&lt;/code&gt; file to indicate WordPress where the bootstrap file is. Replace line 17 by:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;x&quot;&gt;require(&amp;#39;wordpress/wp-blog-header.php&amp;#39;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, edit your &lt;code&gt;wp-config.php&lt;/code&gt; configuration file according to your own situation. Just follow the comments.&lt;/p&gt;

&lt;p&gt;Yet, we will define in this file some constants to take the new structure into account. Add the following lines into this same file, &lt;strong&gt;before&lt;/strong&gt; the &lt;code&gt;require_once(ABSPATH . &amp;#39;wp-settings.php&amp;#39;);&lt;/code&gt; line (thanks to Marco Neumann for this precision):&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;x&quot;&gt;define(&amp;#39;WP_HOME&amp;#39;,    &amp;#39;http://&amp;#39;.$_SERVER[&amp;#39;SERVER_NAME&amp;#39;]);&lt;/span&gt;
&lt;span class=&quot;x&quot;&gt;define(&amp;#39;WP_SITEURL&amp;#39;, WP_HOME.&amp;#39;/wordpress&amp;#39;);&lt;/span&gt;

&lt;span class=&quot;x&quot;&gt;define(&amp;#39;WP_CONTENT_DIR&amp;#39;, $_SERVER[&amp;#39;DOCUMENT_ROOT&amp;#39;].&amp;#39;/wp-content&amp;#39;);&lt;/span&gt;
&lt;span class=&quot;x&quot;&gt;define(&amp;#39;WP_CONTENT_URL&amp;#39;, WP_HOME.&amp;#39;/wp-content&amp;#39;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Your blog should now be accessible. Do not forget to commit your changes:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;git commit -am &lt;span class=&quot;s2&quot;&gt;&amp;quot;Configure WordPress to be used as a Git submodule&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you want to connect to the administration panel, simply go to &lt;code&gt;wordpress/wp-admin&lt;/code&gt; URL. Or, if you rather like to use standard access, simply create a symbolic link:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;ln -s wordpress/wp-admin .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;How to update WordPress as a submodule?&lt;/h2&gt;

&lt;p&gt;Here is the process to update easily your WordPress installation:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;wordpress
git fetch -a
git tag
git checkout 3.4.3
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ..
git commit -am &lt;span class=&quot;s2&quot;&gt;&amp;quot;Switch WordPress to 3.4.3 version&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It is the same we have seen before. It consists to fetch all recently created tags and branches, and to change current version.&lt;/p&gt;

&lt;p&gt;It is equivalent for all the plug-ins and/or themes... at least, if they have a Git repository, which is not often the case. Pretty sad for open-source, isn&amp;#39;t it?&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Windows: save disk space deleting hiberfil.sys file</title>
   <link href="http://www.jonathan-petitcolas.com/2012/10/09/windows-save-disk-space-deleting-hiberfil.sys-file.html"/>
   <updated>2012-10-09T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2012/10/09/windows-save-disk-space-deleting-hiberfil.sys-file</id>
   <content type="html">&lt;p&gt;If you already have put a look on the biggest files of your Windows partition (with tools like &lt;a href=&quot;http://windirstat.info/&quot;&gt;WinDirStat&lt;/a&gt; for instance), you may have noticed the file &lt;em&gt;hiberfil.sys&lt;/em&gt;. This file weighs several Gigabytes alone.&lt;/p&gt;

&lt;p&gt;Its aim is to keep a trace of all your current data when your computer goes to sleep. When exiting hibernation, it is used to restore your data in their state before the standby. So, if you do not use this feature, you can delete it freely, thanks to the following command (to execute in command line, as an administrator):&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;&lt;span class=&quot;err&quot;&gt;powercfg -h off&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It will prevent your computer to hibernate. Just reboot your system, and the file will be permanently deleted.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Simulate readonly attribute on a select list</title>
   <link href="http://www.jonathan-petitcolas.com/2012/09/26/simulate-readonly-on-select-list.html"/>
   <updated>2012-09-26T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2012/09/26/simulate-readonly-on-select-list</id>
   <content type="html">&lt;p&gt;What is the difference between &lt;em&gt;readonly&lt;/em&gt; and &lt;em&gt;disabled&lt;/em&gt; HTML attributes? They both prevent a field from any change. Yet, the first sends the field value when the form is submitted. Not the second.&lt;/p&gt;

&lt;p&gt;I discovered this morning that select lists do not accept &lt;em&gt;readonly&lt;/em&gt; attribute. It is written in the W3C specifications: &lt;a href=&quot;http://www.w3.org/wiki/HTML/Elements/select&quot;&gt;HTML/Element/Select/&lt;/a&gt;. Until this is corrected, here is a JQuery way to simulate it:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * Simulate the read-only attribute on a select list (as it is not normalized).&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * @see http://www.w3.org/wiki/HTML/Elements/select&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * @param Object Select list element&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; **/&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;setReadOnlyOnSelect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;selectList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Ensure selectList exists&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;selectList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;warn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;Unable to find specified select list.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Create a hidden input to store select value&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;lt;input /&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;hidden&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;selectList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;selectList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Disable the select&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;selectList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;disabled&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The trick here is to use a hidden field to store the select value we want to submit, while disabling the select list. Really simple, isn&amp;#39;t it?&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Optimizing JQuery performances</title>
   <link href="http://www.jonathan-petitcolas.com/2012/07/29/optimizing-jquery-performances.html"/>
   <updated>2012-07-29T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2012/07/29/optimizing-jquery-performances</id>
   <content type="html">&lt;p&gt;JQuery is one of the major Javascript framework. Indeed, it is easy to dive in, has great performances and a huge community. Yet, developers sometimes forget to optimize performances, relying only on framework internals. It is an issue, especially nowadays, when mobile traffic is so important.&lt;/p&gt;

&lt;p&gt;That&amp;#39;s why I am sharing with you a slideshow from &lt;a href=&quot;http://addyosmani.com/blog/&quot;&gt;Addy Osmani&lt;/a&gt;, core-team member of JQuery. Addy gives some tips and tricks to increase overall speed of your scripts.&lt;/p&gt;

&lt;div class=&quot;iframe&quot;&gt;
  &lt;iframe src=&quot;http://www.slideshare.net/slideshow/embed_code/8520572&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot;&gt;  &lt;/iframe&gt;
&lt;/div&gt;

&lt;p&gt;To put it in a nutshell, here are the key points:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Always update your JQuery version: newest are fastest.&lt;/li&gt;
&lt;li&gt;Rather like to use &lt;code&gt;val()&lt;/code&gt; instead of &lt;code&gt;attr(&amp;quot;value&amp;quot;)&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Use pure Javascript when you have no need of JQuery: it will always be faster.&lt;/li&gt;
&lt;li&gt;Do not forget DOM caching (and thus &lt;code&gt;delegate&lt;/code&gt;, &lt;code&gt;find&lt;/code&gt; and other such methods).&lt;/li&gt;
&lt;li&gt;Prefer to &lt;code&gt;append&lt;/code&gt; strings instead of creating DOM element individually.&lt;/li&gt;
&lt;li&gt;Think to &lt;code&gt;detach&lt;/code&gt; method when you have heavy computing to do on a DOM element.&lt;/li&gt;
&lt;li&gt;Forget &lt;code&gt;data&lt;/code&gt; or &lt;code&gt;text&lt;/code&gt; methods: use &lt;code&gt;$.data&lt;/code&gt; or &lt;code&gt;$.text&lt;/code&gt; instead of.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Very interesting tips, aren&amp;#39;t they?&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Fix encoding issues when mounting a Windows partition on Linux</title>
   <link href="http://www.jonathan-petitcolas.com/2008/08/10/fix-encoding-issues-when-mounting-windows-partition-on-linux.html"/>
   <updated>2008-08-10T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2008/08/10/fix-encoding-issues-when-mounting-windows-partition-on-linux</id>
   <content type="html">&lt;p&gt;Even if it is strongly discouraged, some filenames may contains some accents or some other special characters. If it does not cause any problem in general, it may give serious issues when mounting the partition containing these files in another system. Say a Linux one.&lt;/p&gt;

&lt;p&gt;It was the case with a recent Windows backup. Trying to mount it on my Linux system worked. Yet, all files containing accents were corrupted: unable to open it.&lt;/p&gt;

&lt;p&gt;To solve this issue, you have to mount your partition with correct encoding charset. First, unmount this partition:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;umount /dev/sdb1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, remount it with the &lt;code&gt;iocharset&lt;/code&gt; argument, containing the source encoding:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;mount -t auto -o &lt;span class=&quot;nv&quot;&gt;iocharset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;utf8 /dev/sdb1 /media/external_disk/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first thing you should do now is to rename all the problematic files for an easier mounting the next time. ;)&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Redirect your URL without www to the one with www</title>
   <link href="http://www.jonathan-petitcolas.com/2008/07/30/redirect-domain-name-without-www-to-one-with-www.html"/>
   <updated>2008-07-30T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2008/07/30/redirect-domain-name-without-www-to-one-with-www</id>
   <content type="html">&lt;p&gt;On some configuration, domain name without &lt;code&gt;www&lt;/code&gt; does not always redirect to the one with &lt;code&gt;www&lt;/code&gt;. This results in a bad SEO, as search engines will see two different websites because of the two different URL. So, they will consider your website &lt;em&gt;&lt;a href=&quot;http://www.mysite.com&quot;&gt;www.mysite.com&lt;/a&gt;&lt;/em&gt; as a duplicated content of &lt;em&gt;mysite.com&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Fortunately, there is an easy trick to prevent from such a disadvantage. Just set up a 301 redirect from the without www domain to the with www domain (or the opposite). You can do it by adding the following to your VHost (or to your &lt;em&gt;.htaccess&lt;/em&gt; file):&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;RewriteCond %{HTTP_HOST} ^mysite.com$
RewriteRule ^(.*) http://www.mysite.com/$1 [QSA,L,R=301]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first line is a rewrite condition. It will execute the following rule only if the http hostname matches the regex &lt;code&gt;^mysite.com$&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;If so, we parse the URL for the query string through the regex &lt;code&gt;^(.*)&lt;/code&gt;, and redirect to the hostname with &lt;em&gt;www&lt;/em&gt;, followed by the captured query string. Three flags are present:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;QSA (Query String Append):&lt;/em&gt; keep all the &lt;code&gt;$_GET&lt;/code&gt; specified parameters from the original request to the new one,&lt;/li&gt;
&lt;li&gt;&lt;em&gt;L (Last):&lt;/em&gt; do not look for a more precise rule and just apply this one,&lt;/li&gt;
&lt;li&gt;&lt;em&gt;R=301 (301 redirect):&lt;/em&gt; this is a permanent redirect. So, search engines, please update your indexes.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Pretty simple, isn&amp;#39;t it?&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Linux: disable the annoying system beep</title>
   <link href="http://www.jonathan-petitcolas.com/2008/03/24/disable-annoying-console-beep.html"/>
   <updated>2008-03-24T00:00:00+00:00</updated>
   <id>http://www.jonathan-petitcolas.com/2008/03/24/disable-annoying-console-beep</id>
   <content type="html">&lt;p&gt;How to disable the annoying system beep you can hear on Linux console, when autocompleting a command for instance? Just edit your &lt;em&gt;/etc/inputrc&lt;/em&gt; file and uncomment (or add) the following line:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;bell-style none
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Just restart your shell, and that&amp;#39;s it!&lt;/p&gt;
</content>
 </entry>
 
 
</feed>
